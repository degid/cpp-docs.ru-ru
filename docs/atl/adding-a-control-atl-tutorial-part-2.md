---
title: Добавление элемента управления (учебник ATL, часть 2)
ms.custom: get-started-article
ms.date: 08/19/2019
ms.assetid: c9575a75-1064-41f1-9697-7aada560c669
ms.openlocfilehash: b7952f42b24c4211a2c44ea71fd17e4f65c3421a
ms.sourcegitcommit: 9d4ffb8e6e0d70520a1e1a77805785878d445b8a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2019
ms.locfileid: "69630701"
---
# <a name="adding-a-control-atl-tutorial-part-2"></a>Добавление элемента управления (учебник ATL, часть 2)

На этом шаге вы добавите элемент управления в проект, построите его и проверите его на веб-странице.

## <a name="procedures"></a>Процедуры

### <a name="to-add-an-object-to-an-atl-project"></a>Добавление объекта в проект ATL

1. В **обозревателе решений** щелкните правой кнопкой мыши проект `Polygon`.

1. Выберите пункт **Добавить** в контекстном меню и в подменю выберите пункт **создать элемент** .

    Откроется диалоговое окно **Добавление нового элемента**. Различные категории объектов перечислены в древовидной структуре слева.

1. Щелкните папку **ATL** .

1. В списке шаблонов справа выберите **элемент управления ATL**. Нажмите кнопку **Добавить**. Откроется мастер **элементов управления ATL** , и вы сможете настроить элемент управления.

1. Введите `PolyCtl` короткое имя и обратите внимание, что другие поля автоматически завершаются. Не нажимайте кнопку **Готово** , так как необходимо внести еще несколько изменений.

Страница **имен** мастера **элементов управления ATL** содержит следующие поля:

|Поле|Описание|
|-----------|--------------|
|**Короткое имя**|Имя, введенное для элемента управления.|
|**Класс**|Имя C++ класса, созданного для реализации элемента управления.|
|**H-файл**|Файл, созданный для хранения определения C++ класса.|
|**CPP-файл**|Созданный файл, содержащий реализацию C++ класса.|
|**Компонентного класса**|Имя класса компонента для этого элемента управления.|
|**Interface**|Имя интерфейса, в котором элемент управления будет реализовывать свои пользовательские методы и свойства.|
|**Type**|Описание элемента управления.|
|**ProgID**|Понятное имя, которое можно использовать для поиска идентификатора CLSID элемента управления.|

В мастере **элементов управления ATL** необходимо изменить несколько дополнительных параметров.

### <a name="to-enable-support-for-rich-error-information-and-connection-points"></a>Включение поддержки расширенных сведений об ошибках и точек подключения

1. Нажмите кнопку **Параметры** , чтобы открыть страницу **Параметры** .

1. Установите флажок **точки соединения** . Этот параметр создает поддержку для исходящего интерфейса в IDL-файле.

Можно также добавить интерфейсы для расширения функциональных возможностей элемента управления.

### <a name="to-extend-the-controls-functionality"></a>Расширение функциональных возможностей элемента управления

1. Щелкните **интерфейсы** , чтобы открыть страницу **интерфейсы** .

1. Выберите `IProvideClassInfo2` и щелкните стрелку **вверх** , чтобы переместить его в список **поддерживаемых** .

1. Выберите `ISpecifyPropertyPages` и щелкните стрелку **вверх** , чтобы переместить его в список **поддерживаемых** .

Можно также сделать элемент управления *вставляемым*, что означает возможность его внедрения в приложения, поддерживающие внедренные объекты, такие как Excel или Word.

### <a name="to-make-the-control-insertable"></a>Чтобы сделать элемент управления добавляемым

1. Нажмите кнопку **внешний вид** , чтобы открыть страницу **внешний вид** .

1. Установите флажок **inserted (вставить** ).

Многоугольник, отображаемый объектом, будет иметь сплошной цвет заливки, поэтому необходимо добавить `Fill Color` свойство «фондовой биржи».

### <a name="to-add-a-fill-color-stock-property-and-create-the-control"></a>Добавление свойства хранения цвета заливки и создание элемента управления

1. Щелкните **Свойства акции** , чтобы открыть страницу **Свойства акции** .

1. В поле **не поддерживается**прокрутите список возможных стандартных свойств. Выберите `Fill Color` и щелкните стрелку **вверх** , чтобы переместить его в список **поддерживаемых** .

1. Нажмите кнопку **Готово**.

При создании элемента управления мастером происходит несколько изменений в коде и дополнений файлов. Создаются следующие файлы:

|Файл|Описание|
|----------|-----------------|
|Поликтл.h|Содержит большую часть реализации C++ класса. `CPolyCtl`|
|Поликтл. cpp|Содержит оставшиеся части `CPolyCtl`.|
|Поликтл. RGS|Текстовый файл, содержащий скрипт реестра, используемый для регистрации элемента управления.|
|Поликтл.htm|Веб-страница, содержащая ссылку на только что созданный элемент управления.|

Мастер также вносит следующие изменения в код:

- `#include` Добавляет инструкцию в файлы предкомпилированного заголовка для включения файлов ATL, необходимых для поддержки элементов управления.

- Изменяет Polygon. idl, добавляя сведения о новом элементе управления.

- Добавляет новый элемент управления в карту объектов в Polygon. cpp.

Теперь можно создать элемент управления, чтобы увидеть его в действии.

## <a name="building-and-testing-the-control"></a>Сборка и тестирование элемента управления

### <a name="to-build-and-test-the-control"></a>Сборка и тестирование элемента управления

1. В меню **Сборка** выберите пункт **построить многоугольник**.

    После завершения сборки элемента управления щелкните правой кнопкой мыши Поликтл.htm в **Обозреватель решений** и выберите **Просмотреть в браузере**. Отобразится веб-страница HTML, содержащая элемент управления. Должна отобразиться страница с заголовком «тестовая страница ATL 8,0 для объекта Поликтл» и элемент управления «текст Поликтл».

> [!NOTE]
> Если элемент управления не отображается, необходимо убедиться, что некоторым браузерам требуются настройки параметров для запуска элементов управления ActiveX. Сведения о том, как включить элементы управления ActiveX, см. в документации по браузеру.

> [!NOTE]
> При завершении работы с этим руководством, если появится сообщение об ошибке, в котором невозможно создать DLL-файл, закройте файл Поликтл.htm и тестовый контейнер элемента управления ActiveX и повторите сборку решения. Если вы по-прежнему не можете создать библиотеку DLL, перезагрузите компьютер или выйдите из системы, если вы используете службы терминалов.

Далее предстоит добавить в элемент управления пользовательское свойство.

[Назад к шагу 1](../atl/creating-the-project-atl-tutorial-part-1.md) &#124; [На шаг 3](../atl/adding-a-property-to-the-control-atl-tutorial-part-3.md)

## <a name="see-also"></a>См. также

[Руководство](../atl/active-template-library-atl-tutorial.md)
