---
title: Сокеты Windows. Пример сокетов с использованием архивов
ms.date: 11/04/2016
helpviewer_keywords:
- sockets [MFC], with archives
- examples [MFC], Windows Sockets
- Windows Sockets [MFC], with archives
ms.assetid: 2e3c9bb2-7e7b-4f28-8dc5-6cb7a484edac
ms.openlocfilehash: 275a6c274648225fedcec9d42c280f77af68158e
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87226780"
---
# <a name="windows-sockets-example-of-sockets-using-archives"></a>Сокеты Windows. Пример сокетов с использованием архивов

В этой статье представлен пример использования класса [CSocket](../mfc/reference/csocket-class.md). В примере используются `CArchive` объекты для сериализации данных через сокет. Обратите внимание, что это не является сериализацией документа в файл или из него.

В следующем примере показано, как использовать Архив для отправки и получения данных через `CSocket` объекты. Этот пример разработан таким образом, что два экземпляра приложения (на одном компьютере или на разных компьютерах в сети) обмениваются данными. Один экземпляр отправляет данные, которые другой экземпляр получает и подтверждает. Любое приложение может инициировать обмен, а также может работать как сервер или как клиент для другого приложения. В классе представления приложения определена следующая функция:

[!code-cpp[NVC_MFCSimpleSocket#1](../mfc/codesnippet/cpp/windows-sockets-example-of-sockets-using-archives_1.cpp)]

Наиболее важным моментом в этом примере является то, что его структура параллельно работает с `Serialize` функцией MFC. `PacketSerialize`Функция члена состоит из **`if`** оператора с **`else`** предложением. Функция получает две ссылки [CArchive](../mfc/reference/carchive-class.md) в качестве параметров: *ардата* и *аракк*. Если объект архива *ардата* задан для сохранения (отправки), **`if`** ветвь выполняется; в противном случае, если *ардата* установлен для загрузки (получение), функция принимает **`else`** ветвь. Дополнительные сведения о сериализации в MFC см. в разделе [сериализация](../mfc/how-to-make-a-type-safe-collection.md).

> [!NOTE]
> Предполагается, что объект архива *аракк* является противоположным для *ардата*. Если *ардата* — для Send, *аракк* получает, а обратное — true.

Для отправки функция-пример циклически обрабатывает указанное число раз, каждый раз создавая случайные данные для демонстрационных целей. Приложение будет получать реальные данные из некоторого источника, например файла. Оператор вставки архива *ардата* ( **<<** ) используется для отправки потока из трех последовательных блоков данных:

- "Заголовок", указывающий природу данных (в данном случае значение переменной *bValue* и количество копий, которые будут отправлены).

   Для этого примера оба элемента создаются случайным образом.

- Указанное количество копий данных.

   Внутренний **`for`** цикл отправляет *bValue* указанное число раз.

- Строка с именем *стртекст* , которую получатель отображает пользователю.

Для приема функция работает аналогично, за исключением того, что она использует оператор извлечения архива ( **>>** ) для получения данных из архива. Принимающее приложение проверяет полученные данные, отображает окончательное сообщение "получено", а затем отправляет сообщение с текстом "Отправлено" для отображения отправляющего приложения.

В этой модели взаимодействия слово "получено", сообщение, отправленное в переменной *стртекст* , предназначено для вывода на другом конце связи, поэтому оно указывает принимающему пользователю, что было получено определенное количество пакетов данных. Получатель отвечает со сходной строкой с текстом "Отправлено" для отображения на экране исходного отправителя. Получение обеих строк означает, что произошла успешная связь.

> [!CAUTION]
> При написании клиентской программы MFC для взаимодействия с установленными серверами (не MFC) не отправляйте объекты C++ через архив. Если сервер не является приложением MFC, которое понимает типы объектов, которые требуется отправить, он не сможет получать и десериализовать объекты. Пример в статье [сокеты Windows: порядок байтов](../mfc/windows-sockets-byte-ordering.md) показывает связь этого типа.

Дополнительные сведения см. в разделе Спецификация сокетов Windows: **хтонл**, **хтонс**, **нтохл**, **нтохс**. Кроме того, дополнительные сведения см. в следующих статьях:

- [Сокеты Windows: производные от классов сокетов](../mfc/windows-sockets-deriving-from-socket-classes.md)

- [Сокеты Windows: как работают сокеты с архивами](../mfc/windows-sockets-how-sockets-with-archives-work.md)

- [Сокеты Windows. Фон](../mfc/windows-sockets-background.md)

## <a name="see-also"></a>См. также статью

[Сокеты Windows в MFC](../mfc/windows-sockets-in-mfc.md)<br/>
[CArchive:: для сохранения](../mfc/reference/carchive-class.md#isstoring)<br/>
[CArchive::operator<<](../mfc/reference/carchive-class.md#operator_lt_lt)<br/>
[CArchive::operator>>](../mfc/reference/carchive-class.md#operator_lt_lt)<br/>
[CArchive:: Flush](../mfc/reference/carchive-class.md#flush)<br/>
[CObject:: Serialize](../mfc/reference/cobject-class.md#serialize)
