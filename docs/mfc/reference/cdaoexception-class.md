---
title: Класс Кдаоексцептион
ms.date: 09/17/2019
f1_keywords:
- CDaoException
- AFXDAO/CDaoException
- AFXDAO/CDaoException::CDaoException
- AFXDAO/CDaoException::GetErrorCount
- AFXDAO/CDaoException::GetErrorInfo
- AFXDAO/CDaoException::m_nAfxDaoError
- AFXDAO/CDaoException::m_pErrorInfo
- AFXDAO/CDaoException::m_scode
helpviewer_keywords:
- CDaoException [MFC], CDaoException
- CDaoException [MFC], GetErrorCount
- CDaoException [MFC], GetErrorInfo
- CDaoException [MFC], m_nAfxDaoError
- CDaoException [MFC], m_pErrorInfo
- CDaoException [MFC], m_scode
ms.assetid: b2b01fa9-7ce2-42a1-842e-40f13dc50da4
ms.openlocfilehash: fcbd88e8a9ef632b61096ac2577d7a1a7094d4b5
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87231849"
---
# <a name="cdaoexception-class"></a>Класс Кдаоексцептион

Представляет условие исключения, поступающее от классов базы данных MFC на базе объектов доступа к данным (DAO). Версия DAO 3,6 является окончательной и считается устаревшей.

## <a name="syntax"></a>Синтаксис

```
class CDaoException : public CException
```

## <a name="members"></a>Участники

### <a name="public-constructors"></a>Открытые конструкторы

|Имя|Описание|
|----------|-----------------|
|[Кдаоексцептион:: Кдаоексцептион](#cdaoexception)|Формирует объект `CDaoException`.|

### <a name="public-methods"></a>Открытые методы

|Имя|Описание|
|----------|-----------------|
|[CDaoException::GetErrorCount](#geterrorcount)|Возвращает количество ошибок в коллекции ошибок ядра СУБД.|
|[Кдаоексцептион:: Жетерроринфо](#geterrorinfo)|Возвращает сведения об ошибке для конкретного объекта Error в коллекции Errors.|

### <a name="public-data-members"></a>Открытые члены данных

|Имя|Описание|
|----------|-----------------|
|[Кдаоексцептион:: m_nAfxDaoError](#m_nafxdaoerror)|Содержит расширенный код ошибки для любой ошибки в классах MFC DAO.|
|[Кдаоексцептион:: m_pErrorInfo](#m_perrorinfo)|Указатель на объект [CDaoErrorInfo](../../mfc/reference/cdaoerrorinfo-structure.md) , содержащий сведения об одном ОБЪЕКТЕ ошибки DAO.|
|[Кдаоексцептион:: m_scode](#m_scode)|Значение [SCODE](#m_scode) , связанное с ошибкой.|

## <a name="remarks"></a>Примечания

Класс содержит открытые члены данных, которые можно использовать для определения причины исключения. `CDaoException`объекты создаются и создаются функциями членов классов базы данных DAO.

> [!NOTE]
> Классы базы данных DAO отличаются от классов баз данных MFC, основанных на открытом подключении к базам данных (ODBC). Все имена классов баз данных DAO имеют префикс "Кдао". Вы по-прежнему можете обращаться к источникам данных ODBC с помощью классов DAO. Как правило, классы MFC, основанные на DAO, более поддерживаются, чем классы MFC, основанные на ODBC; классы на основе DAO могут обращаться к данным, включая драйверы ODBC, через собственное ядро СУБД. Классы на основе DAO также поддерживают операции языка DDL, такие как добавление таблиц через классы, без необходимости непосредственного вызова DAO. Сведения об исключениях, создаваемых классами ODBC, см. в разделе [кдбексцептион](../../mfc/reference/cdbexception-class.md).

К объектам исключений можно обращаться в области выражения [catch](../../mfc/reference/exception-processing.md#catch) . Кроме того, можно создавать `CDaoException` объекты из собственного кода с помощью глобальной функции [афкссровдаоексцептион](../../mfc/reference/exception-processing.md#afxthrowdaoexception) .

В MFC все ошибки DAO выражаются как исключения типа `CDaoException` . При перехвате исключения этого типа можно использовать `CDaoException` функции элементов для получения сведений из любых объектов ошибок DAO, хранящихся в коллекции ошибок компонента Database Engine. При возникновении каждой ошибки в коллекцию Errors помещается один или несколько объектов ошибок. (Обычно коллекция содержит только один объект Error; если используется источник данных ODBC, скорее всего, будет получено несколько объектов ошибок.) Если другая операция DAO создает ошибку, коллекция Errors удаляется, а новый объект ошибки помещается в коллекцию Errors. Операции DAO, не создающие ошибку, не влияют на сбор ошибок.

Коды ошибок DAO см. в файле ДАОЕРР. Высоты. Дополнительные сведения см. в разделе "ошибки доступа к обрабатываемым данным" справки DAO.

Дополнительные сведения об обработке исключений в целом и об `CDaoException` объектах см. в статьях [обработка исключений (MFC)](../../mfc/exception-handling-in-mfc.md) и [исключения: исключения базы данных](../../mfc/exceptions-database-exceptions.md). Во второй статье содержится пример кода, иллюстрирующий обработку исключений в DAO.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CException](../../mfc/reference/cexception-class.md)

`CDaoException`

## <a name="requirements"></a>Требования

**Заголовок:** афксдао.h

## <a name="cdaoexceptioncdaoexception"></a><a name="cdaoexception"></a>Кдаоексцептион:: Кдаоексцептион

Формирует объект `CDaoException`.

```
CDaoException();
```

### <a name="remarks"></a>Примечания

Как правило, платформа создает объекты исключений, когда его код создает исключение. Вам редко приходится создавать объект исключения явным образом. Если вы хотите создать исключение `CDaoException` из собственного кода, вызовите глобальную функцию [афкссровдаоексцептион](../../mfc/reference/exception-processing.md#afxthrowdaoexception).

Однако может потребоваться явно создать объект исключения, если вы выполняете прямые вызовы DAO через указатели интерфейса DAO, которые инкапсулируют классы MFC. В этом случае может потребоваться получить сведения об ошибке из DAO. Предположим, что при вызове метода DAO с помощью интерфейса Даодатабасес в коллекцию баз данных рабочей области возникает ошибка в DAO.

##### <a name="to-retrieve-the-dao-error-information"></a>Получение сведений об ошибке DAO

1. Создайте `CDaoException` объект.

1. Вызовите функцию члена [жетерроркаунт](#geterrorcount) объекта Exception, чтобы определить, сколько объектов ошибок находится в коллекции ошибок ядра СУБД. (Обычно только один, если не используется источник данных ODBC.)

1. Вызовите функцию-член [жетерроринфо](#geterrorinfo) объекта исключения для получения одного конкретного объекта ошибки за раз по индексу в коллекции через объект исключения. Объект исключения следует рассматривать как прокси-сервер для одного объекта ошибки DAO.

1. Изучите текущую структуру [CDaoErrorInfo](../../mfc/reference/cdaoerrorinfo-structure.md)`GetErrorInfo`, которая возвращает элемент данных [m_pErrorInfo](#m_perrorinfo) . Его члены предоставляют сведения об ошибке DAO.

1. В случае с источником данных ODBC при необходимости повторите шаги 3 и 4 для большего числа объектов Error.

1. Если объект исключения был создан в куче, удалите его с помощью **`delete`** оператора после завершения.

Дополнительные сведения об обработке ошибок в классах MFC DAO см. в статье [исключения базы данных](../../mfc/exceptions-database-exceptions.md).

## <a name="cdaoexceptiongeterrorcount"></a><a name="geterrorcount"></a>Кдаоексцептион:: Жетерроркаунт

Вызовите эту функцию члена, чтобы получить количество объектов ошибок DAO в коллекции ошибок ядра СУБД.

```
short GetErrorCount();
```

### <a name="return-value"></a>Возвращаемое значение

Количество объектов ошибок DAO в коллекции ошибок ядра СУБД.

### <a name="remarks"></a>Примечания

Эта информация полезна при переборе коллекции Errors для получения каждого из одного или нескольких объектов ошибок DAO в коллекции. Чтобы получить объект ошибки по индексу или по номеру ошибки DAO, вызовите функцию члена [жетерроринфо](#geterrorinfo) .

> [!NOTE]
> Обычно в коллекции Errors присутствует только один объект Error. Однако при работе с источником данных ODBC может существовать более одного.

## <a name="cdaoexceptiongeterrorinfo"></a><a name="geterrorinfo"></a>Кдаоексцептион:: Жетерроринфо

Возвращает сведения об ошибке для конкретного объекта Error в коллекции Errors.

```cpp
void GetErrorInfo(int nIndex);
```

### <a name="parameters"></a>Параметры

*ниндекс*<br/>
Индекс сведений об ошибке в коллекции ошибок ядра СУБД для поиска по индексу.

### <a name="remarks"></a>Примечания

Вызовите эту функцию члена, чтобы получить следующие сведения об исключении:

- Код ошибки

- Источник

- Описание

- Файл справки

- Контекст справки

`GetErrorInfo`хранит сведения в элементе данных объекта исключения `m_pErrorInfo` . Краткое описание возвращаемых сведений см. в разделе [m_pErrorInfo](#m_perrorinfo). Если перехватить исключение типа `CDaoException` , созданного MFC, `m_pErrorInfo` элемент будет уже заполнен. Если вы решили напрямую вызывать DAO, необходимо `GetErrorInfo` самостоятельно вызвать функцию члена объекта Exception для заполнения `m_pErrorInfo` . Более подробное описание см. в разделе Структура [CDaoErrorInfo](../../mfc/reference/cdaoerrorinfo-structure.md) .

Сведения об исключениях DAO и примеры кода см. в статье [исключения базы данных](../../mfc/exceptions-database-exceptions.md).

## <a name="cdaoexceptionm_nafxdaoerror"></a><a name="m_nafxdaoerror"></a>Кдаоексцептион:: m_nAfxDaoError

Содержит расширенный код ошибки MFC.

### <a name="remarks"></a>Примечания

Этот код предоставляется в случаях, когда конкретный компонент классов DAO MFC имеет выдвигают.

Возможны следующие значения:

- NO_AFX_DAO_ERROR самая последняя операция не привела к расширенной ошибке MFC. Однако операция могла привести к другим ошибкам из DAO или OLE, поэтому следует проверить [m_pErrorInfo](#m_perrorinfo) и, возможно, [m_scode](#m_scode).

- AFX_DAO_ERROR_ENGINE_INITIALIZATION MFC не удалось инициализировать ядро СУБД Microsoft Jet. Возможно, произошел сбой инициализации OLE или невозможно создать экземпляр объекта компонента базы данных DAO. Как правило, эти проблемы предлагают неправильное установку DAO или OLE.

- AFX_DAO_ERROR_DFX_BIND Адрес, используемый в вызове функции обмена данными для поля записи DAO (DFX), не существует или является недопустимым (адрес не использовался для привязки данных). Возможно, вы передали недопустимый адрес в DFX-вызове, или адрес может стать недействительным между операциями DFX.

- AFX_DAO_ERROR_OBJECT_NOT_OPEN попытке открыть набор записей, основанный на объекте QueryDef или объект tabledef, который не находится в открытом состоянии.

## <a name="cdaoexceptionm_perrorinfo"></a><a name="m_perrorinfo"></a>Кдаоексцептион:: m_pErrorInfo

Содержит указатель на `CDaoErrorInfo` структуру, которая предоставляет сведения об объекте ошибки DAO, полученном последним путем вызова [жетерроринфо](#geterrorinfo).

### <a name="remarks"></a>Примечания

Этот объект содержит следующие сведения:

|CDaoErrorInfo, элемент|Сведения|Значение|
|--------------------------|-----------------|-------------|
|`m_lErrorCode`|Код ошибки|Код ошибки DAO|
|`m_strSource`|Источник|Имя объекта или приложения, первоначально вызвавшего ошибку|
|`m_strDescription`|Описание|Описательная строка, связанная с ошибкой|
|`m_strHelpFile`|Файл справки|Путь к файлу справки Windows, в котором пользователь может получить сведения о проблеме|
|`m_lHelpContext`|Контекст справки|Идентификатор контекста для раздела в файле справки DAO|

Полные сведения о данных, содержащихся в `CDaoErrorInfo` объекте, см. в разделе Структура [CDaoErrorInfo](../../mfc/reference/cdaoerrorinfo-structure.md) .

## <a name="cdaoexceptionm_scode"></a><a name="m_scode"></a>Кдаоексцептион:: m_scode

Содержит значение типа `SCODE` , описывающее ошибку.

### <a name="remarks"></a>Примечания

Это код OLE. Это значение редко необходимо использовать, поскольку в большинстве случаев более конкретные сведения об ошибках MFC или DAO доступны в других `CDaoException` элементах данных.

Сведения о SCODE см. в разделе [структура кодов ошибок OLE](/windows/win32/com/structure-of-com-error-codes) в Windows SDK. Тип данных SCODE сопоставляется с типом данных HRESULT.

## <a name="see-also"></a>См. также раздел

[Класс CException](../../mfc/reference/cexception-class.md)<br/>
[Иерархическая диаграмма](../../mfc/hierarchy-chart.md)<br/>
[Класс CException](../../mfc/reference/cexception-class.md)
