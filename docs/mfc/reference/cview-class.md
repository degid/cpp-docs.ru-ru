---
title: Класс CView
ms.date: 11/04/2016
f1_keywords:
- CView
- AFXWIN/CView
- AFXWIN/CView::CView
- AFXWIN/CView::DoPreparePrinting
- AFXWIN/CView::GetDocument
- AFXWIN/CView::IsSelected
- AFXWIN/CView::OnDragEnter
- AFXWIN/CView::OnDragLeave
- AFXWIN/CView::OnDragOver
- AFXWIN/CView::OnDragScroll
- AFXWIN/CView::OnDrop
- AFXWIN/CView::OnDropEx
- AFXWIN/CView::OnInitialUpdate
- AFXWIN/CView::OnPrepareDC
- AFXWIN/CView::OnScroll
- AFXWIN/CView::OnScrollBy
- AFXWIN/CView::OnActivateFrame
- AFXWIN/CView::OnActivateView
- AFXWIN/CView::OnBeginPrinting
- AFXWIN/CView::OnDraw
- AFXWIN/CView::OnEndPrinting
- AFXWIN/CView::OnEndPrintPreview
- AFXWIN/CView::OnPreparePrinting
- AFXWIN/CView::OnPrint
- AFXWIN/CView::OnUpdate
helpviewer_keywords:
- CView [MFC], CView
- CView [MFC], DoPreparePrinting
- CView [MFC], GetDocument
- CView [MFC], IsSelected
- CView [MFC], OnDragEnter
- CView [MFC], OnDragLeave
- CView [MFC], OnDragOver
- CView [MFC], OnDragScroll
- CView [MFC], OnDrop
- CView [MFC], OnDropEx
- CView [MFC], OnInitialUpdate
- CView [MFC], OnPrepareDC
- CView [MFC], OnScroll
- CView [MFC], OnScrollBy
- CView [MFC], OnActivateFrame
- CView [MFC], OnActivateView
- CView [MFC], OnBeginPrinting
- CView [MFC], OnDraw
- CView [MFC], OnEndPrinting
- CView [MFC], OnEndPrintPreview
- CView [MFC], OnPreparePrinting
- CView [MFC], OnPrint
- CView [MFC], OnUpdate
ms.assetid: 9cff3c56-7564-416b-b9a4-71a9254ed755
ms.openlocfilehash: 4c9623d34320b4489e6c086147cfff1038e95162
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87222892"
---
# <a name="cview-class"></a>Класс CView

Предоставляет базовую функциональность для определяемых пользователем классов представления.

## <a name="syntax"></a>Синтаксис

```
class AFX_NOVTABLE CView : public CWnd
```

## <a name="members"></a>Участники

### <a name="protected-constructors"></a>Защищенные конструкторы

|Имя|Описание|
|----------|-----------------|
|[CView:: CView](#cview)|Формирует объект `CView`.|

### <a name="public-methods"></a>Открытые методы

|Имя|Описание|
|----------|-----------------|
|[CView::D Опрепарепринтинг](#doprepareprinting)|Отображает диалоговое окно Печать и создает контекст устройства печати. вызов при переопределении `OnPreparePrinting` функции члена.|
|[CView:: в документе](#getdocument)|Возвращает документ, связанный с представлением.|
|[CView:: выбранные](#isselected)|Проверяет, выбран ли элемент документа. Требуется для поддержки OLE.|
|[CView:: OnDragEnter](#ondragenter)|Вызывается, когда элемент сначала перетаскивается в область перетаскивания представления.|
|[CView:: OnDragLeave](#ondragleave)|Вызывается, когда перетаскиваемый элемент оставляет область перетаскивания представления.|
|[CView:: OnDragOver](#ondragover)|Вызывается, когда элемент перетаскивается над областью перетаскивания представления.|
|[CView:: Ондрагскролл](#ondragscroll)|Вызывается для определения того, перетаскивается ли курсор в область прокрутки окна.|
|[CView:: OnDrop](#ondrop)|Вызывается, когда элемент был перемещен в область перетаскивания представления, обработчик по умолчанию.|
|[CView:: Ондропекс](#ondropex)|Вызывается, когда элемент был перемещен в область перетаскивания представления (основной обработчик).|
|[CView:: Онинитиалупдате](#oninitialupdate)|Вызывается после первого присоединения представления к документу.|
|[CView:: Онпрепаредк](#onpreparedc)|Вызывается перед `OnDraw` вызовом функции-члена для отображения экрана или `OnPrint` вызовом функции-члена для печати или предварительного просмотра печати.|
|[CView:: OnScroll](#onscroll)|Вызывается, когда элементы OLE перетаскиваются за границы представления.|
|[CView:: Онскроллби](#onscrollby)|Вызывается, когда представление, содержащее активные элементы OLE на месте, прокручивается.|

### <a name="protected-methods"></a>Защищенные методы

|Имя|Описание|
|----------|-----------------|
|[CView:: Онактиватефраме](#onactivateframe)|Вызывается, когда окно фрейма, содержащее представление, активируется или деактивируется.|
|[CView:: Онактиватевиев](#onactivateview)|Вызывается при активации представления.|
|[CView::OnBeginPrinting](#onbeginprinting)|Вызывается при запуске задания печати; Переопределение для выделения ресурсов интерфейса графических устройств (GDI).|
|[CView:: OnDraw](#ondraw)|Вызывается для отрисовки изображения документа для экрана, печати или предварительного просмотра печати. Требуется реализация.|
|[CView:: Онендпринтинг](#onendprinting)|Вызывается при завершении задания печати; Переопределение для отмены выделения ресурсов GDI.|
|[CView:: Онендпринтпревиев](#onendprintpreview)|Вызывается при выходе из режима предварительного просмотра.|
|[CView:: Онпрепарепринтинг](#onprepareprinting)|Вызывается перед печатью или предварительным просмотром документа; Переопределение для инициализации диалогового окна "Печать".|
|[CView:: OnPrint](#onprint)|Вызывается для печати или предварительного просмотра страницы документа.|
|[CView:: OnUpdate](#onupdate)|Вызывается для уведомления представления о том, что документ был изменен.|

## <a name="remarks"></a>Примечания

Представление прикрепляется к документу и выступает в качестве посредника между документом и пользователем: представление визуализирует изображение документа на экране или на принтере и интерпретирует ввод пользователя как операции над документом.

Представление — это дочерний элемент окна фрейма. Несколько представлений могут совместно использовать окно фрейма, как в случае окна разделителя. Связь между классом представления, классом окна фрейма и классом документа устанавливается `CDocTemplate` объектом. Когда пользователь открывает новое окно или разделяет существующее, платформа создает новое представление и прикрепляет его к документу.

Представление может быть присоединено только к одному документу, но документ может иметь несколько присоединенных к нему представлений, например, если документ отображается в окне разделителя или в нескольких дочерних окнах в приложении многодокументного интерфейса (MDI). Приложение может поддерживать различные типы представлений для конкретного типа документа. Например, программа обработки текста может предоставить как полное текстовое представление документа, так и представление структуры, в котором отображаются только заголовки разделов. Эти различные типы представлений могут быть помещены в отдельные окна фрейма или в отдельные области одного окна фрейма, если используется окно-разделитель.

Представление может отвечать за обработку нескольких различных типов входных данных, таких как ввод с клавиатуры, ввод мыши или ввод с помощью перетаскивания, а также команд меню, панелей инструментов или полос прокрутки. Представление получает команды, перенаправляемые его окном фрейма. Если представление не обрабатывает данную команду, оно пересылает команду связанному с ним документу. Как и для всех целевых объектов команды, представление обрабатывает сообщения через схему сообщений.

Представление отвечает за отображение и изменение данных документа, но не на его хранение. В документе представлено представление с необходимыми сведениями о его данных. Можно предоставить представление доступ к элементам данных документа напрямую или предоставить функции элементов в классе документа для вызова классом представления.

При изменении данных документа представление, ответственное за изменения, обычно вызывает функцию [CDocument:: UpdateAllViews](../../mfc/reference/cdocument-class.md#updateallviews) для документа, которая уведомляет все остальные представления, вызывая `OnUpdate` функцию-член для каждого из них. Реализация по умолчанию `OnUpdate` делает недействительным всю клиентскую область представления. Его можно переопределить, чтобы сделать недействительными только те регионы клиентской области, которые соответствуют измененным частям документа.

Чтобы использовать `CView` , сделайте класс производным от него и реализуйте `OnDraw` функцию-член для отображения экрана. Также можно использовать `OnDraw` для печати и предварительного просмотра печати. Платформа обрабатывает цикл печати для печати и предварительного просмотра документа.

Представление обрабатывает сообщения на полосе прокрутки с помощью функций-членов [CWnd:: онхскролл](../../mfc/reference/cwnd-class.md#onhscroll) и [CWnd:: онвскролл](../../mfc/reference/cwnd-class.md#onvscroll) . В этих функциях можно реализовать обработку сообщений с помощью полосы прокрутки или же можно использовать `CView` производный класс [кскроллвиев](../../mfc/reference/cscrollview-class.md) для обработки прокрутки.

Кроме `CScrollView` того, Библиотека Microsoft Foundation Class предоставляет девять других классов, производных от `CView` :

- [Кктрлвиев](../../mfc/reference/cctrlview-class.md)— представление, которое позволяет использовать архитектуру представления документа с элементами управления "дерево", "список" и "форматированный".

- [CDaoRecordView](../../mfc/reference/cdaorecordview-class.md)— представление, которое отображает записи базы данных в элементах управления диалоговых окон.

- [CEditView](../../mfc/reference/ceditview-class.md)— представление, предоставляющее простой многострочный текстовый редактор. Объект можно использовать `CEditView` в качестве элемента управления в диалоговом окне, а также в представлении документа.

- [CFormView](../../mfc/reference/cformview-class.md)— прокручиваемое представление, содержащее элементы управления "диалоговое окно" и основанное на ресурсе шаблона диалогового окна.

- [CListView](../../mfc/reference/clistview-class.md)— представление, которое позволяет использовать архитектуру представления документа с элементами управления "список".

- [CRecordView](../../mfc/reference/crecordview-class.md)— представление, которое отображает записи базы данных в элементах управления диалоговых окон.

- [CRichEditView](../../mfc/reference/cricheditview-class.md)— представление, которое позволяет использовать архитектуру представления документа с элементами управления Rich Edit.

- [Кскроллвиев](../../mfc/reference/cscrollview-class.md)— представление, которое автоматически обеспечивает поддержку прокрутки.

- [CTreeView](../../mfc/reference/ctreeview-class.md)— представление, которое позволяет использовать архитектуру представления документа с элементами управления "дерево".

`CView`Класс также имеет производный класс реализации с именем `CPreviewView` , который используется платформой для предварительного просмотра. Этот класс обеспечивает поддержку функций, уникальных для окна предварительного просмотра, таких как панель инструментов, просмотр одной или двойной страницы и увеличение масштаба, т. е. увеличение изображения с предварительным просмотром. Вам не нужно вызывать или переопределять функции- `CPreviewView` члены функций, если вы не хотите реализовывать собственный интерфейс для предварительного просмотра (например, если требуется поддержка редактирования в режиме предварительного просмотра). Дополнительные сведения об использовании `CView` см. в разделе [архитектура документов и представлений](../../mfc/document-view-architecture.md) и [Печать](../../mfc/printing.md). Кроме того, дополнительные сведения о настройке предварительного просмотра печати см. в [техническом примечании 30](../../mfc/tn030-customizing-printing-and-print-preview.md) .

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CCmdTarget](../../mfc/reference/ccmdtarget-class.md)

[CWnd](../../mfc/reference/cwnd-class.md)

`CView`

## <a name="requirements"></a>Требования

**Заголовок:** afxwin.h

## <a name="cviewcview"></a><a name="cview"></a>CView:: CView

Формирует объект `CView`.

```
CView();
```

### <a name="remarks"></a>Примечания

Платформа вызывает конструктор при создании нового окна фрейма или при разбиении окна. Переопределите функцию-член [онинитиалупдате](#oninitialupdate) для инициализации представления после присоединения документа.

## <a name="cviewdoprepareprinting"></a><a name="doprepareprinting"></a>CView::D Опрепарепринтинг

Вызовите эту функцию из переопределения [онпрепарепринтинг](#onprepareprinting) , чтобы вызвать диалоговое окно «Печать» и создать контекст печатающего устройства.

```
BOOL DoPreparePrinting(CPrintInfo* pInfo);
```

### <a name="parameters"></a>Параметры

*пинфо*<br/>
Указывает на структуру [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , описывающую текущее задание печати.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если может начаться печать или предварительный просмотр печати; 0, если операция была отменена.

### <a name="remarks"></a>Примечания

Поведение этой функции зависит от того, вызывается ли он для печати или предварительного просмотра (задается `m_bPreview` членом параметра *пинфо* ). Если файл печатается, эта функция вызывает диалоговое окно Печать, используя значения в структуре [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , на которую *пинфо* указывает. После того, как пользователь закрыл диалоговое окно, функция создает контекст печатающего устройства на основе параметров, указанных пользователем в диалоговом окне, и возвращает контекст этого устройства с помощью параметра *пинфо* . Этот контекст устройства используется для печати документа.

При предварительном просмотре файла эта функция создает контекст устройства печати, используя текущие параметры принтера. Этот контекст устройства используется для имитации принтера во время предварительной версии.

## <a name="cviewgetdocument"></a><a name="getdocument"></a>CView:: в документе

Вызовите эту функцию, чтобы получить указатель на документ представления.

```
CDocument* GetDocument() const;
```

### <a name="return-value"></a>Возвращаемое значение

Указатель на объект [CDocument](../../mfc/reference/cdocument-class.md) , связанный с представлением. Значение NULL, если представление не присоединено к документу.

### <a name="remarks"></a>Примечания

Это позволяет вызывать функции элементов документа.

## <a name="cviewisselected"></a><a name="isselected"></a>CView:: выбранные

Вызвано платформой для проверки того, выбран ли указанный элемент документа.

```
virtual BOOL IsSelected(const CObject* pDocItem) const;
```

### <a name="parameters"></a>Параметры

*пдоЦитем*<br/>
Указывает на проверяемый элемент документа.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если выбран указанный элемент документа. в противном случае — 0.

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции возвращает значение FALSE. Переопределите эту функцию, если реализуется выбор с помощью объектов [кдоЦитем](../../mfc/reference/cdocitem-class.md) . Эту функцию необходимо переопределить, если представление содержит элементы OLE.

## <a name="cviewonactivateframe"></a><a name="onactivateframe"></a>CView:: Онактиватефраме

Вызывается структурой при активации или отключении окна фрейма, содержащего представление.

```
virtual void OnActivateFrame(
    UINT nState,
    CFrameWnd* pFrameWnd);
```

### <a name="parameters"></a>Параметры

*Nсведения*<br/>
Указывает, активируется ли окно фрейма или деактивируется. Может иметь одно из следующих значений.

- WA_INACTIVE деактивируется окно фрейма.

- WA_ACTIVE окно фрейма активируется с помощью какого-либо метода, отличного от щелчка мышью (например, с помощью интерфейса клавиатуры для выбора окна).

- WA_CLICKACTIVE, что окно фрейма активируется щелчком мыши

*пфрамевнд*<br/>
Указатель на окно фрейма, которое должно быть активировано.

### <a name="remarks"></a>Примечания

Переопределите эту функцию-член, если требуется выполнить специальную обработку при активации или деактивации окна фрейма, связанного с представлением. Например, объект [CFormView](../../mfc/reference/cformview-class.md) выполняет это переопределение при сохранении и восстановлении элемента управления, имеющего фокус.

## <a name="cviewonactivateview"></a><a name="onactivateview"></a>CView:: Онактиватевиев

Вызывается структурой при активации или отключении представления.

```
virtual void OnActivateView(
    BOOL bActivate,
    CView* pActivateView,
    CView* pDeactiveView);
```

### <a name="parameters"></a>Параметры

*bActivate*<br/>
Указывает, активируется ли представление или деактивируется.

*пактиватевиев*<br/>
Указывает на активируемый объект View.

*пдеактивевиев*<br/>
Указывает на Деактивируемый объект представления.

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции устанавливает фокус на активируемое представление. Переопределите эту функцию, если требуется выполнить специальную обработку при активации или отключении представления. Например, если вы хотите предоставить специальные визуальные подсказки, которые отличают активное представление от неактивных представлений, необходимо изучить параметр *бактивате* и соответствующим образом обновить внешний вид представления.

Параметры *пактиватевиев* и *пдеактивевиев* указывают на одно и то же представление, если главное окно приложения активируется без изменений в активном представлении — например, если фокус переносится из другого приложения в это, а не из одного представления в другое в приложении или при переключении между дочерними окнами MDI. Это позволяет представлениям повторно реализовывать свою палитру при необходимости.

Эти параметры различаются, когда метод [CFrameWnd:: сетактивевиев](../../mfc/reference/cframewnd-class.md#setactiveview) вызывается с представлением, отличным от возвращающего значение [CFrameWnd:: жетактивевиев](../../mfc/reference/cframewnd-class.md#getactiveview) . Чаще всего это происходит с окнами разделителей.

## <a name="cviewonbeginprinting"></a><a name="onbeginprinting"></a>CView:: Онбегинпринтинг

Вызывается платформой в начале задания печати или предварительного просмотра после вызова `OnPreparePrinting` .

```
virtual void OnBeginPrinting(
    CDC* pDC,
    CPrintInfo* pInfo);
```

### <a name="parameters"></a>Параметры

*Хозяин*<br/>
Указывает на контекст принтера.

*пинфо*<br/>
Указывает на структуру [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , описывающую текущее задание печати.

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции не выполняет никаких действий. Переопределите эту функцию, чтобы выделить все ресурсы GDI, такие как перья или шрифты, специально для печати. Выберите объекты GDI в контексте устройства в функции-члене [OnPrint](#onprint) для каждой страницы, использующей их. Если вы применяете один и тот же объект представления для вывода изображения на экран и печати, используйте отдельные переменные для ресурсов GDI, необходимых для каждого отображения. Это позволит обновлять экран во время печати.

Эту функцию также можно использовать для инициализаций, которые зависят от свойств контекста принтера. Например, число страниц, необходимых для печати документа, может зависеть от параметров, заданных пользователем в диалоговом окне печати (например, длина страницы). В таком случае нельзя указать длину документа в функции-члене [OnPreparePrinting](#onprepareprinting) (как это обычно делается). Необходимо дождаться создания контекста принтера на основе параметров в диалоговом окне. [OnBeginPrinting](#onbeginprinting) — это первая переопределяемая функция, предоставляющая доступ к объекту [CDC](../../mfc/reference/cdc-class.md) , представляющему контекст устройства принтера. Из этой функции можно задавать длину документа. Обратите внимание, что если к этому моменту длина документа не указана, во время предварительного просмотра полоса прокрутки отображаться не будет.

## <a name="cviewondragenter"></a><a name="ondragenter"></a>CView:: OnDragEnter

Вызывается структурой при первом входе мыши в область без прокрутки окна назначения перетаскивания.

```
virtual DROPEFFECT OnDragEnter(
    COleDataObject* pDataObject,
    DWORD dwKeyState,
    CPoint point);
```

### <a name="parameters"></a>Параметры

*pDataObject*<br/>
Указывает на [коледатаобжект](../../mfc/reference/coledataobject-class.md) , который перетаскивается в область перетаскивания представления.

*двкэйстате*<br/>
Содержит состояние клавиш модификатора. Это сочетание любого числа следующих: MK_CONTROL, MK_SHIFT, MK_ALT, MK_LBUTTON, MK_MBUTTON и MK_RBUTTON.

*точки*<br/>
Текущая координата мыши относительно клиентской области представления.

### <a name="return-value"></a>Возвращаемое значение

Значение из перечисляемого типа ДРОПЕФФЕКТ, которое указывает тип удаления, который может произойти, если пользователь отбросил объект в этой позиции. Тип перетаскивания обычно зависит от текущего состояния ключа, указанного параметром *двкэйстате*. Стандартное сопоставление кэйстатес со значениями ДРОПЕФФЕКТ:

- DROPEFFECT_NONE в этом окне невозможно удалить объект данных.

- DROPEFFECT_LINK для MK_CONTROL &#124; MK_SHIFT создает связь между объектом и его сервером.

- DROPEFFECT_COPY для MK_CONTROL создает копию удаленного объекта.

- DROPEFFECT_MOVE для MK_ALT создает копию удаленного объекта и удаляет исходный объект. Обычно это режим перетаскивания по умолчанию, когда представление может принять этот объект данных.

Дополнительные сведения см. в примере [OCLIENT](../../overview/visual-cpp-samples.md)"примеры использования MFC".

### <a name="remarks"></a>Примечания

Реализация по умолчанию заключается в том, чтобы ничего не делать и возвращать DROPEFFECT_NONE.

Переопределите эту функцию, чтобы подготовиться к последующим вызовам функции члена [OnDragOver](#ondragover) . Все данные, необходимые для объекта данных, должны быть получены в это время для последующего использования в `OnDragOver` функции члена. Это представление также должно быть Обновлено, чтобы дать пользователю визуальную обратную связь. Дополнительные сведения см. в разделе [OLE перетаскивание: реализация целевого объекта перетаскивания](../../mfc/drag-and-drop-ole.md#implement-a-drop-target).

## <a name="cviewondragleave"></a><a name="ondragleave"></a>CView:: OnDragLeave

Вызывается платформой во время операции перетаскивания, когда мышь перемещается из допустимой области перетаскивания для этого окна.

```
virtual void OnDragLeave();
```

### <a name="remarks"></a>Примечания

Переопределите эту функцию, если текущему представлению необходимо очистить все действия, выполненные во время вызовов [OnDragEnter](#ondragenter) или [OnDragOver](#ondragover) , такие как удаление любых отзывов визуальных пользователей во время перетаскивания и удаления объекта.

## <a name="cviewondragover"></a><a name="ondragover"></a>CView:: OnDragOver

Вызывается платформой во время операции перетаскивания при перемещении мыши по конечному окну перетаскивания.

```
virtual DROPEFFECT OnDragOver(
    COleDataObject* pDataObject,
    DWORD dwKeyState,
    CPoint point);
```

### <a name="parameters"></a>Параметры

*pDataObject*<br/>
Указывает на [коледатаобжект](../../mfc/reference/coledataobject-class.md) , который перетаскивается на целевой объект перетаскивания.

*двкэйстате*<br/>
Содержит состояние клавиш модификатора. Это сочетание любого числа следующих: MK_CONTROL, MK_SHIFT, MK_ALT, MK_LBUTTON, MK_MBUTTON и MK_RBUTTON.

*точки*<br/>
Текущее расположение мыши относительно клиентской области представления.

### <a name="return-value"></a>Возвращаемое значение

Значение из перечисляемого типа ДРОПЕФФЕКТ, которое указывает тип удаления, который может произойти, если пользователь отбросил объект в этой позиции. Тип удаления часто зависит от текущего состояния ключа, как указано в *двкэйстате*. Стандартное сопоставление кэйстатес со значениями ДРОПЕФФЕКТ:

- DROPEFFECT_NONE в этом окне невозможно удалить объект данных.

- DROPEFFECT_LINK для MK_CONTROL &#124; MK_SHIFT создает связь между объектом и его сервером.

- DROPEFFECT_COPY для MK_CONTROL создает копию удаленного объекта.

- DROPEFFECT_MOVE для MK_ALT создает копию удаленного объекта и удаляет исходный объект. Обычно это режим перетаскивания по умолчанию, когда представление может принять объект данных.

Дополнительные сведения см. в примере [OCLIENT](../../overview/visual-cpp-samples.md)"примеры использования MFC".

### <a name="remarks"></a>Примечания

Реализация по умолчанию заключается в том, чтобы ничего не делать и возвращать DROPEFFECT_NONE.

Переопределите эту функцию, чтобы предоставить пользователю визуальную обратную связь во время операции перетаскивания. Так как эта функция вызывается непрерывно, любой код, содержащийся в ней, должен быть максимально оптимизирован. Дополнительные сведения см. в разделе [OLE перетаскивание: реализация целевого объекта перетаскивания](../../mfc/drag-and-drop-ole.md#implement-a-drop-target).

## <a name="cviewondragscroll"></a><a name="ondragscroll"></a>CView:: Ондрагскролл

Вызывается структурой перед вызовом [OnDragEnter](#ondragenter) или [OnDragOver](#ondragover) для определения того, находится ли точка в области прокрутки.

```
virtual DROPEFFECT OnDragScroll(
    DWORD dwKeyState,
    CPoint point);
```

### <a name="parameters"></a>Параметры

*двкэйстате*<br/>
Содержит состояние клавиш модификатора. Это сочетание любого числа следующих: MK_CONTROL, MK_SHIFT, MK_ALT, MK_LBUTTON, MK_MBUTTON и MK_RBUTTON.

*точки*<br/>
Содержит расположение курсора в пикселях относительно экрана.

### <a name="return-value"></a>Возвращаемое значение

Значение из перечисляемого типа ДРОПЕФФЕКТ, которое указывает тип удаления, который может произойти, если пользователь отбросил объект в этой позиции. Тип перетаскивания обычно зависит от текущего состояния ключа, указанного параметром *двкэйстате*. Стандартное сопоставление кэйстатес со значениями ДРОПЕФФЕКТ:

- DROPEFFECT_NONE в этом окне невозможно удалить объект данных.

- DROPEFFECT_LINK для MK_CONTROL &#124; MK_SHIFT создает связь между объектом и его сервером.

- DROPEFFECT_COPY для MK_CONTROL создает копию удаленного объекта.

- DROPEFFECT_MOVE для MK_ALT создает копию удаленного объекта и удаляет исходный объект.

- DROPEFFECT_SCROLL указывает, что операция прокрутки будет выполнена или в целевом представлении.

Дополнительные сведения см. в примере [OCLIENT](../../overview/visual-cpp-samples.md)"примеры использования MFC".

### <a name="remarks"></a>Примечания

Переопределите эту функцию, чтобы обеспечить специальное поведение для этого события. Реализация по умолчанию автоматически прокручивает окна при перетаскивании курсора в область прокрутки по умолчанию внутри границы каждого окна. Дополнительные сведения см. в разделе [OLE перетаскивание: реализация целевого объекта перетаскивания](../../mfc/drag-and-drop-ole.md#implement-a-drop-target).

## <a name="cviewondraw"></a><a name="ondraw"></a>CView:: OnDraw

Вызывается платформой для отрисовки изображения документа.

```
virtual void OnDraw(CDC* pDC) = 0;
```

### <a name="parameters"></a>Параметры

*Хозяин*<br/>
Указывает на контекст устройства, используемый для отрисовки изображения документа.

### <a name="remarks"></a>Примечания

Платформа вызывает эту функцию для выполнения экранного отображения, печати и предварительного просмотра печати, и в каждом случае она передает другой контекст устройства. Реализация по умолчанию отсутствует.

Эта функция должна быть переопределена для отображения представления документа. Вызовы интерфейса графических устройств (GDI) можно выполнять с помощью объекта [CDC](../../mfc/reference/cdc-class.md) , на который указывает параметр *PDC* . Вы можете выбрать ресурсы GDI, например перья или шрифты, в контексте устройства перед рисованием, а затем отменить их выбор. Часто код рисования может быть независимым от устройства; то есть не требуются сведения о типе устройства, на котором отображается изображение.

Чтобы оптимизировать рисование, вызовите функцию-член [ректвисибле](../../mfc/reference/cdc-class.md#rectvisible) контекста устройства, чтобы определить, будет ли нарисован данный прямоугольник. Если необходимо различать нормальные экраны и печать, вызовите функцию «элемент [печати](../../mfc/reference/cdc-class.md#isprinting) » контекста устройства.

## <a name="cviewondrop"></a><a name="ondrop"></a>CView:: OnDrop

Вызывается платформой, когда пользователь отпускает объект данных через допустимую цель перетаскивания.

```
virtual BOOL OnDrop(
    COleDataObject* pDataObject,
    DROPEFFECT dropEffect,
    CPoint point);
```

### <a name="parameters"></a>Параметры

' pDataObject * указывает на [коледатаобжект](../../mfc/reference/coledataobject-class.md) , который удаляется в цель перетаскивания.

*дропеффект*<br/>
Результат перетаскивания, запрошенный пользователем.

- DROPEFFECT_COPY создает копию удаляемого объекта данных.

- DROPEFFECT_MOVE перемещает объект данных в текущее положение мыши.

- DROPEFFECT_LINK создает связь между объектом данных и его сервером.

*точки*<br/>
Текущее расположение мыши относительно клиентской области представления.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если удаление было успешным; в противном случае — 0.

### <a name="remarks"></a>Примечания

Реализация по умолчанию не выполняет никаких действий и возвращает значение FALSE.

Переопределите эту функцию, чтобы реализовать воздействие OLE Drop на клиентскую область представления. Объект данных можно исследовать с помощью *pDataObject* для форматов данных в буфере обмена и данных, отброшенных в указанной точке.

> [!NOTE]
> Платформа не вызывает эту функцию, если в классе представления переопределено значение [ондропекс](#ondropex) .

## <a name="cviewondropex"></a><a name="ondropex"></a>CView:: Ондропекс

Вызывается платформой, когда пользователь отпускает объект данных через допустимую цель перетаскивания.

```
virtual DROPEFFECT OnDropEx(
    COleDataObject* pDataObject,
    DROPEFFECT dropDefault,
    DROPEFFECT dropList,
    CPoint point);
```

### <a name="parameters"></a>Параметры

*pDataObject*<br/>
Указывает на [коледатаобжект](../../mfc/reference/coledataobject-class.md) , который удаляется в цель перетаскивания.

*Событие dropdefault*<br/>
Результат, который пользователь выбрал для операции удаления по умолчанию на основе текущего состояния ключа. Возможно, это DROPEFFECT_NONE. Эффекты перетаскивания обсуждаются в разделе "Примечания".

*дроплист*<br/>
Список эффектов перетаскивания, поддерживаемых источником перетаскивания. Значения эффектов перетаскивания можно комбинировать с помощью побитовой операции OR ( **&#124;**). Эффекты перетаскивания обсуждаются в разделе "Примечания".

*точки*<br/>
Текущее расположение мыши относительно клиентской области представления.

### <a name="return-value"></a>Возвращаемое значение

Результат перетаскивания, полученный в результате попытки удаления в месте, указанном параметром *Point*. Это должно быть одно из значений, указанных в *дропеффектлист*. Эффекты перетаскивания обсуждаются в разделе "Примечания".

### <a name="remarks"></a>Примечания

Реализация по умолчанию заключается в том, чтобы ничего не делать и возвращать фиктивное значение (-1), чтобы указать, что платформа должна вызывать обработчик [OnDrop](#ondrop) .

Переопределите эту функцию, чтобы реализовать воздействие на перетаскивание правой кнопкой мыши. Перетаскивание правой кнопкой мыши при отпускании кнопки мыши обычно выводится меню выбора.

Переопределение `OnDropEx` запроса должно запрашивать правую кнопку мыши. Вы можете вызвать [жеткэйстате](/windows/win32/api/winuser/nf-winuser-getkeystate) или сохранить правое состояние кнопки мыши из обработчика [OnDragEnter](#ondragenter) .

- Если правая кнопка мыши не нажата, переопределение должно отображать всплывающее меню, предлагающее поддержку эффектов перетаскивания источником перетаскивания.

  - Изучите *дроплист* , чтобы определить эффекты перетаскивания, поддерживаемые источником перетаскивания. Включайте только эти действия во всплывающем меню.

  - Используйте [сетменудефаултитем](/windows/win32/api/winuser/nf-winuser-setmenudefaultitem) , чтобы задать действие по умолчанию на основе *событие dropdefault*.

  - Наконец, выполните действие, указанное пользователем во всплывающем меню.

- Если правая кнопка мыши не нажата, переопределение должно обработать его как стандартный запрос на удаление. Используйте результат перетаскивания, указанный в *событие dropdefault*. Кроме того, переопределение может вернуть фиктивное значение (-1), указывающее, что `OnDrop` будет выполнять эту операцию Drop.

Используйте *pDataObject* для проверки `COleDataObject` формата данных в буфере обмена и данных, отброшенных в указанной точке.

Эффекты перетаскивания описывают действие, связанное с операцией Drop. См. следующий список эффектов перетаскивания:

- DROPEFFECT_NONE удаление запрещено.

- DROPEFFECT_COPY выполнить операцию копирования.

- DROPEFFECT_MOVE будет выполнена операция перемещения.

- DROPEFFECT_LINK будет установлена ссылка из удаленных данных в исходные.

- DROPEFFECT_SCROLL указывает на то, что операция перетаскивания будет выполнена или выполняется в целевом объекте.

Дополнительные сведения о настройке команды меню по умолчанию см. в разделе [сетменудефаултитем](/windows/win32/api/winuser/nf-winuser-setmenudefaultitem) в Windows SDK и [Кмену:: жетсафехмену](../../mfc/reference/cmenu-class.md#getsafehmenu) на этом томе.

## <a name="cviewonendprinting"></a><a name="onendprinting"></a>CView:: Онендпринтинг

Вызывается структурой после печати или предварительного просмотра документа.

```
virtual void OnEndPrinting(
    CDC* pDC,
    CPrintInfo* pInfo);
```

### <a name="parameters"></a>Параметры

*Хозяин*<br/>
Указывает на контекст принтера.

*пинфо*<br/>
Указывает на структуру [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , описывающую текущее задание печати.

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции не выполняет никаких действий. Переопределите эту функцию, чтобы освободить все ресурсы GDI, выделенные в функции члена [онбегинпринтинг](#onbeginprinting) .

## <a name="cviewonendprintpreview"></a><a name="onendprintpreview"></a>CView:: Онендпринтпревиев

Вызывается платформой, когда пользователь выходит из режима предварительного просмотра печати.

```
virtual void OnEndPrintPreview(
    CDC* pDC,
    CPrintInfo* pInfo,
    POINT point,
    CPreviewView* pView);
```

### <a name="parameters"></a>Параметры

*Хозяин*<br/>
Указывает на контекст принтера.

*пинфо*<br/>
Указывает на структуру [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , описывающую текущее задание печати.

*точки*<br/>
Указывает точку на странице, которая была последний раз отображалась в режиме предварительного просмотра.

*pView*<br/>
Указывает на объект представления, используемый для предварительного просмотра.

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции вызывает функцию члена [онендпринтинг](#onendprinting) и восстанавливает главное окно фрейма до начала предварительного просмотра. Переопределите эту функцию, чтобы выполнить специальную обработку после завершения режима предварительного просмотра. Например, если требуется сохранить позицию пользователя в документе при переключении из режима предварительного просмотра в нормальный режим отображения, можно прокрутить к позиции, описанной параметром *Point* , и к `m_nCurPage` элементу `CPrintInfo` структуры, на которую указывает параметр *пинфо* .

Всегда вызывайте версию базового класса `OnEndPrintPreview` из переопределения, как правило, в конце функции.

## <a name="cviewoninitialupdate"></a><a name="oninitialupdate"></a>CView:: Онинитиалупдате

Вызывается структурой после первого присоединения представления к документу, но до первоначального отображения представления.

```
virtual void OnInitialUpdate();
```

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции вызывает функцию-член [OnUpdate](#onupdate) без сведений о подсказках (то есть с помощью значений по умолчанию 0 для параметра *лхинт* и NULL для параметра *финт* ). Переопределите эту функцию для выполнения любой однократной инициализации, требующей получения сведений о документе. Например, если приложение имеет документы фиксированного размера, эту функцию можно использовать для инициализации ограничений прокрутки представления в зависимости от размера документа. Если приложение поддерживает документы с переменным размером, используйте [OnUpdate](#onupdate) , чтобы обновлять ограничения прокрутки при каждом изменении документа.

## <a name="cviewonpreparedc"></a><a name="onpreparedc"></a>CView:: Онпрепаредк

Вызывается платформой до вызова функции-члена [OnDraw](#ondraw) для отображения экрана и перед вызовом функции-члена [OnPrint](#onprint) для каждой страницы во время печати или предварительного просмотра печати.

```
virtual void OnPrepareDC(
    CDC* pDC,
    CPrintInfo* pInfo = NULL);
```

### <a name="parameters"></a>Параметры

*Хозяин*<br/>
Указывает на контекст устройства, используемый для отрисовки изображения документа.

*пинфо*<br/>
Указывает на структуру [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , описывающую текущее задание печати, если `OnPrepareDC` вызывается для печати или предварительного просмотра `m_nCurPage` . элемент указывает страницу, подводимую на печать. Этот параметр имеет значение NULL, если `OnPrepareDC` вызывается для отображения на экране.

### <a name="remarks"></a>Примечания

Реализация по умолчанию этой функции не выполняет никаких действий, если функция вызывается для отображения экрана. Однако эта функция переопределяется в производных классах, таких как [кскроллвиев](../../mfc/reference/cscrollview-class.md), для настройки атрибутов контекста устройства; Следовательно, следует всегда вызывать реализацию базового класса в начале переопределения.

Если функция вызывается для печати, то реализация по умолчанию проверяет сведения о странице, хранящиеся в параметре *пинфо* . Если длина документа не указана, `OnPrepareDC` предполагает, что документ является одной страницей длинным и останавливает цикл печати после печати одной страницы. Функция останавливает цикл печати, присвоив `m_bContinuePrinting` элементу структуры значение false.

Переопределите `OnPrepareDC` по одной из следующих причин:

- Для настройки атрибутов контекста устройства, необходимых для указанной страницы. Например, если необходимо задать режим сопоставления или другие характеристики контекста устройства, сделайте это в этой функции.

- Для выполнения разбивки на страницы во время печати. Обычно длина документа указывается при запуске печати с помощью функции члена [онпрепарепринтинг](#onprepareprinting) . Однако если заранее неизвестно, насколько длинным является документ (например, при печати неопределенного количества записей из базы данных), переопределите `OnPrepareDC` для проверки конца документа во время его печати. Если больше нет документа для печати, установите `m_bContinuePrinting` `CPrintInfo` для элемента структуры значение false.

- Для отправки управляющих кодов на принтер по отдельности на странице. Чтобы отправить Escape-коды из `OnPrepareDC` , вызовите `Escape` функцию-член параметра *PDC* .

Вызовите версию базового класса `OnPrepareDC` в начале переопределения.

### <a name="example"></a>Пример

[!code-cpp[NVC_MFCDocView#183](../../mfc/codesnippet/cpp/cview-class_1.cpp)]

## <a name="cviewonprepareprinting"></a><a name="onprepareprinting"></a>CView:: Онпрепарепринтинг

Вызывается платформой перед печатью или предварительным просмотром документа.

```
virtual BOOL OnPreparePrinting(CPrintInfo* pInfo);
```

### <a name="parameters"></a>Параметры

*пинфо*<br/>
Указывает на структуру [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , описывающую текущее задание печати.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение для начала печати; 0, если задание печати было отменено.

### <a name="remarks"></a>Примечания

Реализация по умолчанию не выполняет никаких действий.

Необходимо переопределить эту функцию для включения печати и предварительного просмотра печати. Вызовите функцию члена [метод DoPreparePrinting](#doprepareprinting) , передав ей параметр *пинфо* , а затем возвратите возвращаемое значение. `DoPreparePrinting`отображает диалоговое окно Печать и создает контекст устройства печати. Если требуется инициализировать диалоговое окно печать со значениями, отличными от значений по умолчанию, назначьте значения элементам *пинфо*. Например, если известна длина документа, перед вызовом передайте значение в функцию члена [сетмакспаже](../../mfc/reference/cprintinfo-structure.md#setmaxpage) объекта *пинфо* `DoPreparePrinting` . Это значение отображается в поле Кому: в области диапазон диалогового окна Печать.

`DoPreparePrinting`не отображает диалоговое окно Печать для задания предварительного просмотра. Если требуется обойти диалоговое окно Печать для задания печати, убедитесь, что `m_bPreview` член *ПИНФО* имеет значение false, а затем установите значение true, прежде чем передавать его `DoPreparePrinting` ; сбросьте его в значение false.

Если необходимо выполнить инициализацию, требующие доступа к объекту, `CDC` представляющему контекст устройства печати (например, если необходимо знать размер страницы перед указанием длины документа), переопределите `OnBeginPrinting` функцию-член.

Если необходимо задать значения `m_nNumPreviewPages` `m_strPageDesc` элементов или параметра *пинфо* , сделайте это после вызова `DoPreparePrinting` . `DoPreparePrinting`Функция члена задает `m_nNumPreviewPages` значение, найденное в приложении. INI-файл и задает `m_strPageDesc` для него значение по умолчанию.

### <a name="example"></a>Пример

  Переопределение `OnPreparePrinting` и вызов `DoPreparePrinting` из переопределения, чтобы платформа отображала диалоговое окно «Печать» и выполнит создание контроллера домена принтера.

[!code-cpp[NVC_MFCDocView#184](../../mfc/codesnippet/cpp/cview-class_2.cpp)]

Если известно, сколько страниц содержит документ, задайте максимальную страницу в `OnPreparePrinting` перед вызовом `DoPreparePrinting` . Платформа отобразит максимальный номер страницы в поле «Кому» диалогового окна «Печать».

[!code-cpp[NVC_MFCDocView#185](../../mfc/codesnippet/cpp/cview-class_3.cpp)]

## <a name="cviewonprint"></a><a name="onprint"></a>CView:: OnPrint

Вызывается платформой для печати или предварительного просмотра страницы документа.

```
virtual void OnPrint(
    CDC* pDC,
    CPrintInfo* pInfo);
```

### <a name="parameters"></a>Параметры

*Хозяин*<br/>
Указывает на контекст принтера.

*пинфо*<br/>
Указывает на `CPrintInfo` структуру, описывающую текущее задание печати.

### <a name="remarks"></a>Примечания

Для каждой печатаемой страницы платформа вызывает эту функцию сразу же после вызова функции-члена [онпрепаредк](#onpreparedc) . Печатаемая страница задается `m_nCurPage` членом структуры [CPrintInfo](../../mfc/reference/cprintinfo-structure.md) , на которую указывает *пинфо* . Реализация по умолчанию вызывает функцию члена [OnDraw](#ondraw) и передает ее в контекст устройства печати.

Переопределите эту функцию по любой из следующих причин:

- , Чтобы разрешить печать многостраничных документов. Отображение только части документа, соответствующей текущей печатаемой странице. Если вы используете `OnDraw` для выполнения подготовки к просмотру, можно настроить начало работы с окном просмотра, чтобы печаталась только соответствующая часть документа.

- Чтобы изображение на бумаге отличалось от изображения экрана (то есть если приложение не является режимом WYSIWYG). Вместо передачи контекста устройства принтера в `OnDraw` Используйте контекст устройства для подготовки изображения с помощью атрибутов, не показанных на экране.

   Если для печати требуются ресурсы GDI, которые не используются для отображения на экране, выберите их в контексте устройства, а затем отмените их выбор. Эти ресурсы GDI должны выделяться в [онбегинпринтинг](#onbeginprinting) и выпущены в [онендпринтинг](#onendprinting).

- Для реализации верхних или нижних колонтитулов. Вы по-прежнему можете использовать `OnDraw` для подготовки к просмотру, ограничиваюя область, на которой она может печататься.

Обратите внимание, что `m_rectDraw` элемент параметра *пинфо* описывает печатную область страницы в логических единицах.

Не вызывайте метод `OnPrepareDC` в переопределении `OnPrint` ; платформа вызывается `OnPrepareDC` автоматически перед вызовом `OnPrint` .

### <a name="example"></a>Пример

Ниже приведена схема переопределяемой `OnPrint` функции.

[!code-cpp[NVC_MFCDocView#186](../../mfc/codesnippet/cpp/cview-class_4.cpp)]

Другой пример см. в разделе [CRichEditView::P ринтинсидерект](../../mfc/reference/cricheditview-class.md#printinsiderect).

## <a name="cviewonscroll"></a><a name="onscroll"></a>CView:: OnScroll

Вызывается платформой, чтобы определить, возможно ли прокрутка.

```
virtual BOOL OnScroll(
    UINT nScrollCode,
    UINT nPos,
    BOOL bDoScroll = TRUE);
```

### <a name="parameters"></a>Параметры

*нскроллкоде*<br/>
Штрихкод полосы прокрутки, который указывает на запрос прокрутки пользователя. Этот параметр состоит из двух частей: байт низкого порядка, который определяет тип прокрутки по горизонтали, и старший байт, который определяет тип прокрутки по вертикали:

- SB_BOTTOM прокручивается вниз.

- SB_LINEDOWN прокручивается на одну строку вниз.

- SB_LINEUP прокручивается на одну строку вверх.

- SB_PAGEDOWN прокручивает одну страницу вниз.

- SB_PAGEUP прокручивает на одну страницу вверх.

- SB_THUMBTRACK перетащите ползунок полосы прокрутки в указанную точку. Текущая заданная позицией указывается в *npos*.

- SB_TOP прокручивается вверх.

*nPos*<br/>
Содержит текущую точку прокрутки, если код полосы прокрутки SB_THUMBTRACK; в противном случае он не используется. В зависимости от первоначального диапазона прокрутки *npos* могут быть отрицательными и при необходимости быть приведены к типу **`int`** .

*бдоскролл*<br/>
Определяет, следует ли действительно выполнить указанное действие прокрутки. Если значение — TRUE, прокрутка должна выполняться; Если значение равно FALSE, прокрутка не выполняется.

### <a name="return-value"></a>Возвращаемое значение

Если *бдоскролл* имеет значение true и представление фактически прокручивается, то возвращают ненулевые значения; в противном случае — 0. Если *бдоскролл* имеет значение false, то возвращается возвращаемое значения, если *бдоскролл* имеет значение true, даже если прокрутка не выполняется.

### <a name="remarks"></a>Примечания

В одном случае эта функция вызывается платформой с параметром *бдоскролл* , ИМЕЮЩИМ значение true, когда представление получает сообщение ScrollBar. В этом случае необходимо прокрутить представление. В другом случае эта функция вызывается с параметром *бдоскролл* , для которого задано значение false, когда элемент OLE сначала перетаскивается в область автоматической прокрутки целевого объекта перетаскивания, прежде чем выполняется фактическое прокрутка. В этом случае не следует выполнять фактическую прокрутку представления.

## <a name="cviewonscrollby"></a><a name="onscrollby"></a>CView:: Онскроллби

Вызывается структурой, когда пользователь просматривает область за пределами текущего представления документа, перетаскивая элемент OLE на текущие границы представления или управляя вертикальными или горизонтальными полосами прокрутки.

```
virtual BOOL OnScrollBy(
    CSize sizeScroll,
    BOOL bDoScroll = TRUE);
```

### <a name="parameters"></a>Параметры

*сизескролл*<br/>
Количество пикселей, прокручиваемых по горизонтали и вертикали.

*бдоскролл*<br/>
Определяет, выполняется ли прокрутка представления. Если значение равно TRUE, выполняется прокрутка; Если задано значение FALSE, прокрутка не выполняется.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если представление могло быть прокручено; в противном случае — 0.

### <a name="remarks"></a>Примечания

В производных классах этот метод проверяет, является ли представление прокручено в направлении запрошенного пользователя, а затем при необходимости обновляет новый регион. Эта функция автоматически вызывается методами [CWnd:: онхскролл](../../mfc/reference/cwnd-class.md#onhscroll) и [CWnd:: онвскролл](../../mfc/reference/cwnd-class.md#onvscroll) для выполнения фактического запроса прокрутки.

Реализация по умолчанию этого метода не изменяет представление, но если оно не вызвано, представление не будет прокручиваться в `CScrollView` производном классе.

Если ширина или высота документа превышает 32767 пикселей, прокрутка до 32767 не будет выполнена, так как `OnScrollBy` вызывается с недопустимым аргументом *сизескролл* .

## <a name="cviewonupdate"></a><a name="onupdate"></a>CView:: OnUpdate

Вызвано структурой после изменения документа представления; Эта функция вызывается с помощью функции [CDocument:: UpdateAllViews](../../mfc/reference/cdocument-class.md#updateallviews) и позволяет представлению обновлять свое отображение для отражения этих изменений.

```
virtual void OnUpdate(
    CView* pSender,
    LPARAM lHint,
    CObject* pHint);
```

### <a name="parameters"></a>Параметры

*псендер*<br/>
Указывает на представление, в котором изменен документ, или значение NULL, если все представления должны быть обновлены.

*лхинт*<br/>
Содержит сведения об изменениях.

*финт*<br/>
Указывает объект, в котором хранятся сведения об изменениях.

### <a name="remarks"></a>Примечания

Он также вызывается реализацией [онинитиалупдате](#oninitialupdate)по умолчанию. Реализация по умолчанию делает недействительным всю клиентскую область, помечая ее для рисования при получении следующего сообщения WM_PAINT. Переопределите эту функцию, если требуется обновить только те регионы, которые соответствуют измененным частям документа. Для этого необходимо передать сведения об изменениях с помощью параметров подсказки.

Чтобы использовать *лхинт*, определите специальные значения подсказок, обычно это битовая маска или перечислимый тип, и документ должен передать одно из этих значений. Чтобы использовать *финт*, необходимо получить класс указания от [CObject](../../mfc/reference/cobject-class.md) и передать в документ указатель на объект указания; При переопределении `OnUpdate` используйте функцию-член [CObject:: IsKindOf](../../mfc/reference/cobject-class.md#iskindof) , чтобы определить тип времени выполнения для объекта подсказки.

Обычно не следует выполнять прорисовку непосредственно из `OnUpdate` . Вместо этого определите прямоугольник, описывающий, в координатах устройства область, требующую обновления. Передайте этот прямоугольник в [CWnd:: инвалидатерект](../../mfc/reference/cwnd-class.md#invalidaterect). Это приводит к тому, что рисование будет происходить при следующем получении сообщения [WM_PAINT](/windows/win32/gdi/wm-paint) .

Если *лхинт* равен 0, а *ФИНТ* имеет значение null, документ отправил обобщенное уведомление об обновлении. Если представление получает общее уведомление об обновлении или не может декодировать указания, оно должно сделать всю клиентскую область недействительной.

## <a name="see-also"></a>См. также статью

[Пример МДИДОКВВ для MFC](../../overview/visual-cpp-samples.md)<br/>
[CWnd, класс](../../mfc/reference/cwnd-class.md)<br/>
[Иерархическая диаграмма](../../mfc/hierarchy-chart.md)<br/>
[CWnd, класс](../../mfc/reference/cwnd-class.md)<br/>
[Класс CFrameWnd](../../mfc/reference/cframewnd-class.md)<br/>
[Класс CSplitterWnd](../../mfc/reference/csplitterwnd-class.md)<br/>
[CDC, класс](../../mfc/reference/cdc-class.md)<br/>
[Класс CDocTemplate](../../mfc/reference/cdoctemplate-class.md)<br/>
[Класс CDocument](../../mfc/reference/cdocument-class.md)
