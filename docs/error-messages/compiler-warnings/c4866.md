---
title: Предупреждение компилятора (уровень 4) C4866
ms.date: 09/30/2018
f1_keywords:
- C4866
helpviewer_keywords:
- C4866
ms.openlocfilehash: b66a5a84549f08a6cb034bbd6c6d29a7d6f310ae
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87231940"
---
# <a name="compiler-warning-level-4-c4866"></a>Предупреждение компилятора (уровень 4) C4866

> Компилятор "_File_(*line_number*)" не может применить порядок вычисления слева направо для вызова _operator_name_

## <a name="remarks"></a>Примечания

Начиная с c++ 17, операнды операторов __->\*__ , ** \[ ]**, **>>** и **\<\<** должны вычисляться в порядке слева направо. Есть два случая, в которых компилятор не может обеспечить этот порядок:

- если одно из выражений операндов является объектом, передаваемым по значению, или содержит объект, передаваемый по значению;

- при компиляции с использованием [/clr](../../build/reference/clr-common-language-runtime-compilation.md), когда один из операндов является полем объекта или элемента массива.

Компилятор выдает предупреждение **C4866**, когда он не может обеспечить вычисление слева направо. Это предупреждение создается, только если указать [/std:c++17](../../build/reference/std-specify-language-standard-version.md) или более поздней версии, так как в C++ 17 требуется обеспечить порядок слева направо.

Это предупреждение отключено по умолчанию. Вы можете использовать [/Wall](../../build/reference/compiler-option-warning-level.md) или __/w__*N*__4866__ , чтобы включить его в командной строке как предупреждение уровня *N* , или использовать [предупреждение](../../preprocessor/warning.md) #pragma в исходном файле. Дополнительные сведения см. [в разделе предупреждения компилятора, которые по умолчанию отключены](../../preprocessor/compiler-warnings-that-are-off-by-default.md).

Это предупреждение было введено в Visual Studio 2017 версии 15,9 в результате работы соответствия компилятора стандарту C++ 17. Код, скомпилированный без предупреждений в версиях компилятора перед тем, как Visual Studio 2017 версии 15,9, теперь может создавать **C4866**. Сведения о том, как отключить предупреждения, появившиеся в определенной версии компилятора или более поздней версии, см. в разделе [предупреждения компилятора по версиям компилятора](compiler-warnings-by-compiler-version.md).

Чтобы устранить это предупреждение, сначала определите, требуется ли вычисление слева направо для элементов оператора, например, если вычисление элементов может привести к побочным эффектам, зависящим от порядка. Во многих случаях порядок, в котором оцениваются элементы, не имеет наблюдаемого результата.

Если порядок вычисления должен быть слева направо, определите, можно ли передать элементы по **`const`** ссылке. Это изменение устраняет предупреждение в следующем примере кода.

## <a name="example"></a>Пример

В этом примере создается C4866 и демонстрируется способ исправления:

```cpp
// C4866.cpp
// compile with: /w14866 /std:c++17

class HasCopyConstructor
{
public:
    int x;

    HasCopyConstructor(int x) : x(x) {}
    HasCopyConstructor(const HasCopyConstructor& h) : x(h.x) { }
};

int operator->*(HasCopyConstructor a, HasCopyConstructor b) { return a.x + b.x; }

// This version of operator->* does not trigger the warning:
// int operator->*(const HasCopyConstructor& a, const HasCopyConstructor& b) { return a.x + b.x; }

int main()
{
    HasCopyConstructor a{ 1 };
    HasCopyConstructor b{ 2 };

    a->*b;        // C4866 for call to operator->*
};
```
