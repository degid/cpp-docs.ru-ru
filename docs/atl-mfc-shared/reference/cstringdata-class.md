---
title: Класс Кстрингдата
ms.date: 11/04/2016
f1_keywords:
- CStringData
- ATLSIMPSTR/ATL::CStringData
- ATLSIMPSTR/ATL::AddRef
- ATLSIMPSTR/ATL::data
- ATLSIMPSTR/ATL::IsLocked
- ATLSIMPSTR/ATL::IsShared
- ATLSIMPSTR/ATL::Lock
- ATLSIMPSTR/ATL::Release
- ATLSIMPSTR/ATL::Unlock
- ATLSIMPSTR/ATL::nAllocLength
- ATLSIMPSTR/ATL::nDataLength
- ATLSIMPSTR/ATL::nRefs
- ATLSIMPSTR/ATL::pStringMgr
helpviewer_keywords:
- CStringData class
- shared classes, CStringData
ms.assetid: 4e31b5ca-3dbe-4fd5-b692-8211fbfb2593
ms.openlocfilehash: 140836f45ed2f4088bc0baed67676f93cb268d01
ms.sourcegitcommit: ec6dd97ef3d10b44e0fedaa8e53f41696f49ac7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88832117"
---
# <a name="cstringdata-class"></a>Класс Кстрингдата

Этот класс представляет данные строкового объекта.

## <a name="syntax"></a>Синтаксис

```
struct CStringData
```

## <a name="members"></a>Участники

### <a name="methods"></a>Методы

|Имя|Описание|
|-|-|
|[AddRef](#addref)|Увеличивает значение счетчика ссылок для объекта строковых данных.|
|[data](#data)|Извлекает символьные данные строкового объекта.|
|[IsLocked](#islocked)|Определяет, заблокирован ли буфер связанного строкового объекта.|
|[IsShared](#isshared)|Определяет, является ли буфер связанного строкового объекта в данный момент общим.|
|[Блокировка](#lock)|Блокирует буфер связанного строкового объекта.|
|[Релиз](#release)|Освобождает указанный строковый объект.|
|[Блокирован](#unlock)|Разблокирует буфер связанного строкового объекта.|

### <a name="data-members"></a>Элементы данных

|Имя|Описание|
|-|-|
|[наллокленгс](#nalloclength)|Длина выделенных данных в `XCHAR` s (не включая завершающее значение null)|
|[ндаталенгс](#ndatalength)|Длина используемых в данный момент данных в `XCHAR` s (не включая завершающее значение null)|
|[нрефс](#nrefs)|Текущее число ссылок объекта.|
|[пстрингмгр](#pstringmgr)|Указатель на Диспетчер строк этого объекта строки.|

## <a name="remarks"></a>Примечания

Этот класс должен использоваться только разработчиками, реализующими пользовательские диспетчеры строк. Дополнительные сведения о настраиваемых диспетчерах строк см. в разделе [Управление памятью и CStringT](../../atl-mfc-shared/memory-management-with-cstringt.md) .

Этот класс инкапсулирует различные типы информации и данные, связанные с более высоким строковым объектом, таким как [CStringT](../../atl-mfc-shared/reference/cstringt-class.md), [ксимплестрингт](../../atl-mfc-shared/reference/csimplestringt-class.md)или [CFixedStringT](../../atl-mfc-shared/reference/cfixedstringt-class.md) Objects. Каждый более высокий строковый объект содержит указатель на связанный с ним `CStringData` объект, что позволяет нескольким строковым объектам указывать на один и тот же объект строковых данных. Эта связь представляется счетчиком ссылок ( `nRefs` ) `CStringData` объекта.

> [!NOTE]
> В некоторых случаях строковый тип (например, `CFixedString` ) не будет совместно использовать объект данных строки с более чем одним более высоким строковым объектом. Дополнительные сведения об этом см. в разделе [Управление памятью и CStringT](../../atl-mfc-shared/memory-management-with-cstringt.md).

Эти данные состоят из:

- Диспетчер памяти (типа [иатлстрингмгр](../../atl-mfc-shared/reference/iatlstringmgr-class.md)) строки.

- Текущая длина строки ( [ндаталенгс](#ndatalength)).

- Выделенная длина строки ( [наллокленгс](#nalloclength)). Из соображений производительности это может отличаться от текущей длины строки.

- Текущий счетчик ссылок ( [нрефс](#nrefs)) `CStringData` объекта. Это значение используется при определении количества строковых объектов, совместно использующих один и тот же `CStringData` объект.

- Фактический символьный буфер ( [данные](#data)) строки.

   > [!NOTE]
   > Фактический символьный буфер объекта String выделяется диспетчером строк и добавляется к `CStringData` объекту.

## <a name="requirements"></a>Требования

**Заголовок:** атлсимпстр.h

## <a name="cstringdataaddref"></a><a name="addref"></a> Кстрингдата:: AddRef

Увеличивает значение счетчика ссылок объекта String.

```cpp
void AddRef() throw();
```

### <a name="remarks"></a>Примечания

Увеличивает значение счетчика ссылок объекта String.

> [!NOTE]
> Не вызывайте этот метод для строки с отрицательным числом ссылок, так как отрицательное число указывает, что буфер строки заблокирован.

## <a name="cstringdatadata"></a><a name="data"></a> Кстрингдата::d ATA

Возвращает указатель на символьный буфер строкового объекта.

```cpp
void* data() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Указатель на символьный буфер строкового объекта.

### <a name="remarks"></a>Примечания

Вызовите эту функцию, чтобы вернуть текущий буфер символов связанного строкового объекта.

> [!NOTE]
> Этот буфер не выделяется объектом, `CStringData` но диспетчером строк при необходимости. При выделении буфер добавляется к объекту строковых данных.

## <a name="cstringdataislocked"></a><a name="islocked"></a> Кстрингдата:: NOLOCK

Определяет, заблокирован ли буфер символов.

```
bool IsLocked() const throw();
```

### <a name="return-value"></a>Возвращаемое значение

Возвращает значение TRUE, если буфер заблокирован. в противном случае — FALSE.

### <a name="remarks"></a>Примечания

Вызовите эту функцию, чтобы определить, заблокирован ли в настоящий момент буфер символов строкового объекта.

## <a name="cstringdataisshared"></a><a name="isshared"></a> Кстрингдата:: с общим доступом

Определяет, является ли буфер символов общим.

```
bool IsShared() const throw();
```

### <a name="return-value"></a>Возвращаемое значение

Возвращает значение TRUE, если буфер является общим; в противном случае — FALSE.

### <a name="remarks"></a>Примечания

Вызывайте эту функцию, чтобы определить, является ли буфер символьного объекта строковых данных в настоящее время общим для нескольких строковых объектов.

## <a name="cstringdatalock"></a><a name="lock"></a> Кстрингдата:: Lock

Блокирует буфер символов связанного строкового объекта.

```cpp
void Lock() throw();
```

### <a name="remarks"></a>Примечания

Вызовите эту функцию, чтобы заблокировать символьный буфер объекта строковых данных. Блокировка и разблокировка используется, когда разработчику требуется прямой доступ к символьному буферу. Хороший пример блокировки демонстрируется с помощью методов [локкбуффер](../../atl-mfc-shared/reference/csimplestringt-class.md#lockbuffer) и [унлоккбуффер](../../atl-mfc-shared/reference/csimplestringt-class.md#unlockbuffer) `CSimpleStringT` .

> [!NOTE]
> Буфер символов может быть заблокирован, только если буфер не является общим для больших строковых объектов.

## <a name="cstringdatanalloclength"></a><a name="nalloclength"></a> Кстрингдата:: Наллокленгс

Длина выделенного символьного буфера.

```
int nAllocLength;
```

### <a name="remarks"></a>Примечания

Хранит длину выделенного буфера данных в `XCHAR` s (не включая завершающее значение null).

## <a name="cstringdatandatalength"></a><a name="ndatalength"></a> Кстрингдата:: Ндаталенгс

Текущая длина строкового объекта.

```
int nDataLength;
```

### <a name="remarks"></a>Примечания

Хранит длину используемых в данный момент данных в `XCHAR` s (не включая завершающий символ null).

## <a name="cstringdatanrefs"></a><a name="nrefs"></a> Кстрингдата:: Нрефс

Счетчик ссылок для объекта строковых данных.

```
long nRefs;
```

### <a name="remarks"></a>Примечания

Хранит счетчик ссылок для объекта строковых данных. Это число указывает количество более высоких строковых объектов, связанных с объектом строкового данных. Отрицательное значение указывает, что строковый объект данных в настоящий момент заблокирован.

## <a name="cstringdatapstringmgr"></a><a name="pstringmgr"></a> Кстрингдата::p Стрингмгр

Диспетчер памяти связанного строкового объекта.

```
IAtlStringMgr* pStringMgr;
```

### <a name="remarks"></a>Примечания

Хранит диспетчер памяти для связанного строкового объекта. Дополнительные сведения о диспетчерах памяти и строках см. в разделе [Управление памятью и CStringT](../../atl-mfc-shared/memory-management-with-cstringt.md).

## <a name="cstringdatarelease"></a><a name="release"></a> Кстрингдата:: Release

Уменьшает значение счетчика ссылок для объекта строковых данных.

```cpp
void Release() throw();
```

### <a name="remarks"></a>Примечания

Вызывайте эту функцию для уменьшения счетчика ссылок, освобождая `CStringData` структуру, если число ссылок равно нулю. Это обычно делается при удалении строкового объекта и, следовательно, больше не требуется ссылаться на объект строковых данных.

Например, следующий код вызовет `CStringData::Release` для объекта строкового данных, связанного с `str1` :

[!code-cpp[NVC_ATLMFC_Utilities#104](../../atl-mfc-shared/codesnippet/cpp/cstringdata-class_1.cpp)]

## <a name="cstringdataunlock"></a><a name="unlock"></a> Кстрингдата:: Unlock

Разблокирует буфер символов связанного строкового объекта.

```cpp
void Unlock() throw();
```

### <a name="remarks"></a>Примечания

Вызовите эту функцию, чтобы разблокировать символьный буфер объекта строковых данных. После того как буфер разблокирован, он становится общим и может подсчитываться ссылками.

> [!NOTE]
> Каждый вызов метода `Lock` должен быть сопоставлен с помощью соответствующего вызова `Unlock` .

Блокировка и разблокировка используется, когда разработчик должен убедиться, что строковые данные не являются общими. Хороший пример блокировки демонстрируется с помощью методов [локкбуффер](../../atl-mfc-shared/reference/csimplestringt-class.md#lockbuffer) и [унлоккбуффер](../../atl-mfc-shared/reference/csimplestringt-class.md#unlockbuffer) `CSimpleStringT` .

## <a name="see-also"></a>См. также раздел

[Иерархическая диаграмма](../../mfc/hierarchy-chart.md)<br/>
[Общие классы ATL и MFC](../../atl-mfc-shared/atl-mfc-shared-classes.md)
