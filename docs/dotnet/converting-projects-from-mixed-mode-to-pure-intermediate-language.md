---
title: Преобразование проектов из смешанного режима в чистый промежуточный язык
ms.date: 08/19/2019
helpviewer_keywords:
- intermediate language, mixed-mode applications
- mixed-mode applications
- mixed-mode applications, intermediate language
- projects [C++], converting to intermediate language
ms.assetid: 855f9e3c-4f09-4bfe-8eab-a45f68292be9
ms.openlocfilehash: 8b22f3aaf706fa096f6c25ab8e9fdab6dc512cd8
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80208814"
---
# <a name="converting-projects-from-mixed-mode-to-pure-intermediate-language"></a>Преобразование проектов из смешанного режима в чистый промежуточный язык

Все проекты C++ Visual CLR связываются с библиотеками времени выполнения C по умолчанию. Следовательно, эти проекты классифицируются как приложения в смешанном режиме, так как они объединяют машинный код с кодом, предназначенным для среды CLR (управляемый код). При компиляции они компилируются в промежуточный язык (IL), также известный как язык MSIL.

> [!IMPORTANT]
> Visual Studio 2015 устарела и Visual Studio 2017 больше не поддерживает создание кода **/clr: pure** или **/clr: безопасный** код для приложений CLR. Если требуются сборки в виде чистых или безнадежных сборок, рекомендуется перевести приложение C#в.

Если вы используете более раннюю версию набора инструментов компилятора Майкрософт C++ , поддерживающую **/clr: pure** или **/clr: Сейф**, эту процедуру можно использовать для преобразования кода в чистый MSIL:

### <a name="to-convert-your-mixed-mode-application-into-pure-intermediate-language"></a>Преобразование приложения в смешанном режиме в чистый промежуточный язык

1. Удалите ссылки на [библиотеки времени выполнения C](../c-runtime-library/crt-library-features.md) (CRT):

   1. В cpp – файле, определяющем точку входа приложения, измените точку входа на `Main()`. Использование `Main()` указывает, что проект не связан с CRT.

   2. В обозреватель решений щелкните правой кнопкой мыши проект и выберите в контекстном меню пункт **Свойства** , чтобы открыть страницы свойств для приложения.

   3. На странице свойств " **Расширенный** проект" для **компоновщика**выберите **точку входа** и введите " **Main** " в этом поле.

   4. Для консольных приложений на странице свойств **системного** проекта **компоновщика**выберите поле **подсистема** и измените значение на **консоль (/SUBSYSTEM: Console)** .

      > [!NOTE]
      > Не нужно задавать это свойство для Windows Forms приложений, так как поле **подсистемы** по умолчанию имеет значение **Windows (/SUBSYSTEM: Windows)** .

   5. В *файле stdafx.h*закомментируйте все инструкции `#include`. Например, в консольных приложениях:

      ```cpp
      // #include <iostream>
      // #include <tchar.h>
      ```

       -или-

       Например, в Windows Forms приложениях:

      ```cpp
      // #include <stdlib.h>
      // #include <malloc.h>
      // #include <memory.h>
      // #include <tchar.h>
      ```

   6. Для Windows Forms приложений в Form1. cpp закомментируйте инструкцию `#include`, которая ссылается на Windows.h. Пример:

      ```cpp
      // #include <windows.h>
      ```

2. Добавьте следующий код в файл *stdafx.h*:

   ```cpp
   #ifndef __FLTUSED__
   #define __FLTUSED__
      extern "C" __declspec(selectany) int _fltused=1;
   #endif
   ```

3. Удалите все неуправляемые типы:

   Везде, где это необходимо, замените неуправляемые типы ссылками на структуры из пространства имен [System](/dotnet/api/system) . В следующей таблице перечислены общие управляемые типы.

   |Структура|Description|
   |---------------|-----------------|
   |[Boolean](/dotnet/api/system.boolean)|Представляет логическое значение.|
   |[Byte](/dotnet/api/system.byte)|Представляет 8-разрядное целое число без знака.|
   |[Char](/dotnet/api/system.char)|Представляет символ Юникода.|
   |[DateTime](/dotnet/api/system.datetime)|Представляет текущее время, обычно выраженное как дата и время суток.|
   |[Decimal](/dotnet/api/system.decimal)|Представляет десятичное число.|
   |[Double](/dotnet/api/system.double)|Представляет число двойной точности с плавающей запятой.|
   |[Guid](/dotnet/api/system.guid)|Представляет глобальный уникальный идентификатор (GUID).|
   |[Int16](/dotnet/api/system.int16)|Представляет 16-разрядное целое число со знаком.|
   |[Int32](/dotnet/api/system.int32)|Представляет 32-разрядное целое число со знаком.|
   |[Int64](/dotnet/api/system.int64)|Представляет 64-разрядное целое число со знаком.|
   |[IntPtr](/dotnet/api/system.intptr)|Определяемый платформой тип, который используется для представления указателя или обработчика.|
   |[SByte](/dotnet/api/system.byte)|Представляет 8-разрядное целое число со знаком.|
   |[Один](/dotnet/api/system.single)|Представляет число с плавающей запятой одиночной точности.|
   |[TimeSpan](/dotnet/api/system.timespan)|Представляет интервал времени.|
   |[UInt16](/dotnet/api/system.uint16)|Представляет 16-разрядное целое число без знака.|
   |[UInt32](/dotnet/api/system.uint32)|Представляет 32-разрядное целое число без знака.|
   |[UInt64](/dotnet/api/system.uint64)|Представляет 64-разрядное целое число без знака.|
   |[UIntPtr](/dotnet/api/system.uintptr)|Определяемый платформой тип, который используется для представления указателя или обработчика.|
   |[Void](/dotnet/api/system.void)|Указывает метод, который не возвращает значение. Это значит, что метод имеет тип возвращаемого значения void.|
