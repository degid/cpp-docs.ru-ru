---
title: Общие сведения о среде выполнения с параллелизмом
ms.date: 11/19/2018
helpviewer_keywords:
- Concurrency Runtime, requirements
- Concurrency Runtime, architecture
- Concurrency Runtime, overview
- Concurrency Runtime, lambda expressions
ms.assetid: 56237d96-10b0-494a-9cb4-f5c5090436c5
ms.openlocfilehash: 11035f9e202d964ae91378560b9244cde6d1828b
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87194619"
---
# <a name="overview-of-the-concurrency-runtime"></a>Общие сведения о среде выполнения с параллелизмом

В этом документе содержатся общие сведения о среде выполнения с параллелизмом. Здесь рассматриваются преимущества среды выполнения с параллелизмом, указывается, когда следует ее использовать, и описывается, как ее компоненты взаимодействуют друг с другом, с операционной системой и приложениями.

## <a name="sections"></a><a name="top"></a>Священ

Этот документ содержит следующие разделы.

- [Журнал реализации среда выполнения с параллелизмом](#dlls)

- [Почему важна среда выполнения с параллелизмом](#runtime)

- [Архитектура](#architecture)

- [Лямбда-выражения в C++](#lambda)

- [Требования](#requirements)

## <a name="concurrency-runtime-implementation-history"></a><a name="dlls"></a>Журнал реализации среда выполнения с параллелизмом

В Visual Studio с 2010 по 2013 среда выполнения с параллелизмом был включен в msvcr100.dll с помощью msvcr120.dll.  При рефакторинге UCRT в Visual Studio 2015 эта библиотека DLL была переразделена на три части:

- ucrtbase.dll — API-интерфейс C, поставляемый в Windows 10 и обслуживание с предыдущими версиями с помощью Центр обновления Windows

- vcruntime140.dll – функции поддержки компилятора и среда выполнения EH, поставляемая через Visual Studio

- concrt140.dll — среда выполнения с параллелизмом, поставляемые с помощью Visual Studio. Требуется для параллельных контейнеров и алгоритмов, таких как `concurrency::parallel_for` . Кроме того, STL требует, чтобы эта библиотека DLL в Windows XP была примитивами синхронизации питания, так как в Windows XP отсутствуют переменные условия.

В Visual Studio 2015 и более поздних версиях планировщик задач среды выполнения с параллелизмом более не является планировщиком класса задач и связанных типов в ppltasks.h. Эти типы теперь используют Windows ThreadPool для повышения производительности и взаимодействия с примитивами синхронизации Windows.

## <a name="why-a-runtime-for-concurrency-is-important"></a><a name="runtime"></a>Почему среда выполнения для параллелизма важна

Среда выполнения с параллелизмом обеспечивает единообразие и предсказуемость приложений и компонентов приложений, выполняемых одновременно. Двумя примерами преимуществ среда выполнения с параллелизмом являются *совместное планирование задач* и *совместная блокировка*.

Среда выполнения с параллелизмом использует совместный планировщик задач, реализующий алгоритм переноса нагрузки для эффективного распределения вычислительных ресурсов. Например, рассмотрим приложение, имеющее два потока, управляемых одной средой выполнения. Если один поток завершает свою запланированную задачу, он может разгрузить другой поток. Этот механизм позволяет балансировать общую рабочую нагрузку приложения.

Среда выполнения с параллелизмом также предоставляет примитивы синхронизации, использующие совместное блокирование для синхронизации доступа к ресурсам. Например, рассмотрим задачу, которая должна получить монопольный доступ к общему ресурсу. Выполняя совместное блокирование, среда выполнения может использовать оставшийся квант времени для выполнения другой задачи, пока первая задача ожидает ресурс. Этот механизм обеспечивает максимально эффективное использование вычислительных ресурсов.

[[Top](#top)]

## <a name="architecture"></a><a name="architecture"></a> Архитектура

Среда выполнения с параллелизмом состоит из четырех компонентов: библиотеки параллельных шаблонов (PPL), библиотеки асинхронных агентов, планировщика задач и диспетчера ресурсов. Эти компоненты распределены между операционной системой и приложениями. На следующем рисунке показано взаимодействие компонентов среды выполнения с параллелизмом в операционной системе и приложениях.

**Архитектура среды выполнения с параллелизмом**

![Архитектура параллельной среды выполнения](../../parallel/concrt/media/concurrencyrun.png "Архитектура параллельной среды выполнения")

> [!IMPORTANT]
> Компоненты планировщик задач и диспетчер ресурсов недоступны в приложении универсальная платформа Windows (UWP), а также при использовании класса Task или других типов в из ppltasks.h.

Среда выполнения с параллелизмом обладает высокой степенью гибкости *, т.* е. можно сочетать существующую функциональность для получения дополнительных возможностей. Среда выполнения с параллелизмом объединяет множество возможностей, таких как параллельные алгоритмы, от компонентов более низкого уровня.

Среда выполнения с параллелизмом также предоставляет примитивы синхронизации, использующие совместное блокирование для синхронизации доступа к ресурсам. Дополнительные сведения об этих примитивах синхронизации см. в разделе [структуры данных синхронизации](../../parallel/concrt/synchronization-data-structures.md).

В следующих разделах представлен краткий обзор возможностей каждого компонента и рекомендации по его использованию.

### <a name="parallel-patterns-library"></a>Библиотека параллельных шаблонов

Библиотека параллельных шаблонов (PPL) предоставляет алгоритмы и контейнеры общего назначения для выполнения детального параллелизма. PPL обеспечивает *императивный параллелизм данных* , предоставляя параллельные алгоритмы, которые распределяют вычисления по коллекциям или наборам данных в вычислительных ресурсах. Он также обеспечивает *параллелизм задач* , предоставляя объекты задач, которые распределяют несколько независимых операций между вычислительными ресурсами.

Используйте библиотеку параллельных шаблонов при наличии локальных вычислений, которые могут использовать преимущества параллельного выполнения. Например, можно использовать алгоритм [параллелизма::parallel_for](reference/concurrency-namespace-functions.md#parallel_for) для преобразования существующего **`for`** цикла в параллельный.

Дополнительные сведения о библиотеке параллельных шаблонов см. в разделе [Библиотека параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md).

### <a name="asynchronous-agents-library"></a>библиотеку асинхронных агентов

Библиотека асинхронных агентов (или просто *Библиотека агентов*) предоставляет модель программирования на основе субъектов и интерфейсы передачи сообщений для недетализированных потоков данных и задач конвейеризации. Асинхронные агенты позволяют эффективно использовать задержку, выполняя работу, пока другие компоненты ожидают данные.

Используйте библиотеку агентов, если существует несколько сущностей, асинхронно взаимодействующих друг с другом. Например, можно создать агент, который читает данные из файла или сетевого подключения, а затем использует интерфейсы передачи сообщений для отправки этих данных другому агенту.

Дополнительные сведения о библиотеке агентов см. в разделе [Библиотека асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md).

### <a name="task-scheduler"></a>Планировщик заданий

Планировщик задач планирует и координирует задачи во время выполнения. Планировщик задач является совместным и использует алгоритм переноса нагрузки для максимально эффективного использования вычислительных ресурсов.

Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, поэтому нет необходимости управлять деталями инфраструктуры. Однако для удовлетворения качественных требований приложения можно также предоставить собственную политику планирования или связать конкретные планировщики с конкретными задачами.

Дополнительные сведения о планировщик задач см. в разделе [планировщик задач](../../parallel/concrt/task-scheduler-concurrency-runtime.md).

### <a name="resource-manager"></a>Resource Manager

Роли диспетчера ресурсов заключается в управлении вычислительными ресурсами, такими как процессоры и память. Диспетчер ресурсов реагирует на изменение рабочих нагрузок во время выполнения, назначая ресурсы тем нагрузкам, где они могут быть наиболее эффективными.

Диспетчер ресурсов выступает в качестве абстракции вычислительных ресурсов и в основном взаимодействует с планировщиком задач. Хотя диспетчер ресурсов можно использовать для точной настройки производительности библиотек и приложений, обычно используются функциональные возможности, предоставляемые библиотекой параллельных шаблонов, библиотекой агентов и планировщиком задач. Эти библиотеки используют диспетчер ресурсов для динамической балансировки ресурсов при изменении рабочей нагрузки.

[[Top](#top)]

## <a name="c-lambda-expressions"></a><a name="lambda"></a>Лямбда-выражения C++

Многие типы и алгоритмы, определяемые средой выполнения с параллелизмом, реализованы как шаблоны C++. Некоторые из этих типов и алгоритмов принимают в качестве параметра подпрограмму, которая выполняет работу. Этот параметр может быть лямбда-функцией, объектом функции или указателем функции. Эти сущности также называются *рабочими функциями* или *рабочими подпрограммами*.

Лямбда-выражения — важный новый компонент языка Visual C++, так как они позволяют в сжатой форме определять рабочие возможности для параллельной обработки. Объекты функций и указатели функций позволяют использовать среду выполнения с параллелизмом с существующим кодом. Тем не менее рекомендуется использовать лямбда-выражения при написании нового кода из-за преимуществ безопасности и производительности, которые они предоставляют.

В следующем примере сравнивается синтаксис лямбда-функций, объектов функций и указателей функций в нескольких вызовах алгоритма [concurrency::parallel_for_each](reference/concurrency-namespace-functions.md#parallel_for_each) . Каждый вызов `parallel_for_each` использует другую методику для расчета квадрата каждого элемента в объекте [std:: Array](../../standard-library/array-class-stl.md) .

[!code-cpp[concrt-comparing-work-functions#1](../../parallel/concrt/codesnippet/cpp/overview-of-the-concurrency-runtime_1.cpp)]

**Выходные данные**

```Output
1
256
6561
65536
390625
```

Дополнительные сведения о лямбда-функциях в C++ см. в разделе [лямбда-выражения](../../cpp/lambda-expressions-in-cpp.md).

[[Top](#top)]

## <a name="requirements"></a><a name="requirements"></a> Требования

В следующей таблице показаны файлы заголовков, связанные с каждым компонентом среды выполнения с параллелизмом.

|Компонент|Файлы заголовков|
|---------------|------------------|
|Библиотека параллельных шаблонов|ppl.h<br /><br /> concurrent_queue.h<br /><br /> concurrent_vector.h|
|библиотеку асинхронных агентов|agents.h|
|Планировщик заданий|concrt.h|
|Resource Manager|concrtrm.h|

Среда выполнения с параллелизмом объявляется в пространстве имен [Concurrency](../../parallel/concrt/reference/concurrency-namespace.md) . (Можно также использовать [параллелизм](../../parallel/concrt/reference/concurrency-namespace.md), который является псевдонимом для этого пространства имен.) `concurrency::details`Пространство имен поддерживает платформу среда выполнения с параллелизмом и не предназначено для непосредственного использования в коде.

Среда выполнения с параллелизмом предоставляется как часть библиотеки времени выполнения C (CRT). Дополнительные сведения о создании приложения, использующего CRT, см. в разделе [функции библиотеки CRT](../../c-runtime-library/crt-library-features.md).

[[Top](#top)]
