---
title: Структура IVirtualProcessorRoot
ms.date: 11/04/2016
f1_keywords:
- IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Activate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Deactivate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::EnsureAllTasksVisible
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::GetId
helpviewer_keywords:
- IVirtualProcessorRoot structure
ms.assetid: 5ef371b8-9e4f-4fef-bb0d-49099693dd2b
ms.openlocfilehash: 869d51144b686dd684f62b337bb90eff8a9a5589
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87193956"
---
# <a name="ivirtualprocessorroot-structure"></a>Структура IVirtualProcessorRoot

Абстракция для аппаратного потока, в котором может выполняться прокси-поток.

## <a name="syntax"></a>Синтаксис

```cpp
struct IVirtualProcessorRoot : public IExecutionResource;
```

## <a name="members"></a>Участники

### <a name="public-methods"></a>Открытые методы

|Имя|Описание|
|----------|-----------------|
|[IVirtualProcessorRoot::Activate](#activate)|Приводит к тому, что прокси-поток, связанный с интерфейсом контекста выполнения `pContext` , начинает выполнение на этом корне виртуального процессора.|
|[IVirtualProcessorRoot::Deactivate](#deactivate)|Приводит к тому, что прокси-сервер потока, выполняемый в этом корне виртуального процессора, прекратит отправку контекста выполнения. Прокси-сервер потока продолжит выполнение при вызове `Activate` метода.|
|[IVirtualProcessorRoot::EnsureAllTasksVisible](#ensurealltasksvisible)|Приводит к тому, что данные, хранящиеся в иерархии памяти отдельных процессоров, становятся видимыми для всех процессоров в системе. Это гарантирует, что на всех процессорах будет выполнена полная граница памяти, прежде чем метод вернет значение.|
|[IVirtualProcessorRoot::GetId](#getid)|Возвращает уникальный идентификатор для корня виртуального процессора.|

## <a name="remarks"></a>Примечания

С каждым корнем виртуального процессора связан ресурс выполнения. `IVirtualProcessorRoot`Интерфейс наследуется от интерфейса [IExecutionResource](iexecutionresource-structure.md) . Несколько корней виртуального процессора может соответствовать одному и тому же базовому аппаратному потоку.

Диспетчер ресурсов предоставляет для планировщиков корни виртуального процессора в ответ на запросы ресурсов. Планировщик может использовать корневой виртуальный процессор для выполнения работы, активируя его с помощью контекста выполнения.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[IExecutionResource](iexecutionresource-structure.md)

`IVirtualProcessorRoot`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm.h

**Пространство имен:** concurrency

## <a name="ivirtualprocessorrootactivate-method"></a><a name="activate"></a>Метод IVirtualProcessorRoot::Activate

Приводит к тому, что прокси-поток, связанный с интерфейсом контекста выполнения `pContext` , начинает выполнение на этом корне виртуального процессора.

```cpp
virtual void Activate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Интерфейс к контексту выполнения, который будет отправлен в этом корне виртуального процессора.

### <a name="remarks"></a>Примечания

диспетчер ресурсов будет предоставлять прокси-поток, если он не связан с интерфейсом контекста выполнения`pContext`

`Activate`Метод можно использовать для запуска работы с новым корнем виртуального процессора, возвращенного диспетчер ресурсов, или для возобновления прокси-сервера потока на корневом виртуальном процессоре, который был деактивирован или будет отключен. Дополнительные сведения о деактивации см. в разделе [IVirtualProcessorRoot::Deactivate](#deactivate) . При возобновлении деактивированного корня виртуального процессора параметр `pContext` должен совпадать с параметром, используемым для деактивации корня виртуального процессора.

После первой активации корня виртуального процессора последующие пары вызовов `Deactivate` и `Activate` могут состязания друг с другом. Это означает, что диспетчер ресурсов может получить вызов `Activate` до того, как он получит вызов, `Deactivate` предназначенный для.

При активации корня виртуального процессора вы сообщаете диспетчер ресурсов, что этот корень виртуального процессора в данный момент занят с работой. Если вашему планировщику не удается найти какую-либо работу для выполнения в этом корне, ожидается вызов `Deactivate` метода, который информирует диспетчер ресурсов о том, что корень виртуального процессора бездействует. Диспетчер ресурсов использует эти данные для балансировки нагрузки системы.

`invalid_argument`Если аргумент имеет значение, создается исключение `pContext` `NULL` .

`invalid_operation`Если аргумент не `pContext` представляет контекст выполнения, который был последним передан этим корнем виртуального процессора, создается исключение.

Процедура активации корня виртуального процессора увеличивает уровень подписки базового аппаратного потока на единицу. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="ivirtualprocessorrootdeactivate-method"></a><a name="deactivate"></a>IVirtualProcessorRoot: метод:Deactivate

Приводит к тому, что прокси-сервер потока, выполняемый в этом корне виртуального процессора, прекратит отправку контекста выполнения. Прокси-сервер потока продолжит выполнение при вызове `Activate` метода.

```cpp
virtual bool Deactivate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в данный момент отправляется этим корнем.

### <a name="return-value"></a>Возвращаемое значение

Логическое значение. Значение **`true`** указывает, что прокси-поток, возвращенный `Deactivate` методом в ответ на вызов `Activate` метода. Значение **`false`** указывает, что прокси-поток, возвращенный методом в ответ на событие уведомления в Диспетчер ресурсов. В планировщике потоков, планируемом для пользовательского режима (UMS), это означает, что элементы появлялись в списке завершения планировщика, и для их обработки требуется планировщик.

### <a name="remarks"></a>Примечания

Используйте этот метод, чтобы временно остановить выполнение корня виртуального процессора, если не удается найти какую-либо работу в планировщике. Вызов `Deactivate` метода должен исходить из `Dispatch` метода контекста выполнения, с которым последний раз был активирован корневой виртуальный процессор. Иными словами, прокси-сервер потока, вызывающий `Deactivate` метод, должен быть тем, который в данный момент выполняется в корне виртуального процессора. Вызов метода для корня виртуального процессора, который не выполняется, может привести к неопределенному поведению.

Деактивированный корень виртуального процессора может быть пробуждении с вызовом `Activate` метода с тем же аргументом, который был передан в `Deactivate` метод. Планировщик отвечает за то, `Activate` `Deactivate` чтобы вызовы методов и были парными, но их не требуется получать в определенном порядке. Диспетчер ресурсов может управлять получением вызова `Activate` метода до того, как он получит вызов метода, `Deactivate` для которого он был предназначен.

Если виртуальный процессор находится в процессе пробуждения, а возвращаемое значение `Deactivate` метода является значением **`false`** , планировщик должен запросить список завершения UMS через `IUMSCompletionList::GetUnblockNotifications` метод, действовать с этими сведениями, а затем `Deactivate` снова вызвать метод. Это следует повторять до тех пор, пока `Deactivate` метод не возвратит значение **`true`** .

`invalid_argument`Если аргумент `pContext` имеет значение null, создается исключение.

`invalid_operation`вызывается, если корень виртуального процессора никогда не был активирован, или аргумент не `pContext` представляет контекст выполнения, который был недавно отправлен этим корнем виртуального процессора.

Процесс деактивации корня виртуального процессора уменьшает уровень подписки базового аппаратного потока на единицу. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="ivirtualprocessorrootensurealltasksvisible-method"></a><a name="ensurealltasksvisible"></a>Метод IVirtualProcessorRoot::EnsureAllTasksVisible

Приводит к тому, что данные, хранящиеся в иерархии памяти отдельных процессоров, становятся видимыми для всех процессоров в системе. Это гарантирует, что на всех процессорах будет выполнена полная граница памяти, прежде чем метод вернет значение.

```cpp
virtual void EnsureAllTasksVisible(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в данный момент отправляется этим корнем виртуального процессора.

### <a name="remarks"></a>Примечания

Этот метод может оказаться полезным, если требуется синхронизировать деактивацию корня виртуального процессора с добавлением новой работы в планировщик. Из соображений производительности можно добавлять рабочие элементы в планировщик без выполнения барьера памяти, что означает, что рабочие элементы, добавленные потоком, которые выполняются на одном процессоре, не сразу видны всем остальным процессорам. С помощью этого метода в сочетании с `Deactivate` методом можно гарантировать, что ваш планировщик не отключит все корни виртуального процессора, пока рабочие элементы существуют в коллекциях планировщика.

Вызов `EnsureAllTasksVisibleThe` метода должен исходить из `Dispatch` метода контекста выполнения, с которым последний раз был активирован корневой виртуальный процессор. Иными словами, прокси-сервер потока, вызывающий `EnsureAllTasksVisible` метод, должен быть тем, который в данный момент выполняется в корне виртуального процессора. Вызов метода для корня виртуального процессора, который не выполняется, может привести к неопределенному поведению.

`invalid_argument`Если аргумент имеет значение, создается исключение `pContext` `NULL` .

`invalid_operation`вызывается, если корень виртуального процессора никогда не был активирован, или аргумент не `pContext` представляет контекст выполнения, который был недавно отправлен этим корнем виртуального процессора.

## <a name="ivirtualprocessorrootgetid-method"></a><a name="getid"></a>Метод IVirtualProcessorRoot::GetId

Возвращает уникальный идентификатор для корня виртуального процессора.

```cpp
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Целочисленный идентификатор.

## <a name="see-also"></a>См. также раздел

[Пространство имен Concurrency](concurrency-namespace.md)
