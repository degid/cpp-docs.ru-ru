---
title: Экземпляры планировщика
ms.date: 11/04/2016
helpviewer_keywords:
- scheduler instances
ms.assetid: 4819365f-ef99-49cc-963e-50a2a35a8d6b
ms.openlocfilehash: e9e9b8124254084ac30191d37d49f2ef72bd677e
ms.sourcegitcommit: a8ef52ff4a4944a1a257bdaba1a3331607fb8d0f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77142297"
---
# <a name="scheduler-instances"></a>Экземпляры планировщика

В этом документе описывается роль экземпляров планировщика в среда выполнения с параллелизмом и использование классов [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) и [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) для создания экземпляров планировщика и управления ими. Экземпляры планировщика полезны, когда необходимо связать явные политики планирования с конкретными типами рабочих нагрузок. Например, можно создать один экземпляр планировщика для выполнения некоторых задач с повышенным приоритетом потока и использовать планировщик по умолчанию для выполнения задач с обычным приоритетом потока.

> [!TIP]
> Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, и таким образом не требуется создавать планировщик в приложении. Поскольку планировщик задач помогает точно настроить производительность приложений, рекомендуется начать с [библиотеки параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) или [библиотеки асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md) , если вы не знакомы с среда выполнения с параллелизмом.

## <a name="top"></a> Разделы

- [Классы Scheduler и CurrentScheduler](#classes)

- [Создание экземпляра планировщика](#creating)

- [Управление временем существования экземпляра планировщика](#managing)

- [Методы и функции](#features)

- [Пример](#example)

## <a name="classes"></a>Классы Scheduler и CurrentScheduler

Планировщик задач позволяет приложениям использовать один или несколько *экземпляров планировщика* для планирования работы. Класс [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) представляет экземпляр планировщика и инкапсулирует функциональные возможности, связанные с задачами планирования.

Поток, присоединенный к планировщику, называется *контекстом выполнения*или просто *контекстом*. Один планировщик может быть активным в текущем контексте в любое время. Активный планировщик также называется *текущим планировщиком*. Среда выполнения с параллелизмом использует класс [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) для предоставления доступа к текущему планировщику. Текущий планировщик для одного контекста может отличаться от текущего планировщика для другого контекста. Среда выполнения не предоставляет представление текущего планировщика на уровне процесса.

Как правило, класс `CurrentScheduler` используется для доступа к текущему планировщику. Класс `Scheduler` полезен, если требуется управлять планировщиком, который не является текущим.

В следующих разделах описывается создание экземпляра планировщика и управление им. Полный пример, демонстрирующий эти задачи, см. [в разделе руководство. Управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md).

[[В начало](#top)]

## <a name="creating"></a>Создание экземпляра планировщика

Существует три способа создания объекта `Scheduler`.

- Если планировщик не существует, среда выполнения создает планировщик по умолчанию при использовании функциональности среды выполнения, например, параллельного алгоритма для выполнения работы. Планировщик по умолчанию преобразуется в текущий планировщик для контекста, который инициирует параллельную работу.

- Метод [concurrency::CurrentScheduler:: Create](reference/currentscheduler-class.md#create) создает объект `Scheduler`, который использует определенную политику и связывает этот планировщик с текущим контекстом.

- Метод [concurrency::Scheduler:: Create](reference/scheduler-class.md#create) создает объект `Scheduler`, использующий определенную политику, но не связывает его с текущим контекстом.

Предоставление среде выполнения разрешения на создание планировщика по умолчанию позволяет всем параллельным задачам совместно использовать один и тот же планировщик. Как правило, функции, предоставляемые [библиотекой параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL) или [библиотеки асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md) , используются для выполнения параллельной работы. Поэтому нет необходимости работать непосредственно с планировщиком, чтобы управлять его политикой или временем существования. При использовании PPL или библиотеки агентов среда выполнения создает планировщик по умолчанию, если он не существует, и делает его текущим планировщиком для каждого контекста. Когда вы создаете планировщик и устанавливаете его в качестве текущего планировщика, среда выполнения использует этот планировщик для планирования задач. Создавайте дополнительные экземпляры планировщика, только если требуется определенная политика планирования. Дополнительные сведения о политиках, связанных с планировщиком, см. в разделе [политики планировщика](../../parallel/concrt/scheduler-policies.md).

[[В начало](#top)]

## <a name="managing"></a>Управление временем существования экземпляра планировщика

Среда выполнения использует механизм подсчета ссылок для управления временем существования объектов `Scheduler`.

При использовании метода `CurrentScheduler::Create` или метода `Scheduler::Create` для создания объекта `Scheduler` среда выполнения устанавливает начальное число ссылок для этого планировщика на единицу. Среда выполнения увеличивает счетчик ссылок при вызове метода [concurrency::Scheduler:: Attach](reference/scheduler-class.md#attach) . Метод `Scheduler::Attach` связывает объект `Scheduler` вместе с текущим контекстом. Это делает его текущим планировщиком. При вызове метода `CurrentScheduler::Create` среда выполнения создает объект `Scheduler` и прикрепляет его к текущему контексту (и устанавливает счетчик ссылок в один). Можно также использовать метод [concurrency::Scheduler:: Reference](reference/scheduler-class.md#reference) для увеличения числа ссылок объекта `Scheduler`.

Среда выполнения уменьшает счетчик ссылок при вызове метода [concurrency::CurrentScheduler::D етач](reference/currentscheduler-class.md#detach) для отсоединения текущего планировщика или вызов метода [concurrency::Scheduler:: Release](reference/scheduler-class.md#release) . Когда счетчик ссылок достигнет нуля, среда выполнения уничтожает объект `Scheduler` после завершения всех запланированных задач. Выполняемая задача может увеличить число ссылок текущего планировщика. Таким образом, если счетчик ссылок достигает нуля, а задача увеличивает счетчик ссылок, среда выполнения не уничтожает объект `Scheduler`, пока счетчик ссылок не достигнет нуля и все задачи завершаются.

Среда выполнения поддерживает внутренний стек объектов `Scheduler` для каждого контекста. При вызове метода `Scheduler::Attach` или `CurrentScheduler::Create` среда выполнения отправляет объект `Scheduler` в стек текущего контекста. Это делает его текущим планировщиком. При вызове `CurrentScheduler::Detach`среда выполнения извлекает текущий планировщик из стека для текущего контекста и устанавливает предыдущее значение в качестве текущего планировщика.

Среда выполнения предоставляет несколько способов управления жизненным циклом экземпляра планировщика. В следующей таблице показан соответствующий метод, который освобождает или отсоединяет планировщик от текущего контекста для каждого метода, который создает или прикрепляет планировщик к текущему контексту.

|Создание или присоединение метода|Метод Release или Detach|
|-----------------------------|------------------------------|
|`CurrentScheduler::Create`|`CurrentScheduler::Detach`|
|`Scheduler::Create`|`Scheduler::Release`|
|`Scheduler::Attach`|`CurrentScheduler::Detach`|
|`Scheduler::Reference`|`Scheduler::Release`|

Вызов недопустимого метода выпуска или отсоединения приводит к неопределенному поведению в среде выполнения.

Если вы используете функцию, например PPL, которая заставляет среду выполнения создать планировщик по умолчанию, не освобождайте и не отменяйте этот планировщик. Среда выполнения управляет временем существования любого создаваемого планировщика.

Поскольку среда выполнения не уничтожает объект `Scheduler` до завершения всех задач, можно использовать метод [concurrency::Scheduler:: регистершутдовневент](reference/scheduler-class.md#registershutdownevent) или метод [concurrency::CurrentScheduler:: регистершутдовневент](reference/currentscheduler-class.md#registershutdownevent) для получения уведомления при уничтожении объекта `Scheduler`. Это полезно, когда необходимо дождаться завершения каждой задачи, запланированной объектом `Scheduler`.

[[В начало](#top)]

## <a name="features"></a>Методы и функции

В этом разделе перечислены важные методы классов `CurrentScheduler` и `Scheduler`.

Класс `CurrentScheduler` следует рассматривать как вспомогательный объект для создания планировщика для использования в текущем контексте. Класс `Scheduler` позволяет управлять планировщиком, принадлежащим другому контексту.

В следующей таблице показаны важные методы, определяемые классом `CurrentScheduler`.

|Метод|Description|
|------------|-----------------|
|[Создание](reference/currentscheduler-class.md#create)|Создает объект `Scheduler`, который использует указанную политику и связывает его с текущим контекстом.|
|[Get](reference/currentscheduler-class.md#get)|Получает указатель на объект `Scheduler`, связанный с текущим контекстом. Этот метод не увеличивает число ссылок объекта `Scheduler`.|
|[Отсоединить](reference/currentscheduler-class.md#detach)|Отсоединяет текущий планировщик от текущего контекста и устанавливает предыдущий из них в качестве текущего планировщика.|
|[регистершутдовневент](reference/currentscheduler-class.md#registershutdownevent)|Регистрирует событие, которое среда выполнения задает при уничтожении текущего планировщика.|
|[CreateScheduleGroup](reference/currentscheduler-class.md#createschedulegroup)|Создает объект [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) в текущем планировщике.|
|[ScheduleTask](reference/currentscheduler-class.md#scheduletask)|Добавляет упрощенную задачу в очередь планирования текущего планировщика.|
|[GetPolicy](reference/currentscheduler-class.md#getpolicy)|Извлекает копию политики, которая связана с текущим планировщиком.|

В следующей таблице показаны важные методы, определяемые классом `Scheduler`.

|Метод|Description|
|------------|-----------------|
|[Создание](reference/scheduler-class.md#create)|Создает объект `Scheduler`, использующий указанную политику.|
|[Присоединить](reference/scheduler-class.md#attach)|Связывает объект `Scheduler` вместе с текущим контекстом.|
|[Справочные материалы](reference/scheduler-class.md#reference)|Увеличивает счетчик ссылок объекта `Scheduler`.|
|[Выпуск](reference/scheduler-class.md#release)|Уменьшает значение счетчика ссылок объекта `Scheduler`.|
|[регистершутдовневент](reference/scheduler-class.md#registershutdownevent)|Регистрирует событие, которое среда выполнения задает при уничтожении объекта `Scheduler`.|
|[CreateScheduleGroup](reference/scheduler-class.md#createschedulegroup)|Создает объект [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) в объекте `Scheduler`.|
|[ScheduleTask](reference/scheduler-class.md#scheduletask)|Планирует упрощенную задачу из объекта `Scheduler`.|
|[GetPolicy](reference/scheduler-class.md#getpolicy)|Извлекает копию политики, связанную с объектом `Scheduler`.|
|[SetDefaultSchedulerPolicy](reference/scheduler-class.md#setdefaultschedulerpolicy)|Задает политику, используемую средой выполнения при создании планировщика по умолчанию.|
|[ресетдефаултсчедулерполици](reference/scheduler-class.md#resetdefaultschedulerpolicy)|Восстанавливает политику по умолчанию до того, как она была активна до вызова `SetDefaultSchedulerPolicy`. Если после этого вызова создается планировщик по умолчанию, среда выполнения использует параметры политики по умолчанию для создания планировщика.|

[[В начало](#top)]

## <a name="example"></a> Пример

Основные примеры создания экземпляра планировщика и управления им см. [в разделе Управление экземпляром](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)планировщика.

## <a name="see-also"></a>См. также раздел

[Планировщик заданий](../../parallel/concrt/task-scheduler-concurrency-runtime.md)<br/>
[Практическое руководство. Управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)<br/>
[Политики планировщика](../../parallel/concrt/scheduler-policies.md)<br/>
[Группы планирования](../../parallel/concrt/schedule-groups.md)
