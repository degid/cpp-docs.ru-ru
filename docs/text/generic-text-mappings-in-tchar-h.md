---
title: Универсальные текстовые сопоставления в файле Tchar.h
ms.date: 11/04/2016
helpviewer_keywords:
- mapping generic-text
- generic-text mappings [C++]
- character sets [C++], generic-text mappings
- Unicode [C++], generic-text mappings
- MBCS [C++], generic-text mappings
- TCHAR.H data types, mapping
- mappings [C++], TCHAR.H
ms.assetid: 01e1bb74-5a01-4093-8720-68b6c1fdda80
ms.openlocfilehash: c317e7d67cc3d086dacbe0f24b0103d389afefda
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87217302"
---
# <a name="generic-text-mappings-in-tcharh"></a>Универсальные текстовые сопоставления в файле Tchar.h

Чтобы упростить перенос кода для международного использования, Библиотека времени выполнения Майкрософт предоставляет универсальные текстовые сопоставления, связанные с Майкрософт, для многих типов данных, подпрограмм и других объектов. Вы можете использовать эти сопоставления, определенные в файле Tchar.h, для написания универсального кода, который можно скомпилировать для однобайтовых, многобайтовых кодировок или наборов символов Юникода в зависимости от константы манифеста, определенной с помощью `#define` инструкции. Универсальные текстовые сопоставления представляют собой расширения Microsoft, несовместимые со стандартами ANSI.

С помощью TCHAR.h можно создавать Однобайтовые кодировки (MBCS) и приложения Юникода из одних и тех же источников. в файле Tchar.h определяются макросы ( `_tcs` с префиксом), которые вместе с необходимыми определениями препроцессора сопоставляются с `str` `_mbs` функциями, или `wcs` . Чтобы создать многобайтовую кодировку, определите символ `_MBCS` . Чтобы создать Юникод, определите символ `_UNICODE` . Чтобы создать однобайтовое приложение, определите ни один (по умолчанию). По умолчанию `_UNICODE` для приложений MFC определено значение.

`_TCHAR`Тип данных определяется условно в файле Tchar.h. Если символ `_UNICODE` определен для сборки, `_TCHAR` то он определяется как **`wchar_t`** ; в противном случае для однобайтовых и MBCS-сборок он определяется как **`char`** . ( **`wchar_t`** базовый тип данных для расширенных символов в Юникоде — это 16-разрядный аналог для 8-разрядной версии **`signed char`** .) Для международных приложений используйте `_tcs` семейство функций, которые работают в `_TCHAR` единицах, а не в байтах. Например, `_tcsncpy` копии `n` `_TCHARs` , а не `n` байты.

Так как некоторые функции обработки строк с однобайтовой кодировкой (SBCS) принимают (подписанные) **`char*`** Параметры, при определении определяется значение предупреждения компилятора несоответствия типов `_MBCS` . Избежать этого предупреждения можно тремя способами:

1. Использование типобезопасных встроенных преобразователей функций в файле Tchar.h. Это поведение по умолчанию.

1. Используйте прямые макросы в файле Tchar.h, определив `_MB_MAP_DIRECT` в командной строке. После этого необходимо сопоставить типы вручную. Это самый быстрый метод, но он не является строго типизированным.

1. Использование в файле Tchar.h преобразователей статических функций статической библиотеки, связанных с типом. Для этого необходимо определить константу `_NO_INLINING` в командной строке. Это самый медленный и в то же время самый типобезопасный способ.

### <a name="preprocessor-directives-for-generic-text-mappings"></a>Директивы препроцессора для универсальных текстовых сопоставлений

|# define|Скомпилированная версия|Пример|
|---------------|----------------------|-------------|
|`_UNICODE`|Юникод (расширенные символы)|`_tcsrev` соответствует `_wcsrev`|
|`_MBCS`|Многобайтовые символы|`_tcsrev` соответствует `_mbsrev`|
|Нет (значение по умолчанию `_UNICODE` не `_MBCS` задано и не определено)|Однобайтовая кодировка (ASCII)|`_tcsrev` соответствует `strrev`|

Например, функция Generic-Text `_tcsrev` , определенная в файле Tchar.h, сопоставляется с, `_mbsrev` Если вы определили `_MBCS` в программе или `_wcsrev` Если вы определили `_UNICODE` . В противном случае `_tcsrev` сопоставляется с `strrev`. Другие сопоставления типов данных предоставляются в файле Tchar.h для удобства программирования, но `_TCHAR` являются наиболее полезными.

### <a name="generic-text-data-type-mappings"></a>Сопоставления типов данных универсального текста

|Универсальный текст<br /> Имя типа данных|_UNICODE &<br /> _MBCS не определен|_MBCS<br /> Определено|_UNICODE<br /> Определено|
|--------------------------------------|----------------------------------------|------------------------|---------------------------|
|`_TCHAR`|**`char`**|**`char`**|**`wchar_t`**|
|`_TINT`|**`int`**|**`unsigned int`**|`wint_t`|
|`_TSCHAR`|**`signed char`**|**`signed char`**|**`wchar_t`**|
|`_TUCHAR`|**`unsigned char`**|**`unsigned char`**|**`wchar_t`**|
|`_TXCHAR`|**`char`**|**`unsigned char`**|**`wchar_t`**|
|`_T` или `_TEXT`|Не действует (удаляется препроцессором)|Не действует (удаляется препроцессором)|`L`(преобразует следующий символ или строку в его аналог в Юникоде)|

Список универсальных текстовых сопоставлений подпрограмм, переменных и других объектов см. в разделе [универсальные текстовые сопоставления](../c-runtime-library/generic-text-mappings.md) в справочнике по библиотеке времени выполнения.

> [!NOTE]
> Не используйте `str` семейство функций со строками в Юникоде, которые, скорее всего, содержат внедренные значения NULL. Аналогичным образом не следует использовать `wcs` семейство функций с строками MBCS (или SBCS).

В следующих примерах кода показано использование функций `_TCHAR` и `_tcsrev` для сопоставления моделям многобайтовой кодировки, Юникод и однобайтовой кодировки.

```cpp
_TCHAR *RetVal, *szString;
RetVal = _tcsrev(szString);
```

Если `_MBCS` определен, препроцессор сопоставляет этот фрагмент с этим кодом:

```cpp
char *RetVal, *szString;
RetVal = _mbsrev(szString);
```

Если `_UNICODE` определен, препроцессор сопоставляет этот фрагмент с этим кодом:

```cpp
wchar_t *RetVal, *szString;
RetVal = _wcsrev(szString);
```

Если ни один из них не `_MBCS` `_UNICODE` определен, препроцессор сопоставляет фрагмент с однобайтовым кодом ASCII, как показано ниже:

```cpp
char *RetVal, *szString;
RetVal = strrev(szString);
```

Таким образом, можно писать, обслуживать и компилировать файл кода с одним исходным кодом для выполнения с подпрограммами, характерными для любого из трех типов наборов символов.

## <a name="see-also"></a>См. также раздел

[Текст и строки](../text/text-and-strings-in-visual-cpp.md)<br/>
[Использование TCHAR. Типы данных H с кодом _MBCS](../text/using-tchar-h-data-types-with-mbcs-code.md)
