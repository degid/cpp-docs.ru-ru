---
title: /Gd, /Gr, /Gv, /Gz (соглашение о вызовах)
ms.date: 09/05/2018
f1_keywords:
- /Gr
- /Gv
- /Gd
- VC.Project.VCCLCompilerTool.CallingConvention
helpviewer_keywords:
- -Gd compiler option [C++]
- -Gv compiler option [C++]
- /Gv compiler option [C++]
- -Gr compiler option [C++]
- Gd compiler option [C++]
- Gr compiler option [C++]
- /Gz compiler option [C++]
- -Gz compiler option [C++]
- /Gd compiler option [C++]
- Gz compiler option [C++]
- Gv compiler option [C++]
- /Gr compiler option [C++]
ms.assetid: fd3110cb-2d77-49f2-99cf-a03f9ead00a3
ms.openlocfilehash: e1617b7c158e9705a6211310fa7873f667a62ba5
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87234371"
---
# <a name="gd-gr-gv-gz-calling-convention"></a>/Gd, /Gr, /Gv, /Gz (соглашение о вызовах)

Эти параметры определяют порядок, в котором аргументы функции передаются в стек, то, удаляет ли вызывающая или вызываемая функция аргументы из стека в конце вызова, а также соглашение о декорировании имен, используемое компилятором для идентификации отдельных функций.

## <a name="syntax"></a>Синтаксис

> **`/Gd`**\
> **`/Gr`**\
> **`/Gv`**\
> **`/Gz`**

## <a name="remarks"></a>Примечания

**`/Gd`** параметр по умолчанию задает соглашение о вызове [__cdecl](../../cpp/cdecl.md) для всех функций, кроме функций и функций элементов C++, которые помечены как [__stdcall](../../cpp/stdcall.md), [__fastcall](../../cpp/fastcall.md)или [__vectorcall](../../cpp/vectorcall.md).

**`/Gr`** Указывает **`__fastcall`** соглашение о вызовах для всех функций, кроме функций элементов C++, функций с именами `main` и функций, которые помечены как **`__cdecl`** , **`__stdcall`** или **`__vectorcall`** . Все **`__fastcall`** функции должны иметь прототипы. Это соглашение о вызовах доступно только в компиляторах для 32-разрядных систем и игнорируется компиляторами, предназначенными для других архитектур.

**`/Gz`** Указывает **`__stdcall`** соглашение о вызовах для всех функций, кроме функций элементов C++, функций с именами `main` и функций, которые помечены как **`__cdecl`** , **`__fastcall`** или **`__vectorcall`** . Все **`__stdcall`** функции должны иметь прототипы. Это соглашение о вызовах доступно только в компиляторах для 32-разрядных систем и игнорируется компиляторами, предназначенными для других архитектур.

**`/Gv`** Указывает **`__vectorcall`** соглашение о вызовах для всех функций, за исключением функций-членов C++, функций с именами `main` , функций с `vararg` переменным списком аргументов или функций, помеченных конфликтующим **`__cdecl`** **`__stdcall`** **`__fastcall`** атрибутом, или. Это соглашение о вызовах доступно только в 32- и 64-разрядных архитектурах, поддерживающих /arch:SSE2 и более поздние версии, и игнорируется компиляторами, предназначенными для архитектуры ARM.

Функции, принимающие переменное число аргументов, должны быть помечены **`__cdecl`** .

**`/Gd`**, **`/Gr`** **`/Gv`** и **`/Gz`** несовместимы с [`/clr:safe`](clr-common-language-runtime-compilation.md) или **/clr: pure**. Параметры компилятора **/clr:pure** и **/clr:safe** не рекомендуется использовать в Visual Studio 2015, и они не поддерживаются в Visual Studio 2017 и более поздних версий.

> [!NOTE]
> По умолчанию для процессоров x86 функции элементов C++ используют [`__thiscall`](../../cpp/thiscall.md) .

Для всех процессоров функция-член, которая явно помечена как **`__cdecl`** , **`__fastcall`** , **`__vectorcall`** или, **`__stdcall`** использует указанное соглашение о вызовах, если оно не пропускается в этой архитектуре. Функция-член, которая принимает переменное число аргументов, всегда использует **`__cdecl`** соглашение о вызовах.

Эти параметры компилятора не влияют на декорирование имен методов и функций C++. Если методы и функции C++ не объявлены как `extern "C"`, к ним применяется другая схема декорирования имен. Дополнительные сведения см. в статье [Внутренние имена](decorated-names.md).

Дополнительные сведения о соглашениях о вызовах см. в статье [Соглашения о вызовах](../../cpp/calling-conventions.md).

## <a name="__cdecl-specifics"></a>Особенности соглашения __cdecl

В 32-разрядных процессорах все аргументы функции передаются в стеке справа налево. В ARM и 64-разрядных архитектурах некоторые аргументы передаются в регистрах, а остальные — в стеке справа налево. Вызывающая подпрограмма извлекает аргументы из стека.

Для языка C в **`__cdecl`** соглашении об именовании используется имя функции, которому предшествует символ подчеркивания ( `_` ); преобразование регистра не выполняется. Если функции C++ не объявлены как `extern "C"`, к ним применяется другая схема декорирования имен. Дополнительные сведения см. в статье [Внутренние имена](decorated-names.md).

## <a name="__fastcall-specifics"></a>Особенности соглашения __fastcall

Некоторые **`__fastcall`** аргументы функции передаются в регистрах (для процессоров x86, ECX и EDX), а остальные помещаются в стек справа налево. Вызываемая подпрограмма извлекает аргументы из стека до возврата управления. Как правило, параметр **/Gr** уменьшает время выполнения.

> [!NOTE]
> Будьте внимательны при использовании **`__fastcall`** соглашения о вызовах для любой функции, написанной на встроенном языке ассемблера. Использование регистров может конфликтовать с использованием компилятора.

Для языка C в **`__fastcall`** соглашении об именовании используется имя функции, предшествующее символу ( **\@** ), за которым следует размер аргументов функции в байтах. Преобразование регистра не выполняется. В качестве соглашения об именовании компилятор использует следующий шаблон:

`@function_name@number`

При использовании **`__fastcall`** соглашения об именовании используйте стандартные включаемые файлы. В противном случае вы получите неразрешенные внешние ссылки.

## <a name="__stdcall-specifics"></a>Особенности соглашения __stdcall

**`__stdcall`** Аргументы функции помещаются в стек справа налево, а вызываемая функция извлекает эти аргументы из стека перед возвратом.

Для языка C в **`__stdcall`** соглашении об именовании используется имя функции, которому предшествует символ подчеркивания ( **\_** ), а за ним — символ ( **\@** ) и размер аргументов функции в байтах. Преобразование регистра не выполняется. В качестве соглашения об именовании компилятор использует следующий шаблон:

`_functionname@number`

## <a name="__vectorcall-specifics"></a>Особенности соглашения __vectorcall

**`__vectorcall`** Целочисленные аргументы функции передаются по значению с использованием до двух (в x86) или четырех (в x64) целочисленных регистров и до шести регистров XMM для значений с плавающей запятой и векторов, а остальные передаются в стеке справа налево. Вызываемая функция очищает стек до возврата управления. Возвращаемые векторные значения и значения с плавающей запятой возвращаются в XMM0.

Для языка C в **`__vectorcall`** соглашении об именовании используется имя функции, за которой следуют два знака **\@\@** in () и размер аргументов функции в байтах. Преобразование регистра не выполняется. В качестве соглашения об именовании компилятор использует следующий шаблон:

`functionname@@number`

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Выберите страницу дополнительных свойств **C/C++**  >  **Advanced** .

1. Измените свойство **Соглашение о вызовах**.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.CallingConvention%2A>.

## <a name="see-also"></a>См. также статью

- [Параметры компилятора MSVC](compiler-options.md)
- [Синтаксис командной строки компилятора КОМПИЛЯТОРОМ MSVC](compiler-command-line-syntax.md)
