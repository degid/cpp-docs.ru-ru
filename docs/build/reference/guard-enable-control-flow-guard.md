---
title: /guard (включение защиты потока управления)
ms.date: 11/04/2016
f1_keywords:
- /guard
- VC.Project.VCCLCompilerTool.ControlFlowGuard
ms.assetid: be495323-f59f-4cf3-a6b6-8ee69e6a19dd
ms.openlocfilehash: 8661f94e0ee35f8d5e2c8caba1fc01bbf4072876
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87190693"
---
# <a name="guard-enable-control-flow-guard"></a>/guard (включение защиты потока управления)

Включение создания компилятором проверок безопасности для защиты потока управления.

## <a name="syntax"></a>Синтаксис

```
/guard:cf[-]
```

## <a name="remarks"></a>Примечания

Параметр **/guard:cf** указывает компилятору на необходимость анализа потока управления для целевых объектов косвенного вызова во время компиляции и последующей вставки кода для проверки целевых объектов во время выполнения. По умолчанию **/guard:cf** выключен и должен быть явным образом включен. Для отключения явным образом этого параметра используйте **/guard:cf-**.

**Visual Studio 2017 и более поздние версии**. Этот параметр добавляет **`switch`** условия для инструкций, создающих таблицы переходов.

Если указан параметр **/guard:cf** защиты потока управления (CFG), компилятор и компоновщик вставляют дополнительные проверки безопасности среды выполнения для обнаружения компрометации вашего кода. Во время компиляции и компоновки анализируются все косвенные вызовы в коде, чтобы найти любое расположение, доступное коду, когда он работает правильно. Эти сведения хранятся в дополнительных структурах в заголовках двоичных файлов. Компилятор также вставляет проверку перед каждым косвенным вызовом в коде, позволяющую убедиться, что целевой объект — одно из проверенных расположений. Если проверка завершается сбоем во время выполнения в операционной системе, которая поддерживает CFG, то операционная система закрывает программу.

Типичная атака на программное обеспечение использует ошибки при обработке экстремальных или непредвиденных входных данных. Аккуратно созданные входные данные для приложения могут перезаписать расположение, которое содержит указатель на исполняемый код. Это можно использовать для перенаправления потока управления в код, контролируемый злоумышленником. Проверки среды выполнения CFG не исправляют поврежденные данные в исполняемом файле. Вместо этого они усложняют злоумышленнику возможность их применения для выполнения произвольного кода. CFG представляет собой средство уменьшения угроз, предотвращающее вызовы в расположения, отличные от точек входа функций в коде. Это похоже на то, как предотвращение выполнения данных (DEP), проверки стека  [/GS](gs-buffer-security-check.md) , а также технология Address Space Layout Randomization (ASLR) [/DYNAMICBASE](dynamicbase-use-address-space-layout-randomization.md) и [/HIGHENTROPYVA](highentropyva-support-64-bit-aslr.md) уменьшают вероятность того, что ваш код станет вектором эксплойта.

Для построения кода, использующего метод предотвращения эксплойта CFG, параметр **/guard:cf** должен передаваться и в компилятор, и в компоновщик. Если двоичный файл создается с помощью одиночной команды `cl` , компилятор передает параметр в компоновщик. Если компиляция и компоновка выполняются отдельно, параметр должен быть указан в командах компилятора и компоновщика. Также требуется параметр компоновщика /DYNAMICBASE. Чтобы убедиться, что двоичный файл имеет данные CFG, используйте команду `dumpbin /headers /loadconfig` . Двоичные файлы с включенной функцией CFG имеют функцию `Guard` в списке характеристик EXE или DLL, а флаги защиты включают в себя `CF Instrumented` и `FID table present`.

Параметр **/guard:cf** несовместим с [/ZI](z7-zi-zi-debug-information-format.md) (Изменить и продолжить отладочную информацию) или [/clr](clr-common-language-runtime-compilation.md) (компиляция CLR).

Код, скомпилированный с помощью **/guard:cf** , может быть связан с библиотеками и файлами объектов, которые не были скомпилированы с помощью параметра. Защиту CFG имеет только этот код, когда он также связан с помощью параметра **/guard:cf** и выполняется в операционной системе, которая поддерживает CFG. Так как код, скомпилированный без параметра, не будет останавливать атаки, этот параметр рекомендуется использовать во всем компилируемом коде. Проверки CFG расходуют некоторые ресурсы среды выполнения, но функция анализа компилятора пытается оптимизировать проверки на косвенных переходах, которые могут быть установлены как безопасные.

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Выберите **Свойства конфигурации**, **C/C++**, **Создание кода**.

1. Выберите свойство **Защита потока управления** .

1. В раскрывающемся списке нажмите **Да** , чтобы включить защиту потока управления, или **Нет** , чтобы отключить ее.

## <a name="see-also"></a>См. также раздел

[Параметры компилятора MSVC](compiler-options.md)<br/>
[Синтаксис командной строки компилятора КОМПИЛЯТОРОМ MSVC](compiler-command-line-syntax.md)
