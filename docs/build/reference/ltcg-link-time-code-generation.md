---
title: /LTCG (создание кода во время компоновки)
description: Параметр компоновщика КОМПИЛЯТОРОМ MSVC/LTCG включает создание кода во время компоновки для всей оптимизации программы.
ms.date: 07/08/2020
f1_keywords:
- VC.Project.VCLinkerTool.LinkTimeCodeGeneration
- VC.Project.VCConfiguration.WholeProgramOptimization
- VC.Project.VCCLWCECompilerTool.WholeProgramOptimization
- /ltcg
- VC.Project.VCCLCompilerTool.WholeProgramOptimization
helpviewer_keywords:
- link-time code generation in C++ linker
- /LTCG linker option
- -LTCG linker option
- LTCG linker option
ms.assetid: 788c6f52-fdb8-40c2-90af-4026ea2cf2e2
ms.openlocfilehash: c954794d6d0fd087eee74ebb7e86d77b89a9a8fc
ms.sourcegitcommit: 80c8a512b361bd84e38958beb1a1bf6db7434021
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86180803"
---
# <a name="ltcg-link-time-code-generation"></a>`/LTCG`(Создание кода во время компоновки)

Используйте **`/LTCG`** для выполнения полной оптимизации программы или для создания инструментирования с помощью профильной оптимизации (PGO), проведения обучения и создания оптимизированных для профиля сборок.

## <a name="syntax"></a>Синтаксис

> **`/LTCG`**[**`:`**{**`INCREMENTAL`**|**`NOSTATUS`**|**`STATUS`**|**`OFF`**}]

Эти параметры являются нерекомендуемыми начиная с Visual Studio 2015:

> **`/LTCG:`**{**`PGINSTRUMENT`**|**`PGOPTIMIZE`**|**`PGUPDATE`**}

### <a name="arguments"></a>Аргументы

**`INCREMENTAL`**<br/>
Используемых Указывает, что компоновщик применяет оптимизацию всей программы или создание кода во время компоновки (LTCG) к файлам, затронутым изменением, а не всему проекту. По умолчанию этот флаг не установлен **`/LTCG`** , если указан, а весь проект связан с помощью оптимизации всей программы.

**`NOSTATUS`**&#124;**`STATUS`**<br/>
(Необязательно) Указывает, отображает ли компоновщик индикатор хода выполнения, который показывает процент завершения компоновки. По умолчанию эти сведения о состоянии не отображаются.

**`OFF`**<br/>
(Необязательно) Отключает создание кода во время компоновки. Это поведение аналогично тому, что **`/LTCG`** не указано в командной строке.

**`PGINSTRUMENT`**<br/>
(Необязательно) Этот параметр является нерекомендуемым начиная с Visual Studio 2015. Вместо этого используйте **`/LTCG`** и `[/GENPROFILE` или `/FASTGENPROFILE` ] (genprofile-fastgenprofile-Generate-profiling-instrumented-Build.md) для создания инструментированной сборки для профильной оптимизации. Данные, собранные из инструментированных запусков, используются для создания оптимизированного образа. Дополнительные сведения см. в статье [Профильные оптимизации](../profile-guided-optimizations.md). Краткая форма этого параметра — **`/LTCG:PGI`** .

**`PGOPTIMIZE`**<br/>
(Необязательно) Этот параметр является нерекомендуемым начиная с Visual Studio 2015. Вместо этого используйте **`/LTCG`** и [`/USEPROFILE`](useprofile.md) для создания оптимизированного образа. Дополнительные сведения см. в статье [Профильные оптимизации](../profile-guided-optimizations.md). Краткая форма этого параметра — **`/LTCG:PGO`** .

**`PGUPDATE`**<br/>
(Необязательно) Этот параметр является нерекомендуемым начиная с Visual Studio 2015. Вместо этого используйте **`/LTCG`** и **`/USEPROFILE`** для перестроения оптимизированного образа. Дополнительные сведения см. в статье [Профильные оптимизации](../profile-guided-optimizations.md). Краткая форма этого параметра — **`/LTCG:PGU`** .

## <a name="remarks"></a>Примечания

**`/LTCG`** Параметр указывает компоновщику вызывать компилятор и выполнять комплексную оптимизацию программы. Вы можете также выполнить профильную оптимизацию. Дополнительные сведения см. в статье [Профильные оптимизации](../profile-guided-optimizations.md).

За следующими исключениями нельзя добавлять параметры компоновщика в сочетание вероятностного оптимизатора, **`/LTCG`** которое не было **`/USEPROFILE`** указано в предыдущем сочетании параметров и для инициализации профильной оптимизации **`/LTCG`** **`/GENPROFILE`** .

- [`/BASE`](base-base-address.md)

- [`/FIXED`](fixed-fixed-base-address.md)

- **`/LTCG`**

- [`/MAP`](map-generate-mapfile.md)

- [`/MAPINFO`](mapinfo-include-information-in-mapfile.md)

- [`/NOLOGO`](nologo-suppress-startup-banner-linker.md)

- [`/OUT`](out-output-file-name.md)

- [`/PGD`](pgd-specify-database-for-profile-guided-optimizations.md)

- [`/PDB`](pdb-use-program-database.md)

- [`/PDBSTRIPPED`](pdbstripped-strip-private-symbols.md)

- [`/STUB`](stub-ms-dos-stub-file-name.md)

- [`/VERBOSE`](verbose-print-progress-messages.md)

Любые параметры компоновщика, указанные вместе с **`/LTCG`** **`/GENPROFILE`** параметрами и для инициализации вероятностного оптимизатора, не обязательно указывать при сборке с помощью **`/LTCG`** и **`/USEPROFILE`** . они являются подразумеваемыми.

В оставшейся части этой статьи обсуждается создание кода во время компоновки, выполненное **`/LTCG`** .

**`/LTCG`** подразумевается с [`/GL`](gl-whole-program-optimization.md) .

Компоновщик вызывает создание кода во время компоновки, если передается модуль, скомпилированный с помощью **`/GL`** или модуля MSIL (см. [ `.netmodule` файлы в качестве входных данных компоновщика](netmodule-files-as-linker-input.md)). Если вы не указываете явно **`/LTCG`** , когда передаете **`/GL`** компоновщику модули или MSIL, компоновщик в конечном итоге обнаружит эту ситуацию и перезапускает ссылку с помощью **`/LTCG`** . Явно укажите, **`/LTCG`** когда вы передаете **`/GL`** модули MSIL компоновщику для наиболее быстрой возможной производительности сборки.

Для еще более высокой производительности используйте **`/LTCG:INCREMENTAL`** . Этот параметр указывает компоновщику повторно оптимизировать только те файлы, на которые влияет изменение исходного файла, а не весь проект. Этот параметр может значительно сократить время компоновки. Этот параметр не тот же, что и при [инкрементной компоновке](incremental-link-incrementally.md).

**`/LTCG`** недопустим для использования с [`/INCREMENTAL`](incremental-link-incrementally.md) .

Если **`/LTCG`** используется для связывания модулей, скомпилированных с помощью [`/Og`](og-global-optimizations.md) ,, [`/O1`](o1-o2-minimize-size-maximize-speed.md) [`/O2`](o1-o2-minimize-size-maximize-speed.md) или [`/Ox`](ox-full-optimization.md) , выполняются следующие оптимизации.

- кроссмодульное встраивание;

- межпроцедурное распределение регистров (только 64-разрядные операционные системы);

- пользовательское соглашение об именовании (только x86)

- небольшое смещение TLS (только x86);

- двойное выравнивание стека (только x86);

- улучшенное устранение неоднозначности памяти (более подробные данные о конфликтах для глобальных переменных и входных параметров).

> [!NOTE]
> Компоновщик определяет, какие оптимизации использовались для компиляции каждой функции, и применяет те же оптимизации во время компоновки.

Использование **`/LTCG`** и **`/O2`** приводит к оптимизации двойного выравнивания.

Если **`/LTCG`** **`/O1`** указаны и, двойное выравнивание не выполняется. Если большинство функций в приложении скомпилированы для ускорения с несколькими функциями, скомпилированными для размера (например, с помощью [`optimize`](../../preprocessor/optimize.md) директивы pragma), компилятор дважды выравнивает функции, оптимизированные для размера, если они вызывают функции, требующие двойного выравнивания.

Если компилятор может определить все вызываемые функцией объекты, компилятор игнорирует модификаторы явного соглашения об именовании в функции и пытается оптимизировать соглашение о вызове функции:

- передает параметры в регистраторах;

- переупорядочивает параметры для выравнивания;

- удаляет неиспользуемые параметры.

Если функция вызывается через указатель функции или функция вызывается извне модуля, скомпилированного с помощью **`/GL`** , компилятор не пытается оптимизировать соглашение о вызовах функции.

> [!NOTE]
> Если вы используете **`/LTCG`** и переопределяете `mainCRTStartup` , приложение может иметь непредсказуемое поведение, связанное с пользовательским кодом, который выполняется до инициализации глобальных объектов. Существует три способа решения этой проблемы: не переопределять `mainCRTStartup` , не компилировать файл, содержащий с `mainCRTStartup` помощью **`/LTCG`** , или инициализировать глобальные переменные и объекты статически.

### <a name="ltcg-and-msil-modules"></a>`/LTCG`Модули MSIL и

Модули, компилируемые с помощью [`/GL`](gl-whole-program-optimization.md) и, [`/clr`](clr-common-language-runtime-compilation.md) могут использоваться в качестве входных данных компоновщика, если **`/LTCG`** указан параметр.

- **`/LTCG`** может принимать собственные объектные файлы, а также смешанные собственные и управляемые объектные файлы (скомпилированные с помощью **`/clr`** ). **`/clr:pure`** **`/clr:safe`** Параметры компилятора и являются устаревшими в visual Studio 2015 и не поддерживаются в visual Studio 2017 и более поздних версиях.

- **`/LTCG:PGI`** не принимает собственные модули, скомпилированные с помощью **`/GL`** и**`/clr`**

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Окна свойств** проекта. См. статью [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Откройте страницу свойств **Свойства конфигурации**  >  **Общие** .

1. Измените свойство **Оптимизация всей программы** .

Можно также применить **`/LTCG`** к конкретным сборкам, выбрав **Build**в  >  строке меню параметр построить**профильную оптимизацию** или выбрав один из параметров профильной оптимизации в контекстном меню проекта.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.LinkTimeCodeGeneration%2A>.

## <a name="see-also"></a>См. также раздел

[Справочник по компоновщику КОМПИЛЯТОРОМ MSVC](linking.md)\
[Параметры компоновщика MSVC](linker-options.md)
