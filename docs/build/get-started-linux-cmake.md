---
title: Создание кроссплатформенных проектов C++ в Visual Studio
description: Сведения о том, как настраивать, компилировать и отлаживать проект CMake с открытым исходным кодом C++ в Visual Studio, ориентированный на Linux и Windows.
ms.topic: tutorial
ms.date: 01/08/2020
ms.openlocfilehash: 3fdd9b1dfb5075f3a71f62bc4f1e2f3c646f9e6b
ms.sourcegitcommit: 6280a4c629de0f638ebc2edd446de2a9b11f0406
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2020
ms.locfileid: "90040487"
---
# <a name="tutorial-create-c-cross-platform-projects-in-visual-studio"></a>Учебник. Создание кроссплатформенных проектов C++ в Visual Studio

Разработка Visual Studio C и C++ теперь подходит не только для Windows. В этом руководстве показано, как использовать Visual Studio для C++ межплатформенной разработки в Windows и Linux. Он основан на CMake, поэтому вам не нужно создавать или генерировать проекты Visual Studio. При открытии папки с файлом CMakeLists.txt Visual Studio настраивает IntelliSense и параметры сборки автоматически. Вы можете быстро приступить к редактированию, сборке и отладке кода локально в Windows. Затем можно переключить конфигурацию для того, чтобы сделать то же самое в Linux, в Visual Studio.

В этом руководстве вы узнаете, как:

> [!div class="checklist"]
>
> * Клонировать проект CMake с открытым кодом с сайта GitHub.
> * Открывать проект в Visual Studio.
> * Собирать и отлаживать исполняемый целевой объект на Windows.
> * Добавлять подключение к компьютеру Linux.
> * Собирать и отлаживать тот же целевой объект в Linux.

## <a name="prerequisites"></a>Предварительные требования

* Настройка Visual Studio для кроссплатформенной разработки на C++
  * Сначала [установите Visual Studio](https://visualstudio.microsoft.com/vs/) и выберите **Разработка классических приложений на C++** и **Разработка для Linux на C++** . Для минимальной установки требуется всего 3 ГБ свободного места на диске. В зависимости от скорости загрузки установка не должна занять более 10 минут.

* Настройка компьютера Linux для кроссплатформенной разработки на C++
  * Visual Studio не требует конкретный дистрибутив Linux. Операционная система может работать на физическом компьютере, на виртуальной машине или в облаке. Также можно использовать подсистему Windows для Linux (WSL). Однако в рамках этого руководства требуется графическая среда. WSL не рекомендуется использовать здесь, поскольку она предназначена в основном для операций командной строки.
  * На компьютере Linux должны быть установлены следующие средства Visual Studio: Компиляторы C++, gdb, ssh, rsync, ninja и zip. В системах на основе Debian эти зависимости можно установить с помощью следующей команды:

    ```cmd
    sudo apt install -y openssh-server build-essential gdb rsync ninja-build zip
    ```

  * Visual Studio требует наличия на компьютере Linux последней версии CMake с включенным режимом сервера (не ниже 3.8). Корпорация Майкрософт предлагает универсальную сборку CMake, которую можно установить на любой дистрибутив Linux. Мы рекомендуем использовать эту сборку, чтобы у вас были самые новые функции. Вы можете получить двоичные файлы CMake из [вилки Майкрософт репозитория CMake](https://github.com/Microsoft/CMake/releases) на сайте GitHub. Перейдите на эту страницу и загрузите версию, соответствующую архитектуре вашей системы на компьютере Linux, а затем пометьте ее как исполняемый файл:

    ```cmd
    wget <path to binary>
    chmod +x cmake-3.11.18033000-MSVC_2-Linux-x86_64.sh
    ```

  * Вы увидите параметры для запуска скрипта с `-–help`. Рекомендуется использовать параметр `–prefix`, чтобы указать установку по пути **/usr**, потому что это расположение по умолчанию Visual Studio выполняет поиск CMake в каталоге **/usr/bin**. В следующем примере показан скрипт Linux x86_64. Измените этот параметр на нужный, если вы используете другую целевую платформу.

    ```cmd
    sudo ./cmake-3.11.18033000-MSVC_2-Linux-x86_64.sh --skip-license --prefix=/usr
    ```

* Git для Windows, установленный на компьютере Windows.
* Учетная запись GitHub.

## <a name="clone-an-open-source-cmake-project-from-github"></a>Клонирование проекта CMake с открытым кодом с сайта GitHub

В этом руководстве используется пакет SDK Bullet Physics на сайте GitHub. Он обеспечивает обнаружение столкновений и физическое моделирование для многих приложений. Пакет SDK включает примеры исполняемых программ, которые компилируются и запускаются без дополнительного кода. В этом учебнике не изменяются исходный код или скрипты сборки. Для начала клонируйте репозиторий *bullet3* из GitHub на компьютер, где установлена среда Visual Studio.

```cmd
git clone https://github.com/bulletphysics/bullet3.git
```

1. В главном меню Visual Studio выберите **Файл > Открыть > CMake**. Перейдите к файлу CMakeLists. txt в корне только что скачанного репозитория bullet3.

    ![Меню Visual Studio: Файл > Открыть > CMake](media/cmake-open-cmake.png)

    Когда вы откроете эту папку, структура папок отобразится в **обозревателе решений**.

    ![Представление папки в обозревателе решений Visual Studio](media/cmake-bullet3-solution-explorer.png)

    В этом представлении показано, что фактически находится на диске. Это не логическое или отфильтрованное представление. По умолчанию оно не показывает скрытые файлы.

1. Выберите **Показать все файлы**, чтобы просмотреть полный список файлов в папке.

    ![Кнопка "Показать все файлы" в обозревателе решений Visual Studio](media/cmake-bullet3-show-all-files.png)

## <a name="switch-to-targets-view"></a>Переключение на представление целевых объектов

Когда вы откроете папку, которая использует CMake, Visual Studio автоматически создаст кэш CMake. Эта операция может занять некоторое время в зависимости от размера проекта.

1. В **окне вывода** выберите **Показать выходные данные из** и выберите **CMake** для отслеживания состояния процесса создания кэша. По завершении операции отображается надпись: "Извлечение сведений о целевом объекте выполнено".

   ![Окно вывода Visual Studio с выходными данными из CMake](media/cmake-bullet3-output-window.png)

   После завершения этой операции будет настроена технология IntelliSense. Можно выполнить сборку проекта и отладить приложение. В Visual Studio теперь отображается логическое представление решения, основанное на целевых объектах, заданных в файлах CMakeLists.

1. Нажмите кнопку **Решения и папки** в **обозревателе решений**, чтобы переключиться на представление целевых объектов CMake.

   ![Кнопка "Решения и папки" в обозревателе решений для вывода представления целевых объектов CMake](media/cmake-bullet3-show-targets.png)

   Вот как это представление выглядит для пакета SDK Bullet:

   ![Представление целевых объектов CMake в обозревателе решений](media/cmake-bullet3-targets-view.png)

   Представление целевых объектов обеспечивает более интуитивное отображение содержимого исходной базы. Вы увидите, что некоторые целевые объекты являются библиотеками, а другие — исполняемыми файлами.

1. Разверните узел в представлении целевых объектов CMake, чтобы просмотреть его файлы исходного кода, где бы эти файлы ни находились на диске.

## <a name="add-an-explicit-windows-x64-debug-configuration"></a>Добавление явной конфигурации Windows x64-Debug

Visual Studio создает конфигурацию **x64-Debug** по умолчанию для Windows. Конфигурации указывают Visual Studio, какую платформу она будет использовать для CMake. Конфигурация по умолчанию не представлена на диске. При явном добавлении конфигурации Visual Studio создает файл с именем *CMakeSettings.json*. Он заполняется параметрами для всех указанных конфигураций.

1. Добавьте новую конфигурацию. На панели инструментов откройте раскрывающийся список **Конфигурация** и выберите **Управление конфигурациями**.

   ![Раскрывающийся список управления конфигурациями](media/cmake-bullet3-manage-configurations.png)

   Откроется [редактор параметров CMake](customize-cmake-settings.md). Щелкните зеленый значок плюса в левой части редактора, чтобы добавить новую конфигурацию. Откроется диалоговое окно **Добавление конфигурации в CMakeSettings**.

   ![Диалоговое окно "Добавление конфигурации в CMakeSettings"](media/cmake-bullet3-add-configuration-x64-debug.png)

   В этом диалоговом окне представлены все конфигурации, которые входят в состав Visual Studio, а также все созданные вами настраиваемые конфигурации. Если вы хотите продолжать использовать конфигурацию **x64-Debug**, добавьте ее в первую очередь. Выберите **x64-Debug**, а затем нажмите кнопку **Выбрать**. Visual Studio создает файл CMakeSettings.json с конфигурацией для **x64-Debug** и сохраняет ее на диске. Вы можете назвать конфигурацию как угодно, изменив параметр имени непосредственно в CMakeSettings.json.

## <a name="set-a-breakpoint-build-and-run-on-windows"></a>Установка точки останова, сборка и запуск в Windows

На этом шаге нам предстоит отладить пример программы, демонстрирующий библиотеку Bullet Physics.
  
1. В **обозревателе решений** выберите AppBasicExampleGui и разверните его.

1. Откройте файл `BasicExample.cpp`.

1. Задайте точку останова, которая будет выполняться при щелчке кнопки в работающем приложении. Событие щелчка обрабатывается в методе внутри вспомогательного класса. Для быстрого перехода:

   1. Выберите `CommonRigidBodyBase`, из которого происходит структура `BasicExample`, около строки 30.

   1. Щелкните правой кнопкой мыши и выберите **Перейти к определению**. Вы находитесь в заголовке CommonRigidBodyBase.h.

   1. В представлении браузера выше вы увидите, что находитесь в `CommonRigidBodyBase`. Справа можно выбрать элементы для проверки. Щелкните раскрывающийся список и выберите `mouseButtonCallback`, чтобы перейти к определению функции в заголовке.

      ![Панель инструментов со списком элементов Visual Studio](media/cmake-bullet3-member-list-toolbar.png)

1. Поместите точку останова на первой строке в этой функции. Она будет выполняться при нажатии кнопки мыши в окне приложения при запуске в отладчике Visual Studio.

1. Чтобы запустить приложение, выберите на панели инструментов раскрывающийся список запуска. Это зеленый значок воспроизведения с текстом "Выбрать элемент запуска". В раскрывающемся списке выберите AppBasicExampleGui.exe. Имя исполняемого файла теперь отображается на кнопке запуска:

   ![Раскрывающийся список запуска на панели инструментов Visual Studio, "Выбрать элемент запуска"](media/cmake-bullet3-launch-button.png)

1. Нажмите кнопку запуска, чтобы выполнить сборку приложения и необходимых зависимостей, а затем запустите его с подключенным отладчиком Visual Studio. Через некоторое время появится работающее приложение:

   ![Отладка приложения Windows в Visual Studio](media/cmake-bullet3-launched.png)

1. Переместите указатель мыши в окно приложения, а затем нажмите кнопку для вызова точки останова. Точка останова снова выведет Visual Studio на передний план, а в редакторе отобразится строка, где выполнение приостановлено. Можно проверить переменные, объекты, потоки и память приложения, а также пошагово выполнить код. Выберите **Продолжить**, чтобы позволить приложению возобновить работу, и закройте его в обычном режиме. Или остановите выполнение в Visual Studio с помощью кнопки "Остановить".

## <a name="add-a-linux-configuration-and-connect-to-the-remote-machine"></a>Добавление конфигурации Linux и подключение к удаленному компьютеру

1. Добавьте конфигурацию Linux. Щелкните правой кнопкой мыши файл CMakeSettings.json в **обозревателе решений** и выберите **Добавить конфигурацию**. Вы увидите то же диалоговое окно "Добавление конфигурации в CMakeSettings", что и раньше. На этот раз выберите **Linux-Debug**, а затем сохраните файл CMakeSettings.json (CTRL+S).

1. В раскрывающемся списке конфигураций выберите **Linux-Debug**.

   ![Раскрывающийся список конфигурации запуска с вариантами X64-Debug и Linux-Debug](media/cmake-bullet3-linux-configuration-item.png)

   Если это первое подключение к системе Linux, откроется диалоговое окно **Подключение к удаленной системе**.

   ![Диалоговое окно "Подключение к удаленной системе" в Visual Studio](media/cmake-bullet3-connection-manager.png)

   Если вы уже добавили удаленное подключение, вы можете открыть это окно в разделе **Сервис > Параметры > Кроссплатформенный > Диспетчер подключений**.

1. Укажите [сведения о подключении к компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md) и нажмите **Подключить**. Visual Studio добавляет этот компьютер в CMakeSettings.json как подключение по умолчанию для **Linux-Debug**. Он также извлекает заголовки из удаленного компьютера, чтобы вы могли получить [IntelliSense специально для этого удаленного подключения](../linux/configure-a-linux-project.md#remote_intellisense). Затем Visual Studio отправляет файлы на удаленный компьютер и создает кэш CMake в удаленной системе. Эти действия могут занять некоторое время в зависимости от скорости сети и мощности удаленного компьютера. Вы узнаете, что операция завершена, когда в окне вывода CMake появится сообщение: "Извлечение сведений о целевом объекте выполнено".

## <a name="set-a-breakpoint-build-and-run-on-linux"></a>Установка точки останова, сборка и запуск в Linux

Так как это классическое приложение, необходимо предоставить некоторые дополнительные сведения о конфигурации для конфигурации отладки.

1. В представлении целевых объектов CMake щелкните правой кнопкой мыши AppBasicExampleGui и выберите **Параметры отладки и запуска**, чтобы открыть файл launch.vs.json, который находится в скрытой вложенной папке **.vs**. Этот локальный файл для среды разработки. Вы можете переместить его в корень проекта, если хотите проверить его и сохранить для своей команды. В этот файл была добавлена конфигурация для AppBasicExampleGui. Эти параметры по умолчанию работают в большинстве случаев, но не здесь. Поскольку это классическое приложение, необходимо предоставить некоторые дополнительные сведения, чтобы запустить программу и увидеть ее на компьютере Linux.

1. Чтобы найти значение переменной среды `DISPLAY` на компьютере Linux, выполните следующую команду:

   ```cmd
   echo $DISPLAY
   ```

   В конфигурации для AppBasicExampleGui существует массив параметров "pipeArgs". В нем есть строка "${debuggerCommand}". Это команда, которая запускает gdb на удаленном компьютере. Visual Studio необходимо экспортировать соответствующие элементы в этот контекст перед выполнением этой команды. Например, если значение экрана — `:1`, измените эту строку следующим образом:

   ```cmd
   "export DISPLAY=:1;${debuggerCommand}",
   ```

1. Запустите приложение и выполните его отладку. На панели инструментов откройте раскрывающийся список **Выбрать элемент запуска** и выберите **AppBasicExampleGui**. Затем либо выберите зеленый значок воспроизведения на панели инструментов, либо нажмите клавишу **F5**. Приложение и его зависимости будут собраны на удаленном компьютере Linux. После чего приложение будет запущено с подключенным отладчиком Visual Studio. На удаленном компьютере Linux вы увидите окно приложения.

1. Переместите указатель мыши в окно приложения, а затем нажмите кнопку. Сработает точка останова. Выполнение программы приостанавливается, Visual Studio возвращается на передний план, вы увидите точку останова. Кроме того, вы увидите окно консоли Linux в Visual Studio. В этом окне предоставлены выходные данные с удаленного компьютера Linux, а также оно может принимать входные данные для `stdin`. Как и любое окно Visual Studio, вы можете закрепить его в предпочтительном месте. Его расположение сохраняется в будущих сеансах.

   ![Окно консоли Linux в Visual Studio](media/cmake-bullet3-linux-console.png)

1. Вы можете проверить переменные, объекты, потоки и память приложения и пошагово выполнить код с помощью Visual Studio. Но на этот раз вы выполняете все это на удаленном компьютере Linux вместо локальной среды Windows. Выберите **Продолжить**, чтобы приложение возобновило работу, выйдите из него обычным образом или нажмите кнопку остановки, как и при локальном выполнении.

1. Посмотрите на окно стека вызовов и увидите вызовы к `x11OpenGLWindow`, поскольку среда Visual Studio запустила приложение в Linux.

   ![Окно стека вызовов со стеком вызовов Linux](media/cmake-bullet3-linux-callstack.png)

## <a name="what-you-learned"></a>Чему вы научились

В этом руководстве вы клонировали базу кода непосредственно из GitHub. Вы создали, запустили и отладили его в Windows без изменений. Затем вы использовали эту же самую базу кода, с незначительными изменениями конфигурации, для сборки, запуска и отладки на удаленном компьютере Linux.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о настройке и отладке проектов CMake в Visual Studio:

> [!div class="nextstepaction"]
> [Проекты CMake в Visual Studio](cmake-projects-in-visual-studio.md)<br/><br/>
> [Настройка проекта Linux CMake](../linux/cmake-linux-project.md)<br/><br/>
> [Подключение к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)<br/><br/>
> [Настройка параметров сборки CMake](customize-cmake-settings.md)<br/><br/>
> [Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)<br/><br/>
> [Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)<br/><br/>
> [Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)
>
