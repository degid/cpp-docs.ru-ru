---
title: Класс CRowset
ms.date: 11/04/2016
f1_keywords:
- ATL.CRowset<TAccessor>
- CRowset
- ATL::CRowset
- ATL::CRowset<TAccessor>
- ATL.CRowset
- CRowset<TAccessor>.AddRefRows
- CRowset.AddRefRows
- ATL.CRowset.AddRefRows
- AddRefRows
- CRowset::AddRefRows
- CRowset<TAccessor>::AddRefRows
- ATL::CRowset::AddRefRows
- ATL.CRowset<TAccessor>.AddRefRows
- ATL::CRowset<TAccessor>::AddRefRows
- CRowset::Close
- ATL.CRowset.Close
- CRowset<TAccessor>::Close
- CRowset<TAccessor>.Close
- ATL.CRowset<TAccessor>.Close
- ATL::CRowset::Close
- ATL::CRowset<TAccessor>::Close
- CRowset.Close
- CRowset<TAccessor>.Compare
- CRowset<TAccessor>::Compare
- ATL.CRowset<TAccessor>.Compare
- ATL::CRowset<TAccessor>::Compare
- CRowset.Compare
- ATL::CRowset::Compare
- ATL.CRowset.Compare
- CRowset::Compare
- CRowset<TAccessor>::CRowset
- CRowset.CRowset
- ATL::CRowset::CRowset
- ATL::CRowset<TAccessor>::CRowset
- ATL.CRowset.CRowset
- CRowset<TAccessor>.CRowset
- CRowset::CRowset
- ATL.CRowset<TAccessor>.CRowset
- ATL::CRowset::Delete
- CRowset.Delete
- CRowset::Delete
- ATL.CRowset.Delete
- ATL::CRowset<TAccessor>::Delete
- CRowset<TAccessor>.Delete
- CRowset<TAccessor>::Delete
- ATL.CRowset<TAccessor>.Delete
- ATL.CRowset.FindNextRow
- CRowset<TAccessor>.FindNextRow
- ATL::CRowset::FindNextRow
- CRowset::FindNextRow
- CRowset<TAccessor>::FindNextRow
- CRowset.FindNextRow
- ATL.CRowset<TAccessor>.FindNextRow
- ATL::CRowset<TAccessor>::FindNextRow
- FindNextRow
- ATL::CRowset::GetApproximatePosition
- ATL::CRowset<TAccessor>::GetApproximatePosition
- CRowset.GetApproximatePosition
- CRowset::GetApproximatePosition
- GetApproximatePosition
- ATL.CRowset.GetApproximatePosition
- CRowset<TAccessor>::GetApproximatePosition
- CRowset<TAccessor>::GetData
- ATL::CRowset<TAccessor>::GetData
- ATL::CRowset::GetData
- ATL.CRowset<TAccessor>.GetData
- CRowset<TAccessor>.GetData
- CRowset::GetData
- CRowset.GetData
- ATL.CRowset.GetData
- CRowset<TAccessor>::GetDataHere
- CRowset<TAccessor>.GetDataHere
- CRowset.GetDataHere
- GetDataHere
- CRowset::GetDataHere
- ATL::CRowset::GetDataHere
- ATL::CRowset<TAccessor>::GetDataHere
- ATL.CRowset<TAccessor>.GetDataHere
- ATL.CRowset.GetDataHere
- ATL.CRowset<TAccessor>.GetOriginalData
- CRowset<TAccessor>::GetOriginalData
- ATL::CRowset<TAccessor>::GetOriginalData
- ATL.CRowset.GetOriginalData
- CRowset::GetOriginalData
- ATL::CRowset::GetOriginalData
- CRowset.GetOriginalData
- CRowset.GetRowStatus
- ATL.CRowset<TAccessor>.GetRowStatus
- ATL::CRowset<TAccessor>::GetRowStatus
- CRowset::GetRowStatus
- ATL::CRowset::GetRowStatus
- CRowset<TAccessor>::GetRowStatus
- ATL.CRowset.GetRowStatus
- CRowset<TAccessor>.GetRowStatus
- ATL.CRowset<TAccessor>.Insert
- CRowset.Insert
- CRowset<TAccessor>.Insert
- CRowset<TAccessor>::Insert
- ATL::CRowset<TAccessor>::Insert
- ATL.CRowset.Insert
- CRowset::Insert
- ATL::CRowset::Insert
- CRowset::IsSameRow
- CRowset.IsSameRow
- ATL::CRowset::IsSameRow
- ATL.CRowset.IsSameRow
- CRowset<TAccessor>::IsSameRow
- ATL.CRowset<TAccessor>.IsSameRow
- CRowset<TAccessor>.IsSameRow
- ATL::CRowset<TAccessor>::IsSameRow
- CRowset<TAccessor>::MoveFirst
- ATL::CRowset::MoveFirst
- CRowset<TAccessor>.MoveFirst
- CRowset::MoveFirst
- CRowset.MoveFirst
- ATL.CRowset.MoveFirst
- ATL.CRowset<TAccessor>.MoveFirst
- ATL::CRowset<TAccessor>::MoveFirst
- ATL::CRowset<TAccessor>::MoveLast
- CRowset<TAccessor>::MoveLast
- ATL.CRowset.MoveLast
- ATL::CRowset::MoveLast
- CRowset<TAccessor>.MoveLast
- CRowset::MoveLast
- ATL.CRowset<TAccessor>.MoveLast
- CRowset.MoveLast
- ATL.CRowset<TAccessor>.MoveNext
- ATL.CRowset.MoveNext
- ATL::CRowset<TAccessor>::MoveNext
- CRowset<TAccessor>.MoveNext
- CRowset.MoveNext
- CRowset<TAccessor>::MoveNext
- CRowset::MoveNext
- ATL::CRowset::MoveNext
- CRowset<TAccessor>.MovePrev
- CRowset.MovePrev
- CRowset::MovePrev
- ATL.CRowset.MovePrev
- ATL::CRowset<TAccessor>::MovePrev
- ATL::CRowset::MovePrev
- ATL.CRowset<TAccessor>.MovePrev
- CRowset<TAccessor>::MovePrev
- ATL::CRowset::MoveToBookmark
- ATL::CRowset<TAccessor>::MoveToBookmark
- ATL.CRowset.MoveToBookmark
- ATL.CRowset<TAccessor>.MoveToBookmark
- CRowset::MoveToBookmark
- CRowset.MoveToBookmark
- CRowset<TAccessor>::MoveToBookmark
- CRowset<TAccessor>::MoveToRatio
- CRowset::MoveToRatio
- CRowset<TAccessor>.MoveToRatio
- ATL.CRowset.MoveToRatio
- ATL::CRowset::MoveToRatio
- CRowset.MoveToRatio
- ATL.CRowset<TAccessor>.MoveToRatio
- ATL::CRowset<TAccessor>::MoveToRatio
- CRowset::ReleaseRows
- ATL::CRowset<TAccessor>::ReleaseRows
- CRowset<TAccessor>.ReleaseRows
- CRowset.ReleaseRows
- ATL.CRowset.ReleaseRows
- ATL.CRowset<TAccessor>.ReleaseRows
- CRowset<TAccessor>::ReleaseRows
- ATL::CRowset::ReleaseRows
- ATL.CRowset<TAccessor>.SetData
- ATL::CRowset::SetData
- CRowset<TAccessor>.SetData
- CRowset::SetData
- ATL.CRowset.SetData
- CRowset.SetData
- CRowset<TAccessor>::SetData
- ATL::CRowset<TAccessor>::SetData
- CRowset.Undo
- ATL::CRowset<TAccessor>::Undo
- CRowset<TAccessor>::Undo
- ATL.CRowset.Undo
- ATL.CRowset<TAccessor>.Undo
- CRowset<TAccessor>.Undo
- ATL::CRowset::Undo
- CRowset::Undo
- Undo
- CRowset.Update
- ATL.CRowset.Update
- ATL.CRowset<TAccessor>.Update
- ATL::CRowset<TAccessor>::Update
- CRowset<TAccessor>::Update
- CRowset::Update
- CRowset<TAccessor>.Update
- ATL::CRowset::Update
- CRowset::UpdateAll
- ATL.CRowset.UpdateAll
- CRowset<TAccessor>.UpdateAll
- ATL.CRowset<TAccessor>.UpdateAll
- UpdateAll
- CRowset.UpdateAl
- ATL::CRowset<TAccessor>::UpdateAll
- CRowset<TAccessor>::UpdateAll
- ATL::CRowset::UpdateAll
helpviewer_keywords:
- CRowset class
- AddRefRows method
- Close method
- Compare method
- CRowset class, constructor
- Delete method
- FindNextRow method
- GetApproximatePosition method
- GetData method [OLE DB]
- GetDataHere method
- GetOriginalData method
- GetRowStatus method
- Insert method
- IsSameRow method
- MoveFirst method
- MoveLast method
- MoveNext method
- MovePrev method
- MoveToBookmark method
- MoveToRatio method
- ReleaseRows method
- SetData method
- Undo method
- Update method
- UpdateAll method
ms.assetid: b0228a90-b8dd-47cc-b397-8d4c15c1e7f4
ms.openlocfilehash: 8cacbd6d188b3453c0111cca6565b7def9e3aa1e
ms.sourcegitcommit: ec6dd97ef3d10b44e0fedaa8e53f41696f49ac7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88831571"
---
# <a name="crowset-class"></a>Класс CRowset

Инкапсулирует объект набора строк OLE DB и несколько связанных интерфейсов и предоставляет методы манипуляции для данных набора строк.

## <a name="syntax"></a>Синтаксис

```cpp
template <class TAccessor = CAccessorBase>
class CRowset
```

### <a name="parameters"></a>Параметры

*такцессор*<br/>
Класс метода доступа. Значение по умолчанию — `CAccessorBase`.

## <a name="requirements"></a>Требования

**Заголовок:** atldbcli.h

## <a name="members"></a>Элементы

### <a name="methods"></a>Методы

| Имя | Описание |
|-|-|
|[аддрефровс](#addrefrows)|Увеличивает значение счетчика ссылок, связанного с текущей строкой.|
|[Закрыть](#close)|Освобождает строки и текущий `IRowset` интерфейс.|
|[Сравнить](#compare)|Сравнивает две закладки с помощью [IRowsetLocate:: Compare](/previous-versions/windows/desktop/ms709539(v=vs.85)).|
|[CRowset](#crowset)|Создает новый `CRowset` объект и (необязательно) связывает его с `IRowset` интерфейсом, переданным в качестве параметра.|
|[Удаление](#delete)|Удаляет строки из набора строк с помощью [IRowsetChange: DeleteRows](/previous-versions/windows/desktop/ms724362(v=vs.85)).|
|[FindNextRow](#findnextrow)|Находит следующую совпадающую строку после указанной закладки.|
|[жетаппроксиматепоситион](#getapproximateposition)|Возвращает приблизительное расположение строки, соответствующей закладке.|
|[GetData](#getdata)|Извлекает данные из копии набора строк для строки.|
|[жетдатахере](#getdatahere)|Извлекает данные из указанного буфера.|
|[жеторигиналдата](#getoriginaldata)|Извлекает данные, которые были недавно получены из источника данных или переданы в него, игнорируя ожидающие изменения.|
|[жетровстатус](#getrowstatus)|Возвращает состояние всех строк.|
|[Insert](#insert)|Создает и вставляет новую строку с помощью [IRowsetChange: insertRow](/previous-versions/windows/desktop/ms716921(v=vs.85)).|
|[IsSameRow](#issamerow)|Сравнивает указанную строку с текущей строкой.|
|[MoveFirst](#movefirst)|Перемещает расположение следующей выборки в начальную позицию.|
|[MoveLast](#movelast)|Переходит к последней записи.|
|[MoveNext](#movenext)|Извлекает данные из следующей последовательной строки или указанного числа позиций за пределами следующей строки.|
|[мовепрев](#moveprev)|Переход к предыдущей записи.|
|[моветобукмарк](#movetobookmark)|Извлекает строку, помеченную закладкой или строкой с указанным смещением, из этой закладки.|
|[моветоратио](#movetoratio)|Извлекает строки, начиная с части, расположенной в наборе строк.|
|[ReleaseRows](#releaserows)|Вызывает метод [IRowset:: ReleaseRows](/previous-versions/windows/desktop/ms719771(v=vs.85)) , чтобы освободить текущий маркер строки.|
|[SetData](#setdata)|Задает значения данных в одном или нескольких столбцах строки с помощью [IRowsetChange: SetData](/previous-versions/windows/desktop/ms721232(v=vs.85)).|
|[Отменить](#undo)|Отменяет любые изменения, внесенные в строку с момента последней выборки или [обновления](../../data/oledb/crowset-update.md).|
|[Обновление](#update)|Передает все ожидающие изменения, внесенные в текущую строку с момента последней выборки или обновления.|
|[UpdateAll](#updateall)|Передает все ожидающие изменения, внесенные во все строки с момента последней выборки или обновления.|

## <a name="remarks"></a>Примечания

В OLE DB набор строк — это объект, через который программа устанавливает и извлекает данные.

Этот класс не предназначен для создания экземпляра, а передается как параметр шаблона в `CTable` или `CCommand` ( `CRowset` является значением по умолчанию).

## <a name="crowsetaddrefrows"></a><a name="addrefrows"></a> CRowset:: Аддрефровс

Вызывает метод [IRowset:: аддрефровс](/previous-versions/windows/desktop/ms719619(v=vs.85)) для увеличения (на единицу) счетчика ссылок, связанного с текущим маркером строки.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT AddRefRows() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Этот метод увеличивает значение счетчика ссылок для текущего маркера строки. Вызовите [ReleaseRows](../../data/oledb/crowset-releaserows.md) , чтобы уменьшить число. Строки, возвращаемые методами Move, имеют счетчик ссылок, равный единице.

## <a name="crowsetclose"></a><a name="close"></a> CRowset:: Close

Освобождает строки и текущий интерфейс [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) .

### <a name="syntax"></a>Синтаксис

```cpp
void Close() throw();
```

### <a name="remarks"></a>Примечания

Этот метод освобождает все строки, находящиеся в данный момент в наборе строк.

## <a name="crowsetcompare"></a><a name="compare"></a> CRowset:: Compare

Сравнивает две закладки с помощью [IRowsetLocate:: Compare](/previous-versions/windows/desktop/ms709539(v=vs.85)).

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT Compare(const CBookmarkBase& bookmark1,
   const CBookmarkBase& bookmark2,
   DBCOMPARE* pComparison) const throw();
```

#### <a name="parameters"></a>Параметры

*Bookmark1*<br/>
окне Первая закладка для сравнения.

*Bookmark2*<br/>
окне Вторая сравниваемая закладка.

*пкомпарисон*<br/>
заполняет Указатель на результат сравнения.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetLocate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetLocate` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

Сведения об использовании закладок в потребителях см. в разделе [Использование закладок](../../data/oledb/using-bookmarks.md).

## <a name="crowsetcrowset"></a><a name="crowset"></a> CRowset:: CRowset

Создает новый `CRowset` объект и (необязательно) связывает его с интерфейсом [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) , предоставляемым в качестве параметра.

### <a name="syntax"></a>Синтаксис

```cpp
CRowset();

CRowset(IRowset* pRowset);
```

#### <a name="parameters"></a>Параметры

*провсет*<br/>
окне Указатель на `IRowset` интерфейс, который должен быть связан с этим классом.

## <a name="crowsetdelete"></a><a name="delete"></a> CRowset::D удалить

Вызывает [IRowsetChange::D елетеровс](/previous-versions/windows/desktop/ms724362(v=vs.85)) , чтобы удалить текущую строку из набора строк.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT Delete() const throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

## <a name="crowsetfindnextrow"></a><a name="findnextrow"></a> CRowset:: FindNextRow

Находит следующую совпадающую строку после указанной закладки.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT FindNextRow(DBCOMPAREOP op,
   BYTE* pData,
   DBTYPE wType,
   DBLENGTH nLength,
   BYTE bPrecision,
   BYTE bScale,
   BOOL bSkipCurrent = TRUE,
   CBookmarkBase* pBookmark = NULL) throw();
```

#### <a name="parameters"></a>Параметры

*операцион*<br/>
окне Операция, используемая для сравнения значений строк. Значения см. в разделе [IRowsetFind:: FindNextRow](/previous-versions/windows/desktop/ms723091(v=vs.85)).

*pData*<br/>
окне Указатель на значение, которое должно быть сопоставлено.

*wType*<br/>
окне Указывает тип данных части значения буфера. Сведения о индикаторах типов см. в разделе [типы данных](/previous-versions/windows/desktop/ms723969(v=vs.85)) в *справочнике по OLE DB программиста* в Windows SDK.

*нленгс*<br/>
окне Длина (в байтах) структуры данных потребителя, выделенной для значения данных. Дополнительные сведения см. в описании `cbMaxLen` [структур DBBINDING](/previous-versions/windows/desktop/ms716845(v=vs.85)) в *справочнике программиста OLE DB.*

*bPrecision*<br/>
окне Максимальная точность, используемая при получении данных. Используется, только если *wType* имеет значение DBTYPE_NUMERIC. Дополнительные сведения см. в разделе [преобразования, включающие DBTYPE_NUMERIC или DBTYPE_DECIMAL](/previous-versions/windows/desktop/ms719714(v=vs.85)) , в *справочнике по программированию OLE DB*.

*bScale*<br/>
окне Масштаб, используемый при получении данных. Используется, только если *wType* имеет значение DBTYPE_NUMERIC или DBTYPE_DECIMAL. Дополнительные сведения см. в разделе [преобразования, включающие DBTYPE_NUMERIC или DBTYPE_DECIMAL](/previous-versions/windows/desktop/ms719714(v=vs.85)) , в *справочнике по программированию OLE DB*.

*бскипкуррент*<br/>
окне Число строк из закладки, с которой начинается поиск.

*пбукмарк*<br/>
окне Закладка для позиции, с которой начинается поиск.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetFind` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetFind` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

Сведения об использовании закладок в потребителях см. в разделе [Использование закладок](../../data/oledb/using-bookmarks.md).

## <a name="crowsetgetapproximateposition"></a><a name="getapproximateposition"></a> CRowset:: Жетаппроксиматепоситион

Возвращает приблизительное расположение строки, соответствующей закладке.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT GetApproximatePosition(const CBookmarkBase* pBookmark,
   DBCOUNTITEM* pPosition,
   DBCOUNTITEM* pcRows) throw();
```

#### <a name="parameters"></a>Параметры

*пбукмарк*<br/>
окне Указатель на закладку, определяющую строку, позиции которой необходимо найти. Значение NULL, если требуется только подсчет строк.

*ппоситион*<br/>
заполняет Указатель на расположение, где `GetApproximatePosition` возвращает позицию строки. Значение NULL, если расположение не является обязательным.

*пкровс*<br/>
заполняет Указатель на расположение, где `GetApproximatePosition` возвращает общее число строк. Значение NULL, если число строк не требуется.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetScroll` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetScroll` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

Сведения об использовании закладок в потребителях см. в разделе [Использование закладок](../../data/oledb/using-bookmarks.md).

## <a name="crowsetgetdata"></a><a name="getdata"></a> CRowset:: GetData

Извлекает данные из копии набора строк для строки.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT GetData() throw();

HRESULT GetData(int nAccessor) throw();
```

#### <a name="parameters"></a>Параметры

*накцессор*<br/>
окне Номер индекса метода доступа (Нулевое смещение), используемый для доступа к данным.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Если указать метод доступа, который не является средством автодоступа в [BEGIN_ACCESSOR](../../data/oledb/begin-accessor.md), используйте этот метод для явного получения данных путем передачи номера метода доступа.

## <a name="crowsetgetdatahere"></a><a name="getdatahere"></a> CRowset:: Жетдатахере

Извлекает данные из текущей строки и помещает их в указанный буфер.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT GetDataHere(int nAccessor,
   void* pBuffer) throw();
```

#### <a name="parameters"></a>Параметры

*накцессор*<br/>
окне Номер индекса метода доступа, используемого для доступа к данным.

*pBuffer*<br/>
заполняет Буфер, в который помещаются данные для текущей записи.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Пример использования этой функции см. в разделе [пример для чтения](../../overview/visual-cpp-samples.md).

## <a name="crowsetgetoriginaldata"></a><a name="getoriginaldata"></a> CRowset:: Жеторигиналдата

Вызовы `IRowsetUpdate::GetOriginalData` для получения данных, которые недавно были получены или переданы в источник данных.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT GetOriginalData() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Этот метод получает данные, которые были получены недавно из источника данных или переданы в него. Он не извлекает значения на основе ожидающих изменений.

Для этого метода требуется дополнительный интерфейс `IRowsetUpdate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetUpdate` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

## <a name="crowsetgetrowstatus"></a><a name="getrowstatus"></a> CRowset:: Жетровстатус

Возвращает состояние всех строк.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT GetRowStatus(DBPENDINGSTATUS* pStatus) const throw();
```

#### <a name="parameters"></a>Параметры

*пстатус*<br/>
заполняет Указатель на расположение, где `GetRowStatus` возвращает значение состояния. См. раздел ДБПЕНДИНГСТАТУС в справочнике программиста OLE DB.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetUpdate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetUpdate` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

## <a name="crowsetinsert"></a><a name="insert"></a> CRowset:: INSERT

Создает и инициализирует новую строку, используя данные из метода доступа.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT Insert(int nAccessor = 0,
   bool bGetHRow = false) throw();
```

#### <a name="parameters"></a>Параметры

*накцессор*<br/>
окне Номер метода доступа, используемого для вставки данных.

*бжесров*<br/>
окне Указывает, извлекается ли маркер вставляемой строки.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetChange` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetChange` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

Вставка может завершиться ошибкой, если один или несколько столбцов недоступны для записи. Измените схему курсоров, чтобы исправить это.

### <a name="example"></a>Пример

В следующем примере показано, как получить доступ к источнику данных через набор строк, а затем вставить строку, используя таблицу в этом наборе строк.

Сначала создайте класс таблицы, вставив в проект новый объект ATL. Например, щелкните правой кнопкой мыши проект в области Рабочая область и выберите пункт **создать объект ATL**. В категории **доступ к данным** выберите **потребитель**. Создайте объект-получатель типа **Table**. (Выбор **таблицы** создает набор строк непосредственно из таблицы; Выбор **команды** создает набор строк с помощью команды SQL.) Выберите источник данных, указав таблицу для доступа к этому источнику данных. При вызове объекта-получателя **ккустомертабле**необходимо реализовать код вставки следующим образом:

[!code-cpp[NVC_OLEDB_Consumer#10](../../data/oledb/codesnippet/cpp/crowset-insert_1.cpp)]

## <a name="crowsetissamerow"></a><a name="issamerow"></a> CRowset:: IsSameRow

Сравнивает указанную строку с текущей строкой.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT IsSameRow(HROW hRow) const throw();
```

#### <a name="parameters"></a>Параметры

*hRow*<br/>
окне Описатель для строки, сравниваемой с текущей строкой.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT. S_OK указывает, что строки одинаковы. Другие значения см. в разделе [ировсетиндентити:: IsSameRow](/previous-versions/windows/desktop/ms719629(v=vs.85)) в *справочнике программиста OLE DB* в Windows SDK.

## <a name="crowsetmovefirst"></a><a name="movefirst"></a> CRowset:: MoveFirst

Перемещает курсор в начальную позицию и получает начальную строку.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT MoveFirst() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Вызывает метод [IRowset:: свойство RestartPosition](/previous-versions/windows/desktop/ms712877(v=vs.85)) , чтобы переместить расположение следующей выборки в начальную позицию (положение следующей выборки при создании набора строк) и получает начальную строку.

## <a name="crowsetmovelast"></a><a name="movelast"></a> CRowset:: MoveLast

Перемещает курсор в последнюю строку.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT MoveLast() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Вызывает метод [IRowset:: свойство RestartPosition](/previous-versions/windows/desktop/ms712877(v=vs.85)) , чтобы переместить место следующей выборки в последнюю позицию и извлечь последнюю строку.

Для этого метода необходимо задать значение `DBPROP_CANSCROLLBACKWARDS` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк. (Для повышения производительности можно также задать значение `DBPROP_QUICKRESTART` VARIANT_TRUE.)

## <a name="crowsetmovenext"></a><a name="movenext"></a> CRowset:: MoveNext

Перемещает курсор к следующей записи.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT MoveNext() throw();

HRESULT MoveNext(LONG lSkip,
   bool bForward= true) throw();
```

#### <a name="parameters"></a>Параметры

*лскип*<br/>
окне Число строк, которые необходимо пропустить перед получением.

*бфорвард*<br/>
окне Передайте **`true`** Переход к следующей записи, **`false`** чтобы перейти назад.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT. По достижении конца набора строк возвращает DB_S_ENDOFROWSET.

### <a name="remarks"></a>Примечания

Извлекает следующую последовательную строку из объекта, заменяя `CRowset` предыдущую позицию. При необходимости можно пропустить *лскип* строки или переместить назад.

Для этого метода необходимо задать следующие свойства перед вызовом `Open` для таблицы или команды, содержащей набор строк:

- `DBPROP_CANSCROLLBACKWARDS` должен быть VARIANT_TRUE, если *лскип* < 0

- `DBPROP_CANFETCHBACKWARDS` должен быть VARIANT_TRUE, если *бфорвард* = false

В противном случае (если *лскип* >= 0 и *бфорвард* = true), не нужно задавать какие-либо дополнительные свойства.

## <a name="crowsetmoveprev"></a><a name="moveprev"></a> CRowset:: Мовепрев

Перемещает курсор к предыдущей записи.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT MovePrev() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода необходимо задать значение `DBPROP_CANFETCHBACKWARDS` или, `DBPROP_CANSCROLLBACKWARDS` чтобы VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

## <a name="crowsetmovetobookmark"></a><a name="movetobookmark"></a> CRowset:: Моветобукмарк

Извлекает строку, помеченную закладкой, или строку с указанным смещением (*лскип*) из этой закладки.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT MoveToBookmark(const CBookmarkBase& bookmark,
   LONG lSkip = 0) throw();
```

#### <a name="parameters"></a>Параметры

*bookmark*<br/>
окне Закладка, помечающая расположение, из которого необходимо извлечь данные.

*лскип*<br/>
окне Число строк из закладки в целевую строку. Если *лскип* равен нулю, первая строка выбирается в качестве строки с закладкой. Если значение *лскип* равно 1, первая строка получается после строки с закладкой. Если *лскип* имеет значение-1, первая строка извлекается перед строкой с закладкой.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetLocate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetLocate` VARIANT_TRUE и задать значение `DBPROP_CANFETCHBACKWARDS` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

Сведения об использовании закладок в потребителях см. в разделе [Использование закладок](../../data/oledb/using-bookmarks.md).

## <a name="crowsetmovetoratio"></a><a name="movetoratio"></a> CRowset:: Моветоратио

Извлекает строки, начиная с части, расположенной в наборе строк.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT MoveToRatio(DBCOUNTITEM nNumerator,
   DBCOUNTITEM nDenominator,bool bForward = true) throw();
```

#### <a name="parameters"></a>Параметры

*ннумератор*<br/>
окне Числитель, используемый для определения относительного расположения для выборки данных.

*нденоминатор*<br/>
окне Знаменатель, используемый для определения относительного расположения для выборки данных.

*бфорвард*<br/>
окне Указывает, следует ли перемещаться вперед или назад. Значение по умолчанию — forward.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

`MoveToRatio` выберет строки приблизительно по следующей формуле:

`(nNumerator *  RowsetSize ) / nDenominator`

где `RowsetSize` — Размер набора строк, измеряемый в строках. Точность этой формулы зависит от конкретного поставщика. Дополнительные сведения см. в разделе [IRowsetScroll:: жетровсатратио](/previous-versions/windows/desktop/ms709602(v=vs.85)).

Для этого метода требуется дополнительный интерфейс `IRowsetScroll` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetScroll` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

## <a name="crowsetreleaserows"></a><a name="releaserows"></a> CRowset:: ReleaseRows

Вызывает метод [IRowset:: ReleaseRows](/previous-versions/windows/desktop/ms719771(v=vs.85)) , чтобы освободить текущий маркер строки.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT ReleaseRows() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

## <a name="crowsetsetdata"></a><a name="setdata"></a> CRowset:: SetData

Задает значения данных в одном или нескольких столбцах строки.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT SetData() const throw();

HRESULT SetData(int nAccessor) const throw();
```

#### <a name="parameters"></a>Параметры

*накцессор*<br/>
окне Номер метода доступа, используемого для доступа к данным.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для `SetData` формы, не принимающей аргументов, для обновления используются все методы доступа. Обычно вызывается `SetData` для установки значений данных в столбцах строки, а затем вызывается [Update](../../data/oledb/crowset-update.md) для передачи этих изменений.

Для этого метода требуется дополнительный интерфейс `IRowsetChange` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetChange` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

Операция установки может завершиться ошибкой, если один или несколько столбцов недоступны для записи. Измените схему курсоров, чтобы исправить это.

## <a name="crowsetundo"></a><a name="undo"></a> CRowset:: Undo

Отменяет любые изменения, внесенные в строку с момента последней выборки или [обновления](../../data/oledb/crowset-update.md).

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT Undo(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>Параметры

*пкровс*<br/>
заполняет Указатель на расположение, где `Undo` возвращает число строк, которые он пытался отменить, если это необходимо.

*фров*<br/>
заполняет Указатель на расположение, где `Undo` возвращает массив дескрипторов ко всем строкам, которые он пытался отменить, если это необходимо.

*пстатус*<br/>
заполняет Указатель на расположение, где `Undo` возвращает значение состояния строки. Если *пстатус* имеет значение null, состояние не возвращается.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Для этого метода требуется дополнительный интерфейс `IRowsetUpdate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetUpdate` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

## <a name="crowsetupdate"></a><a name="update"></a> CRowset:: Update

Передает все ожидающие изменения, внесенные в текущую строку с момента последней выборки или `Update` вызова метода.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT Update(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>Параметры

*пкровс*<br/>
заполняет Указатель на расположение `Update` , где возвращает число строк, которое он пытался обновить, если это необходимо.

*фров*<br/>
заполняет Указатель на расположение, в котором `Update` возвращается маркер строки, которую он пытался обновить. Если *фров* имеет значение null, никакие маркеры не возвращаются.

*пстатус*<br/>
заполняет Указатель на расположение, где `Update` возвращает значение состояния строки. Если *пстатус* имеет значение null, состояние не возвращается.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

### <a name="remarks"></a>Примечания

Передает все ожидающие изменения, внесенные в текущую строку, с момента последней выборки или обновления этой строки (с помощью `Update` или [UpdateAll](../../data/oledb/crowset-updateall.md)). Как правило, метод [SetData](../../data/oledb/crowset-setdata.md) вызывается для задания значений данных в столбцах строки, а затем вызывается `Update` для передачи этих изменений.

Для этого метода требуется дополнительный интерфейс `IRowsetUpdate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetUpdate` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

## <a name="crowsetupdateall"></a><a name="updateall"></a> CRowset:: UpdateAll

Передает все ожидающие изменения, внесенные во все строки с момента последней выборки или `Update` вызова.

### <a name="syntax"></a>Синтаксис

```cpp
HRESULT UpdateAll(DBCOUNTITEM* pcRows = NULL,
   HROW** pphRow = NULL,
   DBROWSTATUS** ppStatus = NULL) throw();
```

#### <a name="parameters"></a>Параметры

*пкровс*<br/>
заполняет Указатель на расположение `UpdateAll` , где возвращает число строк, которое он пытался обновить, если это необходимо.

*пфров*<br/>
заполняет Указатель на память, в которой `UpdateAll` возвращается маркер строки, которую он пытался обновить. Если *пфров* имеет значение null, никакие маркеры не возвращаются.

*ппстатус*<br/>
заполняет Указатель на расположение, где `Update` возвращает значение состояния строки. Если *ппстатус* имеет значение null, состояние не возвращается.

### <a name="remarks"></a>Примечания

Передает все ожидающие изменения, внесенные во все строки, так как эти строки были в последний раз выбраны или обновлены с помощью [Update](../../data/oledb/crowset-update.md) или `UpdateAll` . `UpdateAll` обновляет каждую измененную строку независимо от того, есть ли у вас их обработчик (см. раздел *пфров*).

Например, если вы использовали `Insert` для вставки пяти строк в набор строк, можно либо вызвать `Update` пять раз, либо вызвать `UpdateAll` один раз, чтобы обновить все.

Для этого метода требуется дополнительный интерфейс `IRowsetUpdate` , который может не поддерживаться для всех поставщиков. Если это так, метод возвращает E_NOINTERFACE. Необходимо также задать значение `DBPROP_IRowsetUpdate` VARIANT_TRUE перед вызовом `Open` для таблицы или команды, содержащей набор строк.

### <a name="return-value"></a>Возвращаемое значение

Стандартное значение HRESULT.

## <a name="see-also"></a>См. также раздел

[Пример Дбвиевер](../../overview/visual-cpp-samples.md)<br/>
[Пример для чтения](../../overview/visual-cpp-samples.md)<br/>
[Пример атрибутов с прочтением](../../overview/visual-cpp-samples.md)<br/>
[Шаблоны объекта-получателя OLE DB](../../data/oledb/ole-db-consumer-templates-cpp.md)<br/>
[Справочник по шаблонам потребителей OLE DB](../../data/oledb/ole-db-consumer-templates-reference.md)
