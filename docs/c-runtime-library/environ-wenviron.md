---
title: _environ, _wenviron
ms.date: 11/04/2016
f1_keywords:
- environ
- wenviron
- _wenviron
- _environ
helpviewer_keywords:
- environ function
- _environ function
- _wenviron function
- process environment
- wenviron function
ms.assetid: 7e639962-6536-47cd-8095-0cbe44a56e03
ms.openlocfilehash: 8d67947c93d1387bfdc38c3bae5b3f978024a725
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81349369"
---
# <a name="_environ-_wenviron"></a>_environ, _wenviron

Переменная `_environ` является указателем на массив указателей на строки многобайтовых символов, которые составляют среду процесса. Использование этой глобальной переменной не рекомендуется, поскольку существуют более безопасные функциональные версии [getenv_s, _wgetenv_s](../c-runtime-library/reference/getenv-s-wgetenv-s.md) и [putenv_s, _wputenv_s](../c-runtime-library/reference/putenv-s-wputenv-s.md), которые следует использовать вместо нее. `_environ` объявлена в файле Stdlib.h.

> [!IMPORTANT]
> Этот API нельзя использовать в приложениях, выполняемых в среде выполнения Windows. Дополнительные сведения: [Функции CRT, которые не поддерживаются в приложениях универсальной платформы Windows](../cppcx/crt-functions-not-supported-in-universal-windows-platform-apps.md).

## <a name="syntax"></a>Синтаксис

```
extern char **_environ;
```

## <a name="remarks"></a>Примечания

В программе, которая использует функцию `main`, переменная `_environ` инициализируется при запуске программы в соответствии с настройками, полученными из среды операционной системы. Среда состоит из одной или нескольких записей следующего вида:

`ENVVARNAME` `=string`

Функции `getenv_s` и `putenv_s` используют переменную `_environ` для получения доступа к таблице среды и ее изменения. При вызове функции `_putenv` для добавления или удаления параметров среды размер таблица среды изменяется. Ее расположение в памяти также может изменяться, это зависит от требований к памяти программы. Значение переменной `_environ` автоматически изменяется соответствующим образом.

Переменная `_wenviron`, объявленная в файле Stdlib.h как:

```
extern wchar_t **_wenviron;
```

представляет собой версию переменной `_environ` для расширенных символов. В программе, которая использует функцию `wmain`, переменная `_wenviron` инициализируется при запуске программы в соответствии с настройками, полученными из среды операционной системы.

В программе, которая использует `main`, переменная `_wenviron` изначально имеет значение **NULL**, поскольку среда состоит из строк многобайтовых символов. При первом вызове функции `_wgetenv` или `_wputenv` создается соответствующая строка среды из расширенных символов, на которую указывает переменная `_wenviron`.

Аналогично, в программе, которая использует `wmain`, переменная `_environ` изначально имеет значение **NULL**, поскольку среда состоит из строк расширенных символов. При первом вызове функции `_getenv` или `_putenv` создается соответствующая строка среды из многобайтовых символов, на которую указывает переменная `_environ`.

Если в программе одновременно существуют две копии среды (многобайтовой кодировки и Юникода), система времени выполнения должна поддерживать обе копии, что отрицательно сказывается на скорости выполнения программы. Например, при вызове функции `_putenv` также автоматически производится вызов функции `_wputenv`, чтобы строки в двух средах совпадали.

> [!CAUTION]
> В редких случаях, когда система времени выполнения поддерживает и версию Юникода, и многобайтовую версию, эти две версии среды могут не полностью соответствовать друг другу. Это происходит потому, что хотя любая уникальная расширенная строка сопоставляется уникальной строке Юникода, сопоставление уникальной строки Юникода со строкой многобайтовой кодировки не обязательно будет уникальными. Поэтому две различных строки Юникода могут сопоставляться одной и той же многобайтовой строке.

Запрос переменной `_environ` в контексте Юникода не имеет смысла, если используется компоновка [/MD](../build/reference/md-mt-ld-use-run-time-library.md) или `/MDd`. Библиотеке DLL CRT неизвестен тип (расширенная или многобайтовая) программы. Создается только многобайтовый тип, поскольку это наиболее вероятный сценарий.

Следующий псевдокод иллюстрирует, как это может произойти.

```
int i, j;
i = _wputenv( "env_var_x=string1" );  // results in the implicit call:
                                      // putenv ("env_var_z=string1")
j = _wputenv( "env_var_y=string2" );  // also results in implicit call:
                                      // putenv("env_var_z=string2")
```

В нотации, используемой для данного примера, символьные строки не являются строковыми литералами C; скорее это местозаполнители, которые представляют литералы строки среды Юникода в вызове функции `_wputenv` и многобайтовые строки среды в вызове функции `putenv`. Местозаполнители символов "`x`" и "`y`" в двух различных строках среды Юникода не сопоставляются однозначно символам в текущей многобайтовой кодировке. Вместо этого они сопоставляются определенному символу многобайтовой кодировки "`z`", который является результатом по умолчанию для попытки преобразовать строки.

Поэтому в многобайтовых средах значение "`env_var_z`" после первого неявного вызова функции `putenv` будет равно "`string1`", но это значение будет перезаписано при втором неявном вызове функции `putenv`, если для "`env_var_z`" будет установлено значение "`string2`". Поэтому после такой последовательности вызовов среда Юникода (в `_wenviron`) и многобайтовая среда (в `_environ`) будут отличаться.

## <a name="see-also"></a>См. также раздел

[Глобальные переменные](../c-runtime-library/global-variables.md)<br/>
[getenv, _wgetenv](../c-runtime-library/reference/getenv-wgetenv.md)<br/>
[getenv_s, _wgetenv_s](../c-runtime-library/reference/getenv-s-wgetenv-s.md)<br/>
[_putenv, _wputenv](../c-runtime-library/reference/putenv-wputenv.md)<br/>
[_putenv_s, _wputenv_s](../c-runtime-library/reference/putenv-s-wputenv-s.md)
